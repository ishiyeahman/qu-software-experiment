                         4 .list
                         5 /* ÂàùÊúüÂåñ*/
                         6 
                         7 		***************************************************************
                         8 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         9 		***************************************************************
                        10 
                        11 		***************
                        12 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        13 		***************
                        14 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        15 		.equ IOBASE,    0x00d00000
                        16 
                        17 		***************
                        18 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        19 		***************
                        20 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        21 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        22 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        23 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        24 
                        25 		***************
                        26 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        27 		***************
                        28 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        29 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        30 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        31 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        32 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        33 
                        34 		***************
                        35 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        36 		***************
                        37 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        38 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        39 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        40 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        41 
                        42 		***************
                        43 		** LED
                        44 		***************
                        45 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        46 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        47 		.equ LED5,      IOBASE+0x000002b
                        48 		.equ LED4,      IOBASE+0x0000029
                        49 		.equ LED3,      IOBASE+0x000003f
                        50 		.equ LED2,      IOBASE+0x000003d
                        51 		.equ LED1,      IOBASE+0x000003b
                        52 		.equ LED0,      IOBASE+0x0000039
                        53 
                        54 		***************************************************************
                        55 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        56 		***************************************************************
                        57 		.section .bss
                        58 		.even
                        59 SYS_STK:
000ba8 0000 0000        60 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
                        61 		.even
                        62 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
004ba8 0000 0000        63 		WORK: .ds.b 256 /*step6_test*/
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
                        64 		***************************************************************
                        65 		** ÂàùÊúüÂåñ
                        66 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        67 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        68 		***************************************************************
                        69 		.section .text
                        70 		.even
                        71 boot:
                        72 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        73 		move.w #0x2700,%SR
000404 4FF9 0000        74 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             74 
                        75 
                        76 		****************
                        77 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        78 		****************
00040a 13FC 0040        79 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        79 
000412 23FC 00FF        80 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        80 
       F304             80 
                        81 
                        82 		****************
                        83 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        84 		****************
00041c 33FC 0000        85 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        85 
000424 33FC E108        86 		move.w #0xe108, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        86 
00042c 33FC 0038        87 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        87 
                        88 
                        89 		****************
                        90 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        91 		****************
000434 33FC 0004        92 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        92 
                        93 
                        94 		***************************************************************
                        95 		** STEP2„ÅÆÂá¶ÁêÜ
                        96 		***************************************************************
                        97 		*lea.l uart1_interrupt, %a0
                        98 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 23FC 00FF        99 		move.l #0x00ff3ff9,IMR  |UART1Ë®±ÂèØ
       3FF9 00FF        99 
       F304             99 
                       100 
                       101 		/*trap #0„Å´ÁôªÈå≤*/
000446 21FC 0000       102 		move.l #CALL_SYSTEM, 0x080
       0000 0080       102 
                       103 
00044e 21FC 0000       104 		move.l #uart1_interrupt, 0x110
       0000 0110       104 
000456 21FC 0000       105 		move.l #timer1_interrupt, 0x118 /* „Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„ÅÆÁôªÈå≤ */
       0000 0118       105 
                       106 		
                       107 
                       108 		
                       109 
                       110         	/* Queue initialize */
00045e 4EB9 0000       111         jsr Init_Q
       0000            111 
                       112 
                       113 		*LED_CLEAR:
000464 13FC 0020       114 		move.b #' ', LED0
       00D0 0039       114 
00046c 13FC 0020       115 		move.b #' ', LED1
       00D0 003B       115 
000474 13FC 0020       116 		move.b #' ', LED2
       00D0 003D       116 
00047c 13FC 0020       117 		move.b #' ', LED3
       00D0 003F       117 
000484 13FC 0020       118 		move.b #' ', LED4
       00D0 0029       118 
00048c 13FC 0020       119 		move.b #' ', LED5
       00D0 002B       119 
000494 13FC 0020       120 		move.b #' ', LED6
       00D0 002D       120 
00049c 13FC 0020       121 		move.b #' ', LED7
       00D0 002F       121 
                       122 
                       123 
                       124 		/*step9„ÅÆMAIN„Å∏*/
0004a4 6000 00C4       125 		bra MAIN		
                       126 
                       127 
                       128 
                       129 /*trap #0„Åß„ÅÆÂá¶ÁêÜ,SYSTEMCALL*/
                       130 CALL_SYSTEM:
                       131 	*move.w #0x2000, %SR /* „Åì„ÅÑ„Å§„ÅÆ„Åõ„ÅÑ„Åß„ÄÅ„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Ç®„É©„ÉºÁô∫Áîü */
                       132 
0004a8 0C40 0001       133 	cmpi #1, %d0
0004ac 6600 000A       134 	bne CALL_PUT
                       135 
                       136 	*lea.l GETSTRING, %a0
                       137 	*move.l (%a0), %d0
                       138 	*jmp (%a0)
                       139 	
0004b0 4EBA 0388       140 	jsr GETSTRING	
                       141 	
0004b4 6000 0032       142 	bra CALL_END
                       143 
                       144 CALL_PUT:
0004b8 0C40 0002       145 	cmpi #2, %d0
0004bc 6600 000A       146 	bne CALL_RESET
                       147 
                       148 	*lea.l PUTSTRING, %a0
                       149 	*move.l (%a0), %d0
                       150 	*jmp %a0
                       151 
0004c0 4EBA 0328       152 	jsr PUTSTRING
                       153 
0004c4 6000 0022       154 	bra CALL_END
                       155 
                       156 
                       157 CALL_RESET:
0004c8 0C40 0003       158 	cmpi #3, %d0
0004cc 6600 000A       159 	bne CALL_SET
                       160 	
                       161 	*lea.l RESET_TIMER, %a0
                       162 	*move.l (%a0), %d0
                       163 	*jmp (%a0)
                       164 	
0004d0 4EBA 0018       165 	jsr RESET_TIMER
                       166 	
0004d4 6000 0012       167 	bra CALL_END
                       168 
                       169 CALL_SET:
0004d8 0C40 0004       170 	cmpi #4, %d0
0004dc 6600 000A       171 	bne CALL_END
                       172 
                       173 	*lea.l SET_TIMER, %a0
                       174 	*move.l (%a0), %d0
                       175 	*jmp (%a0)
                       176 	
0004e0 4EBA 001A       177 	jsr SET_TIMER
                       178 	
0004e4 6000 0002       179 	bra CALL_END
                       180 
                       181 
                       182 CALL_END:
0004e8 4E73            183 	rte /* ‚òì rte -> rts */
                       184 
                       185 
                       186 
                       187 *****************************************************************************************
                       188 ** TIMER SETTING
                       189 *****************************************************************************************
                       190 
                       191 ************************************************************* 
                       192 **RESET_TIMER 
                       193 **Ê©üËÉΩ 
                       194 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã 
                       195 ************************************************************* 
                       196 
                       197 RESET_TIMER: 
0004ea 13FC 0035       198 	move.b  #'5', LED3      /*ÊñáÂ≠ó‚Äô5‚Äô„ÇíLED„ÅÆ4Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 003F       198 
0004f2 33FC 0004       199 	move.w #0x0004, TCTL1 /* 1.TCTL1„Çí„Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢„Å´Ë®≠ÂÆö */ 
       00FF F600       199 
0004fa 4E75            200 	rts
                       201 
                       202 
                       203   
                       204 ************************************************************* 
                       205 **SET_TIMER 
                       206 **Ê©üËÉΩ 
                       207 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âëº„Å≥
                       208 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÂë®Êúüt„ÇíË®≠ÂÆö„ÅóÔºåt*0.1msecÁßíÊØé„Å´Ââ≤„ÇäËæº„Åø„ÅåÁô∫Áîü„Åô„Çã„Çà„ÅÜ„Å
                       209 **	„Çø„Ç§„Éû‰ΩøÁî®„ÇíË®±ÂèØ„ÅóÔºå„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„ÇíË®±ÂèØ„Åô„ÇãÔºé(=„Çø„Ç§„Éû„Çí„Çπ„Çø„Éº„Éà„
                       210 **ÂÖ•Âäõ 
                       211 **	d1:„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü 
                       212 **	d2:Ââ≤„ÇäËæº„ÅøÊôÇ„Å´Ëµ∑Âãï„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       213 **Êàª„ÇäÂÄ§ 
                       214 **	„Å™„Åó 
                       215 *************************************************************
                       216   
                       217 
                       218 SET_TIMER:
0004fc 13FC 0031       219 	move.b  #'1', LED7      /*ÊñáÂ≠ó‚Äô1‚Äô„ÇíLED„ÅÆ8Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002F       219 
000504 23C2 0000       220 	move.l %d2, task_p /* 1.Ââ≤„ÇäËæº„Åø„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„ÇíÔºåtask_p„Å´‰ª£ÂÖ• „Å°„Çá„
       0000            220 
00050a 33FC 00CE       221 	move.w #0x00ce, TPRER1 /* 2.TPRER1„Çí„ÄÅ0.1msecÈÄ≤„ÇÄ„Å®„Ç´„Ç¶„É≥„Çø„Åå1Â¢ó„Åà„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö *
       00FF F602       221 
000512 33C1 00FF       222 	move.w %d1, TCMP1 /* 3.„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü„ÇíÔºåTCMP1„Å´‰ª£ÂÖ• Ë¶Å‰øÆÊ≠£ */ 
       F604            222 
000518 33FC 0015       223 	move.w #0x0015, TCTL1 /* 4.TCTL1„ÇíÂâ≤„ÇäËæº„ÅøË®±ÂèØ„Å´Ë®≠ÂÆö */  
       00FF F600       223 
000520 4E75            224 	rts
                       225 
                       226 ************************************************************* 
                       227 **CALL_RP 
                       228 **Ê©üËÉΩ 
                       229 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âá¶ÁêÜ„Åô„Åπ„Åç„É´„Éº„ÉÅ„É≥„ÇíÂëº„Å≥Âá∫„Åô 
                       230 ************************************************************* 
                       231 
                       232 CALL_RP: 
000522 13FC 0032       233 	move.b  #'2', LED6      /*ÊñáÂ≠ó‚Äô2‚Äô„ÇíLED„ÅÆ7Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002D       233 
00052a 2079 0000       234 	movea.l task_p, %a0
       0000            234 
000530 4E90            235 	jsr (%a0)
                       236 	*jsr task_p /* 1.task_p„ÅÆÊåá„Åô„Ç¢„Éâ„É¨„Çπ„Å∏„Ç∏„É£„É≥„Éó„Åô„Çã „Åì„ÅìËá™‰ø°„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„Å™„Ç
000532 4E75            237 	rts /* Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„Å´Êàª„Çã */ 
                       238 
                       239  
                       240 ************************************************************* 
                       241 **p 
                       242 **Ê©üËÉΩ 
                       243 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥ 
                       244 **Â§öÂàÜÂêÑËá™„Åß‰ΩúÊàê (Ë™≤È°å10) 
                       245 ************************************************************* 
                       246 *p: 
                       247 	*rts /* CALL_RP„Å´Êàª„Çã */ 
                       248  
                       249 
                       250 
                       251 
                       252 ***************************************************************************************************
                       253 **   CALL SETTING
                       254 ***************************************************************************************************
                       255 /*ÂêÑ„Ç∑„Çπ„ÉÜ„É†„ÅÆÂëº„Å≥Âá∫„Åó,t„ÉÜ„Çπ„Éà„Åß„ÅØMAIN„Å´„ÅÇ„Çã„Åü„ÇÅ‰ΩøÁî®„Åó„Å™„ÅÑ?*/
                       256 /*GETSTRINGÂëº„Å≥Âá∫„Åó*/
                       257 CALL_GETSTRING:
000534 7001            258 	move.l #1, %d0		/*GETSTRING*/
000536 7200            259 	move.l #0,%d1		/*ch=0*/
000538 243C 0000       260 	move.l #BUF, %d2	/*p=#BUF*/
       0000            260 
00053e 263C 0000       261 	move.l #256, %d3	/*size=256*/
       0100            261 
000544 4E40            262 	trap #0
                       263 
                       264 /*PUTSTRINGÂëº„Å≥Âá∫„Åó*/
                       265 CALL_PUTSTRING:
000546 7002            266 	move.l #2, %d0		/*PUTSTRING*/
000548 7200            267 	move.l #0,%d1		/*ch=0*/
00054a 243C 0000       268 	move.l #BUF, %d2	/*p=#BUF*/
       0000            268 
000550 263C 0000       269 	move.l #256, %d3	/*size=256*/
       0100            269 
000556 4E40            270 	trap #0
                       271 
                       272 /*RESET_TIMERÂëº„Å≥Âá∫„Åó*/
                       273 CALL_RESET_TIMER:
000558 7003            274 	move.l #3, %d0		/*RESET_TIMER*/
00055a 4E40            275 	trap #0
                       276 
                       277 /*SET_TIMERÂëº„Å≥Âá∫„Åó*/
                       278 CALL_SET_TIMER:
00055c 7004            279 	move.l #4, %d0		/*SET_TIMER*/
00055e 323C C350       280 	move.w #50000, %d1		/*d1=„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü*/
000562 243C 0000       281 	move.l #TT, %d2		/*„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπd2=#TT*/
       0000            281 
000568 4E40            282 	trap #0
                       283 
                       284 
                       285 /*‰ª•‰∏ästep8*/
                       286 
                       287 
                       288 
                       289 
                       290 
                       291 ******************************************************
                       292 ***„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´Áï™Âè∑
                       293 ******************************************************
                       294 	.equ SYSCALL_NUM_GETSTRING,	1
                       295 	.equ SYSCALL_NUM_PUTSTRING,	2
                       296 	.equ SYSCALL_NUM_RESET_TIMER,	3
                       297 	.equ SYSCALL_NUM_SET_TIMER,	4
                       298 
                       299 
                       300 ******************************************************
                       301 ***„Éó„É≠„Ç∞„É©„É†È†òÂüü
                       302 ******************************************************
                       303 .section .text
                       304 .even
                       305 MAIN:						/*Ëµ∞Ë°å„É¢„Éº„Éâ„Å®„É¨„Éô„É´„ÅÆË®≠ÂÆö(„É¶„Éº„Ç∂„É¢„Éº„Éâ„Å∏ÁßªË°å)*/
                       306 
00056a 46FC 0000       307 	move.w #0x0000, %SR				/*USER_MODE_LEBEL„Çí0„Å´*/
00056e 4FF9 0000       308 	lea.l USR_STK_TOP, %SP				/*USER_STACK„ÇíË®≠ÂÆö*/
       0000            308 
                       309 
                       310 
                       311     
                       312 	*move.l #SYSCALL_NUM_RESET_TIMER, %d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßRESET_TIMER„ÅÆËµ∑Âãï*/
                       313 	*trap #0
                       314 
                       315 
                       316 	*move.l #SYSCALL_NUM_SET_TIMER,%d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßSET_TIMER„ÅÆËµ∑Âãï*/
                       317 	*move.w #50000, %d1
                       318 	*move.l #TT, %d2
                       319 	*trap #0
                       320 
                       321 	*bra LOOP
                       322 	
                       323 ** !! *********************************
                       324 ** Typing Game routine
                       325 ** !! *********************************
                       326 
                       327 TYPE_GAME_INTRO:
000574 7002            328    	move.l #SYSCALL_NUM_PUTSTRING, %d0
000576 7200            329 	move.l #0, %d1				/*ch=0*/
000578 243C 0000       330 	move.l #INTRO, %d2			/*p=#INTRO*/
       0000            330 
00057e 761C            331 	move.l #28, %d3				/*size=8*/
000580 4E40            332 	trap #0
                       333 
                       334 TYPE_GAME_PRINT_TXT:
000582 7002            335     	move.l #SYSCALL_NUM_PUTSTRING, %d0
000584 7200            336 	move.l #0, %d1				/*ch=0*/
000586 243C 0000       337 	move.l #TXT_hello, %d2			/*p=#INTRO*/
       0000            337 
00058c 263C 0000       338 	move.l #SIZE_hello, %d3				/*size=8*/
       000B            338 
000592 4E40            339 	trap #0
                       340 
                       341 TYPE_GAME_PRINT_NEW_LINE:
000594 7002            342     	move.l #SYSCALL_NUM_PUTSTRING, %d0
000596 7200            343 	move.l #0, %d1				/*ch=0*/
000598 243C 0000       344 	move.l #NEW_LINE, %d2			/*p=#INTRO*/
       0000            344 
00059e 7602            345 	move.l #2, %d3				/*size=8*/
0005a0 4E40            346 	trap #0
                       347 
                       348 TYPE_GAME_SETTING:
0005a2 23FC 0000       349 	move.l #0, (COUNT_SIZE)
       0000 0000       349 
       0000            349 
0005ac 23FC 0000       350 	move.l #0, (COUNT_FAULT)
       0000 0000       350 
       0000            350 
0005b6 6000 0002       351     	bra LOOP
                       352 
                       353 
                       354 
                       355 
                       356 
                       357 ******************************************************
                       358 ***sys_GETSTRING,SYS_PUTSTRING„ÅÆ„ÉÜ„Çπ„Éà
                       359 ***„Çø„Éº„Éü„Éä„É´„ÅÆÂÖ•Âäõ„Çí„Ç®„Ç≥„Éº„Éê„ÉÉ„ÇØ
                       360 ******************************************************
                       361 
                       362 LOOP:
0005ba 7001            363 	move.l #SYSCALL_NUM_GETSTRING, %d0	/*GETSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
0005bc 7200            364 	move.l #0, %d1				/*ch=0*/
0005be 243C 0000       365 	move.l #BUF, %d2			/*p=#BUF*/
       0000            365 
0005c4 263C 0000       366 	move.l #256, %d3			/*size=256*/
       0100            366 
0005ca 4E40            367 	trap #0
                       368 
                       369 
0005cc 2600            370 	move.l %d0, %d3				/*size=d0*/
0005ce 7002            371 	move.l #SYSCALL_NUM_PUTSTRING, %d0	/*PUTSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
0005d0 7200            372 	move.l #0, %d1				/*ch=0*/
0005d2 243C 0000       373 	move.l #BUF, %d2			/*p=#BUF*/
       0000            373 
0005d8 4E40            374 	trap #0
                       375 
0005da 6000 FFDE       376 	bra LOOP
                       377 
                       378 ******************************************************
                       379 ***„Çø„Ç§„Éû„ÅÆ„ÉÜ„Çπ„Éà
                       380 ***'******'„ÇíË°®Á§∫„ÅóÊîπË°å
                       381 ***5ÂõûÂÆüË°å„Åó„Å¶RESET_TIMER
                       382 ******************************************************
                       383 
                       384 TT:
0005de 13FC 0034       385 	move.b  #'4', LED4      /*ÊñáÂ≠ó‚Äô4‚Äô„ÇíLED„ÅÆ5Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 0029       385 
0005e6 48E7 FFFE       386 	movem.l %d0-%d7/%a0-%a6,-(%SP)		/*„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
0005ea 0C79 0005       387 	cmpi.w #5, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Åß5ÂõûÂÆüË°å„Çí„Ç´„Ç¶„É≥„Éà*/
       0000 0000       387 
0005f2 6700 001C       388 	beq TTKILL				/*5ÂõûÂÆüË°å„Åó„Åü„Çâ„Çø„Ç§„Éû„ÇíÂÅúÊ≠¢*/
                       389 
0005f6 7002            390 	move.l #SYSCALL_NUM_PUTSTRING, %d0
0005f8 7200            391 	move.l #0, %d1				/*ch=0*/
0005fa 243C 0000       392 	move.l #TMSG, %d2			/*p=#TMSG*/
       0000            392 
000600 7608            393 	move.l #8, %d3				/*size=8*/
000602 4E40            394 	trap #0
                       395 
000604 0679 0001       396 	addi.w #1, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Çí1„Å§Â¢ó„ÇÑ„Åô*/
       0000 0000       396 
00060c 6000 0006       397 	bra TTEND				/*„Åù„ÅÆ„Åæ„ÅæÊàª„Çã*/
                       398 
                       399 TTKILL:
000610 7003            400 	move.l #SYSCALL_NUM_RESET_TIMER, %d0	/*RESET_TIMER„ÅÆÂëº„Å≥Âá∫„Åó*/
000612 4E40            401 	trap #0
                       402 TTEND:
000614 4CDF 7FFF       403 	movem.l (%SP)+, %d0-%d7/%a0-%a6		/*„É¨„Ç∏„Çπ„ÇøÂæ©Â∏∞*/
000618 4E75            404 	rts
                       405 
                       406 
                       407 
                       408 
                       409 *****************************************************
                       410 **    Ââ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éï„Çß„Éº„Çπ
                       411 *****************************************************
                       412 uart1_interrupt:
00061a 48E7 F000       413 	movem.l %d0-%d3, -(%sp)
                       414 
                       415 
00061e 3639 00FF       416 	move.w URX1, %d3
       F904            416 
000624 1403            417 	move.b %d3, %d2
000626 0C43 2000       418 	cmp.w #0x2000, %d3
00062a 6400 0086       419 	bcc INTERGET
                       420 
                       421 
00062e 3039 00FF       422 	move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            422 
000634 7200            423 	move.l #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
000636 0C40 8000       424 	cmp.w #0x8000,%d0
00063a 6400 0034       425 	bcc INTERPUT
                       426 
                       427 		
                       428 		
                       429 
00063e 4CDF 000F       430 	movem.l (%sp)+, %d0-%d3
000642 4E73            431 	rte
                       432 
                       433 
                       434 
                       435 
                       436 ************************************************************
                       437 ** „Çø„Ç§„Éû„ÉºÂâ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
                       438 ************************************************************
                       439 
                       440 timer1_interrupt:
000644 13FC 0033       441 	move.b  #'3', LED5      /*ÊñáÂ≠ó‚Äô3‚Äô„ÇíLED„ÅÆ6Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002B       441 
00064c 48E7 0800       442 	movem.l %d4, -(%sp)
                       443 
                       444 /* ‰ª•‰∏ã‰øÆÊ≠£ÈÉ®ÂàÜ */
000650 3839 00FF       445 	move.w TSTAT1, %d4
       F60A            445 
000656 0C44 0001       446 	cmpi.w #0x01, %d4 /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„ÅãÊØîËºÉ */
00065a 6600 000E       447 	bne timer1_end /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„Å™„Çâ„ÄÅrte„ÅßÂæ©Â∏∞ */
00065e 5344            448 	sub.w #0x01, %d4 /* 2.Á¨¨0„Éì„ÉÉ„Éà„Çí0„ÇØ„É™„Ç¢ */
000660 33C4 00FF       449 	move.w %d4, TSTAT1
       F60A            449 
000666 4EBA FEBA       450 	jsr CALL_RP
                       451 /* ‰ª•‰∏ä‰øÆÊ≠£ÈÉ®ÂàÜ */
                       452 
                       453 timer1_end:
                       454 	*move.w %d3, %SR
00066a 4CDF 0010       455 	movem.l (%sp)+, %d4
00066e 4E73            456 	rte
                       457 
                       458 
                       459 
                       460 
                       461 **************************************************************
                       462 ** INTERPUT
                       463 ** ÂºïÊï∞
                       464 ** D1 : „ÉÅ„É£„Éç„É´„ÅÆÈÅ∏Êäû
                       465 ** Êàª„ÇäÂÄ§
                       466 **     „Å™„Åó
                       467 **************************************************************
                       468 
                       469 INTERPUT:
000670 48E7 E000       470 	movem.l %d0-%d2, -(%sp)
                       471 
000674 46FC 2700       472 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       473 	
000678 0C81 0000       474 	cmp.l #0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
       0000            474 
                       475 
00067e 6600 001C       476 	bne INTERPUT_END
                       477 
000682 7001            478 	move.l #1, %d0
                       479 	*move.w #0x0800+'a', UTX1
000684 4EB9 0000       480 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            480 
                       481 
00068a 0C40 0000       482 	cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
00068e 6700 0016       483 	beq INTERPUT_MASK
                       484 	*move.b %d1, %d2
000692 0641 0800       485 	addi.w #0x0800, %d1
                       486 	*move.w #0x0800+'f', UTX1
000696 33C1 00FF       487 	move.w %d1, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            487 
                       488 
                       489 INTERPUT_END:
                       490 	*move.w #0x0800+'c', UTX1
00069c 4CDF 0007       491 	movem.l (%sp)+, %d0-%d2
0006a0 4CDF 000F       492 	movem.l (%sp)+, %d0-%d3
0006a4 4E73            493 	rte
                       494 
                       495 INTERPUT_MASK:
                       496 	*move.w #0x0800+'b', UTX1
0006a6 33FC E108       497 	move.w #0xe108, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       497 
0006ae 6000 FFEC       498 	bra INTERPUT_END
                       499 
                       500 
                       501 *******************************
                       502 **INTERGET
                       503 **d1:„ÉÅ„É£„Éç„É´
                       504 **d2:Âèó‰ø°„Éá„Éº„Çø
                       505 *******************************
                       506 INTERGET:
                       507 	
0006b2 48E7 FFFE       508 	movem.l %a0-%a6/%d0-%d7, -(%SP)
                       509 
0006b6 0C81 0000       510 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            510 
                       511 	
0006bc 6600 0122       512 	bne INTERGET_END
                       513 
0006c0 7000            514 	move.l #0, %d0		/*„Ç≠„É•„ÉºÁï™Âè∑„ÇíË®≠ÂÆö*/
                       515 
0006c2 1202            516 	move.b %d2,%d1		/*„Ç≠„É•„Éº„Å´ÂÖ•„Çå„Çã„Éá„Éº„Çø„Çíd1„Å´Ê†ºÁ¥ç*/
                       517 
                       518 	
                       519 /* TYPE GAME VERSION ========================================== */    
                       520 TYPE_GAME_CHAR_CHECK:
                       521     	
                       522 	
0006c4 43F9 0000       523 	lea.l COUNT_SIZE, %a1
       0000            523 
0006ca 2A11            524 	move.l (%a1), %d5
                       525  	
                       526 
                       527 
                       528     	/* ÂÖ•Âäõ„ÅåÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç*/
0006cc 0C85 0000       529 	cmp.l   #SIZE_hello, %d5
       000B            529 
                       530   	*beq INTERGET_END
0006d2 6700 0108       531 	beq END
                       532 
                       533     	/* ÂèÇÁÖß„Åô„Åπ„ÅçÊñáÂ≠óÂàó„ÇíÁî®ÊÑè„Åô„Çã*/
                       534 
0006d6 43F9 0000       535    	lea.l TXT_hello, %a1
       0000            535 
                       536 	
0006dc D3C5            537 	adda.l %d5, %a1
                       538 		
0006de 1C11            539 	move.b (%a1), %d6
                       540 	 
                       541     	  
                       542 	/* ‰∏ÄËá¥„Åó„Å™„Åë„Çå„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
0006e0 B206            543    	cmp.b  %d6, %d1
0006e2 6600 00D8       544    	bne FAULT
                       545 	
                       546     	/* ÊñáÂ≠ó„ÇíÂá∫Âäõ„Åó„Ç´„Ç¶„É≥„Éà„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà„Åô„Çã */
                       547 	
0006e6 4EB9 0000       548    	jsr INQ
       0000            548 
0006ec 0685 0000       549    	addi.l #1, %d5
       0001            549 
0006f2 23C5 0000       550    	move.l %d5, (COUNT_SIZE)
       0000            550 
                       551 	
                       552 	
                       553 	/* ÂÖ•ÂäõÊàêÂäüË°®Á§∫*/
0006f8 6000 00DC       554 	bra SUCCESS
                       555 
                       556 
                       557 ****************
                       558 ** LED
                       559 ****************
                       560 	
                       561 LED_SET:
0006fc 1C3C 0030       562 	move.b #'0', %d6
000700 1E3C 0030       563 	move.b #'0', %d7
                       564 
                       565 LED_LOOP:
                       566 	
000704 0606 0001       567 	addi.b #0x01, %d6
000708 0C06 003A       568 	cmpi.b #':', %d6
00070c 6700 0006       569 	beq LED_CARRY
000710 6000 000A       570 	bra LED_LOOP_END
                       571 	
                       572 LED_CARRY:
000714 1C3C 0030       573 	move.b #'0', %d6
000718 0607 0001       574 	addi.b #0x01, %d7
                       575 
                       576 LED_LOOP_END:
00071c 5385            577 	subq.l #1, %d5
00071e 6700 0006       578 	beq LED_UPDATE
000722 6000 FFE0       579 	bra LED_LOOP
                       580 
                       581 
                       582 LED_UPDATE:
                       583 
000726 0C84 0000       584 	cmpi.l #0x01, %d4
       0001            584 
00072c 6700 0012       585 	beq LED_UPDATE_FAULT_NUMBER
000730 13C6 00D0       586 	move.b %d6, LED0
       0039            586 
000736 13C7 00D0       587 	move.b %d7, LED1
       003B            587 
00073c 6000 0036       588 	bra LED_GOOD
                       589 
                       590 LED_UPDATE_FAULT_NUMBER:
000740 13C6 00D0       591 	move.b %d6, LED2
       003D            591 
000746 13C7 00D0       592 	move.b %d7, LED3
       003F            592 
00074c 6000 0002       593 	bra LED_BAD
                       594 
                       595 
                       596 LED_BAD:
000750 13FC 0042       597 	move.b #'B', LED7
       00D0 002F       597 
000758 13FC 0041       598 	move.b #'A', LED6
       00D0 002D       598 
000760 13FC 0044       599 	move.b #'D', LED5
       00D0 002B       599 
000768 13FC 0020       600 	move.b #' ', LED4
       00D0 0029       600 
000770 6000 006E       601 	bra INTERGET_END
                       602 	
                       603 LED_GOOD:
000774 13FC 0047       604 	move.b #'G', LED7
       00D0 002F       604 
00077c 13FC 004F       605 	move.b #'O', LED6
       00D0 002D       605 
000784 13FC 004F       606 	move.b #'O', LED5
       00D0 002B       606 
00078c 13FC 0044       607 	move.b #'D', LED4
       00D0 0029       607 
000794 6000 004A       608 	bra INTERGET_END
                       609 
                       610 
                       611 LED_END:
000798 13FC 0045       612 	move.b #'E', LED7
       00D0 002F       612 
0007a0 13FC 004E       613 	move.b #'N', LED6
       00D0 002D       613 
0007a8 13FC 0044       614 	move.b #'D', LED5
       00D0 002B       614 
0007b0 13FC 0021       615 	move.b #'!', LED4
       00D0 0029       615 
0007b8 6000 0026       616 	bra INTERGET_END
                       617 
                       618 
                       619 ****************
                       620 ** typing data
                       621 ****************
                       622 FAULT:
0007bc 43F9 0000       623 	lea.l COUNT_FAULT, %a1
       0000            623 
0007c2 2A11            624 	move.l (%a1), %d5
                       625 
0007c4 0685 0000       626 	addi.l #1, %d5
       0001            626 
0007ca 23C5 0000       627    	move.l %d5, (COUNT_FAULT)
       0000            627 
                       628 
                       629 
                       630 	/* Â§±ÊïóÂõûÊï∞„ÇíË®òÈå≤„Åô„Çã*/
0007d0 7801            631 	move.l #0x01 , %d4
0007d2 6000 FF28       632 	bra LED_SET
                       633 
                       634 SUCCESS:	
0007d6 7800            635 	move.l #0x00 , %d4
0007d8 6000 FF22       636 	bra LED_SET
                       637 
                       638 END:
0007dc 6000 FFBA       639 	bra LED_END	
                       640 /* TYPE GAME VERSION ========================================== */   
                       641 
                       642 INTERGET_END:
0007e0 4CDF 7FFF       643 	movem.l (%SP)+, %a0-%a6/%d0-%d7
0007e4 4CDF 000F       644 	movem.l (%sp)+, %d0-%d3
                       645 	
0007e8 4E73            646 	rte
                       647 
                       648 
                       649 
                       650 *************************************************************
                       651 **PUTSTRING
                       652 **ÂÖ•Âäõ
                       653 **d1:„ÉÅ„É£„Éç„É´
                       654 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       655 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       656 **Êàª„ÇäÂÄ§
                       657 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       658 *************************************************************
                       659 PUTSTRING:
0007ea 48E7 7FFE       660 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       661 
0007ee 0C81 0000       662 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            662 
                       663 	
0007f4 6600 003C       664 	bne PUTSTRING_END
                       665 	
0007f8 7800            666 	move.l #0,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       667 
0007fa 2242            668 	move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ*/
                       669 
0007fc 0C83 0000       670 	cmp.l #0,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            670 
                       671 
000802 6700 002E       672 	beq PUTSTRING_END
                       673 
                       674 LOOP_STEP5:
000806 B684            675 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       676 
000808 6700 001C       677 	beq PUTSTRING_MASK
                       678 
00080c 7001            679 	move.l #1,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       680 
00080e 1219            681 	move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       682 
000810 4EB9 0000       683 	jsr INQ
       0000            683 
                       684 
000816 0C80 0000       685 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            685 
                       686 
00081c 6700 0008       687 	beq PUTSTRING_MASK
                       688 
                       689 
000820 5244            690 	addq #1,%d4		/*sz++*/
                       691 
000822 6000 FFE2       692 	bra LOOP_STEP5
                       693 
                       694 PUTSTRING_MASK:
000826 33FC E10C       695 	move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       695 
                       696 
00082e 6000 0002       697 	bra PUTSTRING_END
                       698 
                       699 PUTSTRING_END:
000832 2004            700 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       701 	
000834 4CDF 7FFE       702 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       703 
000838 4E75            704 	rts 			/*?*/
                       705 
                       706 
                       707 *************************************************************
                       708 **GETSTRING
                       709 **ÂÖ•Âäõ
                       710 **d1:„ÉÅ„É£„Éç„É´
                       711 **d2:„Éá„Éº„ÇøÊõ∏„ÅçËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       712 **d3:Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆÊï∞
                       713 **Êàª„ÇäÂÄ§
                       714 **d0:ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„ÅÆÊï∞
                       715 *************************************************************
                       716 GETSTRING:
                       717 	*move.w #0x0800+'c', UTX1
00083a 48E7 7FFE       718 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       719 
00083e 0C81 0000       720 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            720 
                       721 	
000844 6600 0026       722 	bne GETSTRING_END
                       723 
000848 7800            724 	move.l #0,%d4 		/*%d4=sz:Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       725 
00084a 2242            726 	move.l %d2,%a1 		/*%a1:„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Ç¢„Éâ„É¨„Çπ*/
                       727 
                       728 LOOP_STEP6:
00084c B684            729 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       730 
00084e 6700 001C       731 	beq GETSTRING_END
                       732 	
000852 7000            733 	move.l #0,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       734 	
000854 4EB9 0000       735 	jsr OUTQ
       0000            735 
                       736 	
00085a 0C80 0000       737 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            737 
                       738 
000860 6700 000A       739 	beq GETSTRING_END
                       740 
000864 12C1            741 	move.b %d1,(%a1)+	/*Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„Çí„Ç≥„Éî„Éº*/
                       742 
000866 5244            743 	addq #1,%d4		/*sz++*/
                       744 
000868 6000 FFE2       745 	bra LOOP_STEP6
                       746 
                       747 GETSTRING_END:
00086c 2004            748 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       749 
00086e 4CDF 7FFE       750 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       751 
000872 4E75            752 	rts
                       753 
                       754 
                       755 
                       756 
                       757 ***************************************************************************************************
                       758 ***      QUEUE SETTING
                       759 ***************************************************************************************************
                       760 
                       761 .section .data
                       762 .equ TOP, 0
                       763 .equ BOTTOM, 4
                       764 .equ IN, 8
                       765 .equ OUT, 12
                       766 .equ S, 16
                       767 .equ DATA_TOP, 18
                       768 .equ DATA_LEN, 256
                       769 .equ QUEUE_SIZE, DATA_TOP + DATA_LEN /* 18 + 256 = 274 */
                       770 
000874 0000 0000       771 QUEUE_TOP: ds.b QUEUE_SIZE * 2
       0000 0000       771 
       0000 0000       771 
       0000 0000       771 
       0000 0000       771 
                       772 
                       773 /* ÂàùÊúüÂåñ */
                       774 ********************
                       775 * ÂàùÊúüÂåñ
                       776 ********************
                       777 
                       778 Init_Q:
000a98 48E7 C0E0       779     movem.l %d0-%d1/%a0-%a2, -(%sp) /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÈÄÄÈÅø */
                       780 
000a9c 7000            781     move.l #0, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑ = 0 */
                       782 
                       783 Init_Q_sub:
000a9e 41FA FDD4       784     lea.l QUEUE_TOP, %a0 /* „Ç≠„É•„Éº„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000aa2 2200            785     move.l %d0, %d1
000aa4 C2F8 0112       786     mulu.w QUEUE_SIZE, %d1 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000aa8 D1C1            787     add.l %d1, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000aaa 43E8 0012       788     lea.l DATA_TOP(%a0), %a1 /* a1 = „Ç≠„É•„Éºn„ÅÆ„Éá„Éº„ÇøÈ†òÂüüÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = DATA_TOP + a0
000aae 2089            789     move.l %a1, TOP(%a0) /* „Ç≠„É•„Éºn„ÅÆTOP„ÅÆ„Ç¢„Éâ„É¨„Çπ = a0 + TOP „Åß„ÅÇ„Çã„ÅÆ„Åß„Åù„Åì„Å´a1„Ç
000ab0 2149 0008       790     move.l %a1, IN(%a0) /* „Ç≠„É•„Éºn„ÅÆIN„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000ab4 2149 000C       791     move.l %a1, OUT(%a0) /* „Ç≠„É•„Éºn„ÅÆOUT„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000ab8 43E8 0111       792     lea.l QUEUE_SIZE-1(%a0), %a1 /* a1 == BOTTOM = „Ç≠„É•„Éºn„ÅÆÁµÇÁ´Ø„Ç¢„Éâ„É¨„Çπ */
000abc 2149 0004       793     move.l %a1,BOTTOM(%a0)/*„Ç≠„É•„Éºn„ÅÆBOTTOM„Å´a1„ÇíÊ†ºÁ¥ç*/
000ac0 317C 0000       794     move.w #0, S(%a0) /* „Éá„Éº„ÇøÊï∞ = 0 */
       0010            794 
000ac6 5280            795     addq.l #1, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑++ */
000ac8 0C80 0000       796     cmpi.l #2, %d0 /* „Ç≠„É•„Éº„ÅÆÂÄãÊï∞ÂàÜ(2)„É´„Éº„Éó */
       0002            796 
000ace 6600 FFCE       797     bne Init_Q_sub
                       798 
000ad2 4CDF 0703       799     movem.l (%sp)+, %d0-%d1/%a0-%a2 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
000ad6 4E75            800     rts
                       801 
                       802 
                       803 *****************
                       804 ** INQ
                       805 *****************
                       806 
                       807 **************************************
                       808 **ÂÖ•Âäõ
                       809 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû [long]
                       810 **  d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø [long]
                       811 **Âá∫Âäõ
                       812 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       813 **************************************
                       814 INQ:
                       815 
                       816     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
000ad8 40E7            817     move.w %SR, -(%sp)
                       818 
                       819     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000ada 46FC 2700       820     move.w #0x2700, %SR
                       821 
000ade 48E7 00C0       822     movem.l %a0-%a1, -(%sp)
000ae2 41FA FD90       823     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000ae6 C0F8 0112       824     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000aea D1C0            825     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       826 
000aec 0C68 0100       827     cmpi.w #256, S(%a0)
       0010            827 
000af2 6600 0008       828     bne INQ_1
                       829 
                       830     /* S == 256„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000af6 7000            831     move.l #0, %d0
000af8 6000 0024       832     bra INQ_END
                       833 
                       834 INQ_1:
000afc 2268 0008       835     movea.l IN(%a0), %a1 /* a1 = in */
000b00 1281            836     move.b %d1, (%a1) /* q[in] = d1 */ 
                       837 
000b02 B3E8 0004       838     cmpa.l BOTTOM(%a0), %a1 /* in == bottom „Åã„ÇíÂà§ÂÆö */
000b06 6600 000A       839     bne INQ_ELSE
                       840 
                       841     /* in == bottom „ÅÆ„Å®„Åç*/
000b0a 2150 0008       842     move.l TOP(%a0), IN(%a0) /* in = top */
000b0e 6000 0008       843     bra INQ_2
                       844 
                       845 /* in != bottom „ÅÆ„Å®„Åç*/
                       846 INQ_ELSE:
000b12 5289            847     addq.l #1, %a1 /* a1++ */
000b14 2149 0008       848     move.l %a1, IN(%a0) /* in = a1 */
                       849 
                       850 /* s++, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       851 INQ_2:
000b18 5268 0010       852     addq.w #1, S(%a0)
000b1c 7001            853     move.l #1, %d0
                       854 
                       855 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       856 INQ_END:
000b1e 4CDF 0300       857     movem.l (%sp)+, %a0-%a1 
000b22 46DF            858     move.w (%sp)+, %SR
000b24 4E75            859     rts
                       860 
                       861 
                       862 *****************
                       863 * OUTQ
                       864 *****************
                       865 
                       866 **********************************************
                       867 **ÂÖ•Âäõ
                       868 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû  [long]
                       869 
                       870 **Âá∫Âäõ
                       871 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       872 **  d1:Âèñ„ÇäÁµÑ„Çì„Å†„Éá„Éº„Çø [byte]
                       873 **********************************************
                       874 OUTQ:
                       875     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
000b26 40E7            876     move.w %SR, -(%sp)
                       877 
                       878     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000b28 46FC 2700       879     move.w #0x2700, %SR
                       880 
000b2c 48E7 00C0       881     movem.l %a0-%a1, -(%sp)
000b30 41FA FD42       882     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000b34 C0F8 0112       883     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000b38 D1C0            884     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       885 
000b3a 0C68 0000       886     cmpi.w #0, S(%a0)
       0010            886 
000b40 6600 0008       887     bne OUTQ_1
                       888 
                       889     /* S == 0„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000b44 7000            890     move.l #0, %d0
000b46 6000 0024       891     bra OUTQ_END
                       892 
                       893 OUTQ_1:
000b4a 2268 000C       894     movea.l OUT(%a0), %a1 /* a1 = out */
000b4e 1211            895     move.b (%a1), %d1 /* d1 = q[out] */
                       896 
000b50 B3E8 0004       897     cmpa.l BOTTOM(%a0), %a1 /* out == bottom „Åã„ÇíÂà§ÂÆö */
000b54 6600 000A       898     bne OUTQ_ELSE
                       899 
                       900     /* out == bottom „ÅÆ„Å®„Åç*/
000b58 2150 000C       901     move.l TOP(%a0), OUT(%a0) /* out = top */
000b5c 6000 0008       902     bra OUTQ_2
                       903 
                       904 /* out != bottom „ÅÆ„Å®„Åç*/
                       905 OUTQ_ELSE:
000b60 5289            906     addq.l #1, %a1 /* a1++ */
000b62 2149 000C       907     move.l %a1, OUT(%a0) /* out = a1 */
                       908 
                       909 /* s--, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       910 OUTQ_2:
000b66 5368 0010       911     subq.w #1, S(%a0)
000b6a 7001            912     move.l #1, %d0
                       913 
                       914 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       915 OUTQ_END:
000b6c 4CDF 0300       916     movem.l (%sp)+, %a0-%a1 
000b70 46DF            917     move.w (%sp)+, %SR
000b72 4E75            918     rts
                       919 
                       920 
                       921 ***** 
                       922 
                       923 
                       924 
                       925 ******************************************************
                       926 *** ÂàùÊúüÂåñ„ÅÆ„ÅÇ„Çã„Éá„Éº„ÇøÈ†òÂüü
                       927 ******************************************************
                       928 
                       929 .section .data
                       930 TMSG:
000b74 2A2A 2A2A       931 	.ascii	"******\r\n"			/*r:Ë°åÈ†≠„Å∏,n:ÊîπË°å*/
       2A2A 0D0A       931 
                       932 .even
                       933 TTC:
000b7c 0000            934 	.dc.w 0
                       935 	.even
                       936 
                       937 ********************************
                       938 ** preparation to typing game
                       939 ********************************
                       940 NEW_LINE:
                       941     /* size : 2 */
000b7e 0D0A            942     .ascii "\r\n"
                       943 INTRO:
                       944     /* size : 28*/
000b80 506C 6561       945     .ascii "Please type this sentence!\r\n"
       7365 2074       945 
       7970 6520       945 
       7468 6973       945 
       2073 656E       945 
                       946 TXT_hello:
                       947     /* size : 11*/
000b9c 6865 6C6C       948     .ascii "hello world"
       6F20 776F       948 
       726C 64         948 
                       949 
                       950 .equ SIZE_hello, 11
                       951 
                       952 
                       953 
                       954 ******************************************************
                       955 *** ÂàùÊúüÂåñ„ÅÆ„Å™„ÅÑ„Éá„Éº„ÇøÈ†òÂüü
                       956 ******************************************************
                       957 .section .bss
                       958 COUNT_FAULT:
004ca8 0000 0000       959 	.ds.l 0x01
                       960 COUNT_SIZE:
004cac 0000 0000       961     .ds.l 0x01
                       962 TXT_P:
004cb0 0000 0000       963 	.ds.l 0x01
                       964 TXT_SIZE:
004cb4 0000 0000       965 	.ds.l 0x01
                       966 
                       967 task_p:
004cb8 0000 0000       968 	.ds.l	0x01
                       969 	.even
                       970 
                       971 BUF:
004cbc 0000 0000       972 	.ds.b 256				/*BUF[256]*/
       0000 0000       972 
       0000 0000       972 
       0000 0000       972 
       0000 0000       972 
                       973 	.even
                       974 
                       975 
                       976 
                       977 USR_STK:
004dbc 0000 0000       978 	.ds.b 0x4000				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü*/
       0000 0000       978 
       0000 0000       978 
       0000 0000       978 
       0000 0000       978 
                       979 	.even
                       980 
                       981 USR_STK_TOP:				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ*/
                       982 
                       983 
                       984 
