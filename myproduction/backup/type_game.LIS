                         4 .list
                         5 /* ÂàùÊúüÂåñ*/
                         6 
                         7 		***************************************************************
                         8 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         9 		***************************************************************
                        10 
                        11 		***************
                        12 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        13 		***************
                        14 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        15 		.equ IOBASE,    0x00d00000
                        16 
                        17 		***************
                        18 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        19 		***************
                        20 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        21 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        22 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        23 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        24 
                        25 		***************
                        26 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        27 		***************
                        28 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        29 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        30 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        31 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        32 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        33 
                        34 		***************
                        35 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        36 		***************
                        37 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        38 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        39 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        40 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        41 
                        42 		***************
                        43 		** LED
                        44 		***************
                        45 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        46 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        47 		.equ LED5,      IOBASE+0x000002b
                        48 		.equ LED4,      IOBASE+0x0000029
                        49 		.equ LED3,      IOBASE+0x000003f
                        50 		.equ LED2,      IOBASE+0x000003d
                        51 		.equ LED1,      IOBASE+0x000003b
                        52 		.equ LED0,      IOBASE+0x0000039
                        53 
                        54 		***************************************************************
                        55 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        56 		***************************************************************
                        57 		.section .bss
                        58 		.even
                        59 SYS_STK:
000b3c 0000 0000        60 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
                        61 		.even
                        62 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
004b3c 0000 0000        63 		WORK: .ds.b 256 /*step6_test*/
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
                        64 		***************************************************************
                        65 		** ÂàùÊúüÂåñ
                        66 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        67 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        68 		***************************************************************
                        69 		.section .text
                        70 		.even
                        71 boot:
                        72 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        73 		move.w #0x2700,%SR
000404 4FF9 0000        74 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             74 
                        75 
                        76 		****************
                        77 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        78 		****************
00040a 13FC 0040        79 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        79 
000412 23FC 00FF        80 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        80 
       F304             80 
                        81 
                        82 		****************
                        83 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        84 		****************
00041c 33FC 0000        85 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        85 
000424 33FC E108        86 		move.w #0xe108, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        86 
00042c 33FC 0038        87 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        87 
                        88 
                        89 		****************
                        90 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        91 		****************
000434 33FC 0004        92 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        92 
                        93 
                        94 		***************************************************************
                        95 		** STEP2„ÅÆÂá¶ÁêÜ
                        96 		***************************************************************
                        97 		*lea.l uart1_interrupt, %a0
                        98 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 23FC 00FF        99 		move.l #0x00ff3ff9,IMR  |UART1Ë®±ÂèØ
       3FF9 00FF        99 
       F304             99 
                       100 
                       101 		/*trap #0„Å´ÁôªÈå≤*/
000446 21FC 0000       102 		move.l #CALL_SYSTEM, 0x080
       0000 0080       102 
                       103 
00044e 21FC 0000       104 		move.l #uart1_interrupt, 0x110
       0000 0110       104 
000456 21FC 0000       105 		move.l #timer1_interrupt, 0x118 /* „Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„ÅÆÁôªÈå≤ */
       0000 0118       105 
                       106 		
                       107 
                       108 		
                       109 
                       110         	/* Queue initialize */
00045e 4EB9 0000       111         	jsr Init_Q
       0000            111 
                       112 
                       113 		*LED_CLEAR:
000464 13FC 0020       114 		move.b #' ', LED0
       00D0 0039       114 
00046c 13FC 0020       115 		move.b #' ', LED1
       00D0 003B       115 
000474 13FC 0020       116 		move.b #' ', LED2
       00D0 003D       116 
00047c 13FC 0020       117 		move.b #' ', LED3
       00D0 003F       117 
000484 13FC 0020       118 		move.b #' ', LED4
       00D0 0029       118 
00048c 13FC 0020       119 		move.b #' ', LED5
       00D0 002B       119 
000494 13FC 0020       120 		move.b #' ', LED6
       00D0 002D       120 
00049c 13FC 0020       121 		move.b #' ', LED7
       00D0 002F       121 
                       122 
                       123 
                       124 		/*step9„ÅÆMAIN„Å∏*/
0004a4 6000 00C4       125 		bra MAIN		
                       126 
                       127 
                       128 
                       129 /*trap #0„Åß„ÅÆÂá¶ÁêÜ,SYSTEMCALL*/
                       130 CALL_SYSTEM:
                       131 	*move.w #0x2000, %SR /* „Åì„ÅÑ„Å§„ÅÆ„Åõ„ÅÑ„Åß„ÄÅ„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Ç®„É©„ÉºÁô∫Áîü */
                       132 
0004a8 0C40 0001       133 	cmpi #1, %d0
0004ac 6600 000A       134 	bne CALL_PUT
                       135 
                       136 	*lea.l GETSTRING, %a0
                       137 	*move.l (%a0), %d0
                       138 	*jmp (%a0)
                       139 	
0004b0 4EBA 031C       140 	jsr GETSTRING	
                       141 	
0004b4 6000 0032       142 	bra CALL_END
                       143 
                       144 CALL_PUT:
0004b8 0C40 0002       145 	cmpi #2, %d0
0004bc 6600 000A       146 	bne CALL_RESET
                       147 
                       148 	*lea.l PUTSTRING, %a0
                       149 	*move.l (%a0), %d0
                       150 	*jmp %a0
                       151 
0004c0 4EBA 02BC       152 	jsr PUTSTRING
                       153 
0004c4 6000 0022       154 	bra CALL_END
                       155 
                       156 
                       157 CALL_RESET:
0004c8 0C40 0003       158 	cmpi #3, %d0
0004cc 6600 000A       159 	bne CALL_SET
                       160 	
                       161 	*lea.l RESET_TIMER, %a0
                       162 	*move.l (%a0), %d0
                       163 	*jmp (%a0)
                       164 	
0004d0 4EBA 0018       165 	jsr RESET_TIMER
                       166 	
0004d4 6000 0012       167 	bra CALL_END
                       168 
                       169 CALL_SET:
0004d8 0C40 0004       170 	cmpi #4, %d0
0004dc 6600 000A       171 	bne CALL_END
                       172 
                       173 	*lea.l SET_TIMER, %a0
                       174 	*move.l (%a0), %d0
                       175 	*jmp (%a0)
                       176 	
0004e0 4EBA 001A       177 	jsr SET_TIMER
                       178 	
0004e4 6000 0002       179 	bra CALL_END
                       180 
                       181 
                       182 CALL_END:
0004e8 4E73            183 	rte /* ‚òì rte -> rts */
                       184 
                       185 
                       186 
                       187 *****************************************************************************************
                       188 ** TIMER SETTING
                       189 *****************************************************************************************
                       190 
                       191 ************************************************************* 
                       192 **RESET_TIMER 
                       193 **Ê©üËÉΩ 
                       194 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã 
                       195 ************************************************************* 
                       196 
                       197 RESET_TIMER: 
0004ea 13FC 0035       198 	move.b  #'5', LED3      /*ÊñáÂ≠ó‚Äô5‚Äô„ÇíLED„ÅÆ4Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 003F       198 
0004f2 33FC 0004       199 	move.w #0x0004, TCTL1 /* 1.TCTL1„Çí„Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢„Å´Ë®≠ÂÆö */ 
       00FF F600       199 
0004fa 4E75            200 	rts
                       201 
                       202 
                       203   
                       204 ************************************************************* 
                       205 **SET_TIMER 
                       206 **Ê©üËÉΩ 
                       207 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âëº„Å≥
                       208 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÂë®Êúüt„ÇíË®≠ÂÆö„ÅóÔºåt*0.1msecÁßíÊØé„Å´Ââ≤„ÇäËæº„Åø„ÅåÁô∫Áîü„Åô„Çã„Çà„ÅÜ„Å
                       209 **	„Çø„Ç§„Éû‰ΩøÁî®„ÇíË®±ÂèØ„ÅóÔºå„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„ÇíË®±ÂèØ„Åô„ÇãÔºé(=„Çø„Ç§„Éû„Çí„Çπ„Çø„Éº„Éà„
                       210 **ÂÖ•Âäõ 
                       211 **	d1:„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü 
                       212 **	d2:Ââ≤„ÇäËæº„ÅøÊôÇ„Å´Ëµ∑Âãï„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       213 **Êàª„ÇäÂÄ§ 
                       214 **	„Å™„Åó 
                       215 *************************************************************
                       216   
                       217 
                       218 SET_TIMER:
0004fc 13FC 0031       219 	move.b  #'1', LED7      /*ÊñáÂ≠ó‚Äô1‚Äô„ÇíLED„ÅÆ8Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002F       219 
000504 23C2 0000       220 	move.l %d2, task_p /* 1.Ââ≤„ÇäËæº„Åø„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„ÇíÔºåtask_p„Å´‰ª£ÂÖ• „Å°„Çá„
       0000            220 
00050a 33FC 00CE       221 	move.w #0x00ce, TPRER1 /* 2.TPRER1„Çí„ÄÅ0.1msecÈÄ≤„ÇÄ„Å®„Ç´„Ç¶„É≥„Çø„Åå1Â¢ó„Åà„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö *
       00FF F602       221 
000512 33C1 00FF       222 	move.w %d1, TCMP1 /* 3.„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü„ÇíÔºåTCMP1„Å´‰ª£ÂÖ• Ë¶Å‰øÆÊ≠£ */ 
       F604            222 
000518 33FC 0015       223 	move.w #0x0015, TCTL1 /* 4.TCTL1„ÇíÂâ≤„ÇäËæº„ÅøË®±ÂèØ„Å´Ë®≠ÂÆö */  
       00FF F600       223 
000520 4E75            224 	rts
                       225 
                       226 ************************************************************* 
                       227 **CALL_RP 
                       228 **Ê©üËÉΩ 
                       229 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âá¶ÁêÜ„Åô„Åπ„Åç„É´„Éº„ÉÅ„É≥„ÇíÂëº„Å≥Âá∫„Åô 
                       230 ************************************************************* 
                       231 
                       232 CALL_RP: 
000522 13FC 0032       233 	move.b  #'2', LED6      /*ÊñáÂ≠ó‚Äô2‚Äô„ÇíLED„ÅÆ7Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002D       233 
00052a 2079 0000       234 	movea.l task_p, %a0
       0000            234 
000530 4E90            235 	jsr (%a0)
                       236 	*jsr task_p /* 1.task_p„ÅÆÊåá„Åô„Ç¢„Éâ„É¨„Çπ„Å∏„Ç∏„É£„É≥„Éó„Åô„Çã „Åì„ÅìËá™‰ø°„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„Å™„Ç
000532 4E75            237 	rts /* Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„Å´Êàª„Çã */ 
                       238 
                       239  
                       240 ************************************************************* 
                       241 **p 
                       242 **Ê©üËÉΩ 
                       243 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥ 
                       244 **Â§öÂàÜÂêÑËá™„Åß‰ΩúÊàê (Ë™≤È°å10) 
                       245 ************************************************************* 
                       246 *p: 
                       247 	*rts /* CALL_RP„Å´Êàª„Çã */ 
                       248  
                       249 
                       250 
                       251 
                       252 ***************************************************************************************************
                       253 **   CALL SETTING
                       254 ***************************************************************************************************
                       255 /*ÂêÑ„Ç∑„Çπ„ÉÜ„É†„ÅÆÂëº„Å≥Âá∫„Åó,t„ÉÜ„Çπ„Éà„Åß„ÅØMAIN„Å´„ÅÇ„Çã„Åü„ÇÅ‰ΩøÁî®„Åó„Å™„ÅÑ?*/
                       256 /*GETSTRINGÂëº„Å≥Âá∫„Åó*/
                       257 CALL_GETSTRING:
000534 7001            258 	move.l #1, %d0		/*GETSTRING*/
000536 7200            259 	move.l #0,%d1		/*ch=0*/
000538 243C 0000       260 	move.l #BUF, %d2	/*p=#BUF*/
       0000            260 
00053e 263C 0000       261 	move.l #256, %d3	/*size=256*/
       0100            261 
000544 4E40            262 	trap #0
                       263 
                       264 /*PUTSTRINGÂëº„Å≥Âá∫„Åó*/
                       265 CALL_PUTSTRING:
000546 7002            266 	move.l #2, %d0		/*PUTSTRING*/
000548 7200            267 	move.l #0,%d1		/*ch=0*/
00054a 243C 0000       268 	move.l #BUF, %d2	/*p=#BUF*/
       0000            268 
000550 263C 0000       269 	move.l #256, %d3	/*size=256*/
       0100            269 
000556 4E40            270 	trap #0
                       271 
                       272 /*RESET_TIMERÂëº„Å≥Âá∫„Åó*/
                       273 CALL_RESET_TIMER:
000558 7003            274 	move.l #3, %d0		/*RESET_TIMER*/
00055a 4E40            275 	trap #0
                       276 
                       277 /*SET_TIMERÂëº„Å≥Âá∫„Åó*/
                       278 CALL_SET_TIMER:
00055c 7004            279 	move.l #4, %d0		/*SET_TIMER*/
00055e 323C C350       280 	move.w #50000, %d1		/*d1=„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü*/
000562 243C 0000       281 	move.l #TT, %d2		/*„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπd2=#TT*/
       0000            281 
000568 4E40            282 	trap #0
                       283 
                       284 
                       285 /*‰ª•‰∏ästep8*/
                       286 
                       287 
                       288 
                       289 
                       290 
                       291 ******************************************************
                       292 ***„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´Áï™Âè∑
                       293 ******************************************************
                       294 	.equ SYSCALL_NUM_GETSTRING,	1
                       295 	.equ SYSCALL_NUM_PUTSTRING,	2
                       296 	.equ SYSCALL_NUM_RESET_TIMER,	3
                       297 	.equ SYSCALL_NUM_SET_TIMER,	4
                       298 
                       299 
                       300 ******************************************************
                       301 ***„Éó„É≠„Ç∞„É©„É†È†òÂüü
                       302 ******************************************************
                       303 .section .text
                       304 .even
                       305 MAIN:						/*Ëµ∞Ë°å„É¢„Éº„Éâ„Å®„É¨„Éô„É´„ÅÆË®≠ÂÆö(„É¶„Éº„Ç∂„É¢„Éº„Éâ„Å∏ÁßªË°å)*/
                       306 
00056a 46FC 0000       307 	move.w #0x0000, %SR				/*USER_MODE_LEBEL„Çí0„Å´*/
00056e 4FF9 0000       308 	lea.l USR_STK_TOP, %SP				/*USER_STACK„ÇíË®≠ÂÆö*/
       0000            308 
                       309 
                       310 
                       311     
                       312 	*move.l #SYSCALL_NUM_RESET_TIMER, %d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßRESET_TIMER„ÅÆËµ∑Âãï*/
                       313 	*trap #0
                       314 
                       315 
                       316 	*move.l #SYSCALL_NUM_SET_TIMER,%d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßSET_TIMER„ÅÆËµ∑Âãï*/
                       317 	*move.w #50000, %d1
                       318 	*move.l #TT, %d2
                       319 	*trap #0
                       320 
                       321 	*bra LOOP
                       322 	
                       323 ** !! *********************************
                       324 ** Typing Game routine
                       325 ** !! *********************************
                       326 
                       327 TYPE_GAME_INTRO:
000574 7002            328    	move.l #SYSCALL_NUM_PUTSTRING, %d0
000576 7200            329 	move.l #0, %d1				/*ch=0*/
000578 243C 0000       330 	move.l #INTRO, %d2			/*p=#INTRO*/
       0000            330 
00057e 761C            331 	move.l #28, %d3				/*size=8*/
000580 4E40            332 	trap #0
                       333 
                       334 TYPE_GAME_PRINT_TXT:
000582 7002            335     	move.l #SYSCALL_NUM_PUTSTRING, %d0
000584 7200            336 	move.l #0, %d1				/*ch=0*/
000586 243C 0000       337 	move.l #TXT_hello, %d2			/*p=#INTRO*/
       0000            337 
00058c 263C 0000       338 	move.l #SIZE_hello, %d3				/*size=8*/
       000B            338 
000592 4E40            339 	trap #0
                       340 
                       341 TYPE_GAME_PRINT_NEW_LINE:
000594 7002            342     	move.l #SYSCALL_NUM_PUTSTRING, %d0
000596 7200            343 	move.l #0, %d1				/*ch=0*/
000598 243C 0000       344 	move.l #NEW_LINE, %d2			/*p=#INTRO*/
       0000            344 
00059e 7602            345 	move.l #2, %d3				/*size=8*/
0005a0 4E40            346 	trap #0
                       347 
                       348 TYPE_GAME_SETTING:
0005a2 23FC 0000       349 	move.l #0, (COUNT_SIZE)
       0000 0000       349 
       0000            349 
0005ac 6000 0002       350     	bra LOOP
                       351 
                       352 
                       353 
                       354 
                       355 
                       356 ******************************************************
                       357 ***sys_GETSTRING,SYS_PUTSTRING„ÅÆ„ÉÜ„Çπ„Éà
                       358 ***„Çø„Éº„Éü„Éä„É´„ÅÆÂÖ•Âäõ„Çí„Ç®„Ç≥„Éº„Éê„ÉÉ„ÇØ
                       359 ******************************************************
                       360 
                       361 LOOP:
0005b0 7001            362 	move.l #SYSCALL_NUM_GETSTRING, %d0	/*GETSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
0005b2 7200            363 	move.l #0, %d1				/*ch=0*/
0005b4 243C 0000       364 	move.l #BUF, %d2			/*p=#BUF*/
       0000            364 
0005ba 263C 0000       365 	move.l #256, %d3			/*size=256*/
       0100            365 
0005c0 4E40            366 	trap #0
                       367 
                       368 
0005c2 2600            369 	move.l %d0, %d3				/*size=d0*/
0005c4 7002            370 	move.l #SYSCALL_NUM_PUTSTRING, %d0	/*PUTSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
0005c6 7200            371 	move.l #0, %d1				/*ch=0*/
0005c8 243C 0000       372 	move.l #BUF, %d2			/*p=#BUF*/
       0000            372 
0005ce 4E40            373 	trap #0
                       374 
0005d0 6000 FFDE       375 	bra LOOP
                       376 
                       377 ******************************************************
                       378 ***„Çø„Ç§„Éû„ÅÆ„ÉÜ„Çπ„Éà
                       379 ***'******'„ÇíË°®Á§∫„ÅóÊîπË°å
                       380 ***5ÂõûÂÆüË°å„Åó„Å¶RESET_TIMER
                       381 ******************************************************
                       382 
                       383 TT:
0005d4 13FC 0034       384 	move.b  #'4', LED4      /*ÊñáÂ≠ó‚Äô4‚Äô„ÇíLED„ÅÆ5Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 0029       384 
0005dc 48E7 FFFE       385 	movem.l %d0-%d7/%a0-%a6,-(%SP)		/*„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
0005e0 0C79 0005       386 	cmpi.w #5, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Åß5ÂõûÂÆüË°å„Çí„Ç´„Ç¶„É≥„Éà*/
       0000 0000       386 
0005e8 6700 001C       387 	beq TTKILL				/*5ÂõûÂÆüË°å„Åó„Åü„Çâ„Çø„Ç§„Éû„ÇíÂÅúÊ≠¢*/
                       388 
0005ec 7002            389 	move.l #SYSCALL_NUM_PUTSTRING, %d0
0005ee 7200            390 	move.l #0, %d1				/*ch=0*/
0005f0 243C 0000       391 	move.l #TMSG, %d2			/*p=#TMSG*/
       0000            391 
0005f6 7608            392 	move.l #8, %d3				/*size=8*/
0005f8 4E40            393 	trap #0
                       394 
0005fa 0679 0001       395 	addi.w #1, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Çí1„Å§Â¢ó„ÇÑ„Åô*/
       0000 0000       395 
000602 6000 0006       396 	bra TTEND				/*„Åù„ÅÆ„Åæ„ÅæÊàª„Çã*/
                       397 
                       398 TTKILL:
000606 7003            399 	move.l #SYSCALL_NUM_RESET_TIMER, %d0	/*RESET_TIMER„ÅÆÂëº„Å≥Âá∫„Åó*/
000608 4E40            400 	trap #0
                       401 TTEND:
00060a 4CDF 7FFF       402 	movem.l (%SP)+, %d0-%d7/%a0-%a6		/*„É¨„Ç∏„Çπ„ÇøÂæ©Â∏∞*/
00060e 4E75            403 	rts
                       404 
                       405 
                       406 
                       407 
                       408 *****************************************************
                       409 **    Ââ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éï„Çß„Éº„Çπ
                       410 *****************************************************
                       411 uart1_interrupt:
000610 48E7 F000       412 	movem.l %d0-%d3, -(%sp)
                       413 
                       414 
000614 3639 00FF       415 	move.w URX1, %d3
       F904            415 
00061a 1403            416 	move.b %d3, %d2
00061c 0C43 2000       417 	cmp.w #0x2000, %d3
000620 6400 0086       418 	bcc INTERGET
                       419 
                       420 
000624 3039 00FF       421 	move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            421 
00062a 7200            422 	move.l #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
00062c 0C40 8000       423 	cmp.w #0x8000,%d0
000630 6400 0034       424 	bcc INTERPUT
                       425 
                       426 		
                       427 		
                       428 
000634 4CDF 000F       429 	movem.l (%sp)+, %d0-%d3
000638 4E73            430 	rte
                       431 
                       432 
                       433 
                       434 
                       435 ************************************************************
                       436 ** „Çø„Ç§„Éû„ÉºÂâ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
                       437 ************************************************************
                       438 
                       439 timer1_interrupt:
00063a 13FC 0033       440 	move.b  #'3', LED5      /*ÊñáÂ≠ó‚Äô3‚Äô„ÇíLED„ÅÆ6Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002B       440 
000642 48E7 0800       441 	movem.l %d4, -(%sp)
                       442 
                       443 /* ‰ª•‰∏ã‰øÆÊ≠£ÈÉ®ÂàÜ */
000646 3839 00FF       444 	move.w TSTAT1, %d4
       F60A            444 
00064c 0C44 0001       445 	cmpi.w #0x01, %d4 /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„ÅãÊØîËºÉ */
000650 6600 000E       446 	bne timer1_end /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„Å™„Çâ„ÄÅrte„ÅßÂæ©Â∏∞ */
000654 5344            447 	sub.w #0x01, %d4 /* 2.Á¨¨0„Éì„ÉÉ„Éà„Çí0„ÇØ„É™„Ç¢ */
000656 33C4 00FF       448 	move.w %d4, TSTAT1
       F60A            448 
00065c 4EBA FEC4       449 	jsr CALL_RP
                       450 /* ‰ª•‰∏ä‰øÆÊ≠£ÈÉ®ÂàÜ */
                       451 
                       452 timer1_end:
                       453 	*move.w %d3, %SR
000660 4CDF 0010       454 	movem.l (%sp)+, %d4
000664 4E73            455 	rte
                       456 
                       457 
                       458 
                       459 
                       460 **************************************************************
                       461 ** INTERPUT
                       462 ** ÂºïÊï∞
                       463 ** D1 : „ÉÅ„É£„Éç„É´„ÅÆÈÅ∏Êäû
                       464 ** Êàª„ÇäÂÄ§
                       465 **     „Å™„Åó
                       466 **************************************************************
                       467 
                       468 INTERPUT:
000666 48E7 E000       469 	movem.l %d0-%d2, -(%sp)
                       470 
00066a 46FC 2700       471 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       472 	
00066e 0C81 0000       473 	cmp.l #0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
       0000            473 
                       474 
000674 6600 001C       475 	bne INTERPUT_END
                       476 
000678 7001            477 	move.l #1, %d0
                       478 	*move.w #0x0800+'a', UTX1
00067a 4EB9 0000       479 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            479 
                       480 
000680 0C40 0000       481 	cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
000684 6700 0016       482 	beq INTERPUT_MASK
                       483 	*move.b %d1, %d2
000688 0641 0800       484 	addi.w #0x0800, %d1
                       485 	*move.w #0x0800+'f', UTX1
00068c 33C1 00FF       486 	move.w %d1, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            486 
                       487 
                       488 INTERPUT_END:
                       489 	*move.w #0x0800+'c', UTX1
000692 4CDF 0007       490 	movem.l (%sp)+, %d0-%d2
000696 4CDF 000F       491 	movem.l (%sp)+, %d0-%d3
00069a 4E73            492 	rte
                       493 
                       494 INTERPUT_MASK:
                       495 	*move.w #0x0800+'b', UTX1
00069c 33FC E108       496 	move.w #0xe108, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       496 
0006a4 6000 FFEC       497 	bra INTERPUT_END
                       498 
                       499 
                       500 *******************************
                       501 **INTERGET
                       502 **d1:„ÉÅ„É£„Éç„É´
                       503 **d2:Âèó‰ø°„Éá„Éº„Çø
                       504 *******************************
                       505 INTERGET:
                       506 	
0006a8 48E7 FFFE       507 	movem.l %a0-%a6/%d0-%d7, -(%SP)
                       508 
0006ac 0C81 0000       509 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            509 
                       510 	
0006b2 6600 00C0       511 	bne INTERGET_END
                       512 
0006b6 7000            513 	move.l #0, %d0		/*„Ç≠„É•„ÉºÁï™Âè∑„ÇíË®≠ÂÆö*/
                       514 
0006b8 1202            515 	move.b %d2,%d1		/*„Ç≠„É•„Éº„Å´ÂÖ•„Çå„Çã„Éá„Éº„Çø„Çíd1„Å´Ê†ºÁ¥ç*/
                       516 
                       517 	
                       518 /* TYPE GAME VERSION ========================================== */    
                       519 TYPE_GAME_CHAR_CHECK:
                       520     	
                       521 	
0006ba 43F9 0000       522 	lea.l COUNT_SIZE, %a1
       0000            522 
0006c0 2A11            523 	move.l (%a1), %d5
                       524  	
                       525 
                       526 
                       527     	/* ÂÖ•Âäõ„ÅåÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç*/
0006c2 0C85 0000       528 	cmp.l   #SIZE_hello, %d5
       000B            528 
0006c8 6700 00AA       529   	beq INTERGET_END
                       530 	
                       531 
                       532     	/* ÂèÇÁÖß„Åô„Åπ„ÅçÊñáÂ≠óÂàó„ÇíÁî®ÊÑè„Åô„Çã*/
                       533 
0006cc 43F9 0000       534    	lea.l TXT_hello, %a1
       0000            534 
                       535 	
0006d2 D3C5            536 	adda.l %d5, %a1
                       537 		
0006d4 1C11            538 	move.b (%a1), %d6
                       539 	 
                       540     	  
                       541 	/* ‰∏ÄËá¥„Åó„Å™„Åë„Çå„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
0006d6 B206            542    	cmp.b  %d6, %d1
0006d8 6600 0052       543    	bne LED_BAD
                       544 	
                       545     	/* ÊñáÂ≠ó„ÇíÂá∫Âäõ„Åó„Ç´„Ç¶„É≥„Éà„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà„Åô„Çã */
                       546 	
0006dc 4EB9 0000       547    	jsr INQ
       0000            547 
0006e2 0685 0000       548    	addi.l #1, %d5
       0001            548 
0006e8 23C5 0000       549    	move.l %d5, (COUNT_SIZE)
       0000            549 
                       550 	
                       551 	/* ÂÖ•ÂäõÊàêÂäüË°®Á§∫*/
0006ee 6000 0060       552 	bra LED_GOOD
                       553 
                       554 
                       555 ****************
                       556 ** LED
                       557 ****************
                       558 	
                       559 LED_SET:
0006f2 1C3C 0030       560 	move.b #'0', %d6
0006f6 1E3C 0030       561 	move.b #'0', %d7
                       562 
                       563 LED_LOOP:
                       564 	
0006fa 0606 0001       565 	addi.b #0x01, %d6
0006fe 0C06 003A       566 	cmpi.b #':', %d6
000702 6700 0006       567 	beq LED_CARRY
000706 6000 000A       568 	bra LED_LOOP_END
                       569 	
                       570 LED_CARRY:
00070a 1C3C 0030       571 	move.b #'0', %d6
00070e 0607 0001       572 	addi.b #0x01, %d7
                       573 
                       574 LED_LOOP_END:
000712 5385            575 	subq.l #1, %d5
000714 6700 0006       576 	beq LED_UPDATE
000718 6000 FFE0       577 	bra LED_LOOP
                       578 
                       579 
                       580 LED_UPDATE:
00071c 13C6 00D0       581 	move.b %d6, LED0
       0039            581 
000722 13C7 00D0       582 	move.b %d7, LED1
       003B            582 
000728 6000 004A       583 	bra INTERGET_END
                       584 
                       585 LED_BAD:
00072c 13FC 0042       586 	move.b #'B', LED7
       00D0 002F       586 
000734 13FC 0041       587 	move.b #'A', LED6
       00D0 002D       587 
00073c 13FC 0044       588 	move.b #'D', LED5
       00D0 002B       588 
000744 13FC 0020       589 	move.b #' ', LED4
       00D0 0029       589 
00074c 6000 0026       590 	bra INTERGET_END
                       591 	
                       592 LED_GOOD:
000750 13FC 0047       593 	move.b #'G', LED7
       00D0 002F       593 
000758 13FC 004F       594 	move.b #'O', LED6
       00D0 002D       594 
000760 13FC 004F       595 	move.b #'O', LED5
       00D0 002B       595 
000768 13FC 0044       596 	move.b #'D', LED4
       00D0 0029       596 
000770 6000 FF80       597 	bra LED_SET
                       598 	
                       599 		
                       600 /* TYPE GAME VERSION ========================================== */   
                       601 
                       602 INTERGET_END:
000774 4CDF 7FFF       603 	movem.l (%SP)+, %a0-%a6/%d0-%d7
000778 4CDF 000F       604 	movem.l (%sp)+, %d0-%d3
                       605 	
00077c 4E73            606 	rte
                       607 
                       608 
                       609 
                       610 *************************************************************
                       611 **PUTSTRING
                       612 **ÂÖ•Âäõ
                       613 **d1:„ÉÅ„É£„Éç„É´
                       614 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       615 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       616 **Êàª„ÇäÂÄ§
                       617 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       618 *************************************************************
                       619 PUTSTRING:
00077e 48E7 7FFE       620 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       621 
000782 0C81 0000       622 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            622 
                       623 	
000788 6600 003C       624 	bne PUTSTRING_END
                       625 	
00078c 7800            626 	move.l #0,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       627 
00078e 2242            628 	move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ*/
                       629 
000790 0C83 0000       630 	cmp.l #0,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            630 
                       631 
000796 6700 002E       632 	beq PUTSTRING_END
                       633 
                       634 LOOP_STEP5:
00079a B684            635 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       636 
00079c 6700 001C       637 	beq PUTSTRING_MASK
                       638 
0007a0 7001            639 	move.l #1,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       640 
0007a2 1219            641 	move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       642 
0007a4 4EB9 0000       643 	jsr INQ
       0000            643 
                       644 
0007aa 0C80 0000       645 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            645 
                       646 
0007b0 6700 0008       647 	beq PUTSTRING_MASK
                       648 
                       649 
0007b4 5244            650 	addq #1,%d4		/*sz++*/
                       651 
0007b6 6000 FFE2       652 	bra LOOP_STEP5
                       653 
                       654 PUTSTRING_MASK:
0007ba 33FC E10C       655 	move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       655 
                       656 
0007c2 6000 0002       657 	bra PUTSTRING_END
                       658 
                       659 PUTSTRING_END:
0007c6 2004            660 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       661 	
0007c8 4CDF 7FFE       662 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       663 
0007cc 4E75            664 	rts 			/*?*/
                       665 
                       666 
                       667 *************************************************************
                       668 **GETSTRING
                       669 **ÂÖ•Âäõ
                       670 **d1:„ÉÅ„É£„Éç„É´
                       671 **d2:„Éá„Éº„ÇøÊõ∏„ÅçËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       672 **d3:Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆÊï∞
                       673 **Êàª„ÇäÂÄ§
                       674 **d0:ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„ÅÆÊï∞
                       675 *************************************************************
                       676 GETSTRING:
                       677 	*move.w #0x0800+'c', UTX1
0007ce 48E7 7FFE       678 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       679 
0007d2 0C81 0000       680 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            680 
                       681 	
0007d8 6600 0026       682 	bne GETSTRING_END
                       683 
0007dc 7800            684 	move.l #0,%d4 		/*%d4=sz:Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       685 
0007de 2242            686 	move.l %d2,%a1 		/*%a1:„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Ç¢„Éâ„É¨„Çπ*/
                       687 
                       688 LOOP_STEP6:
0007e0 B684            689 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       690 
0007e2 6700 001C       691 	beq GETSTRING_END
                       692 	
0007e6 7000            693 	move.l #0,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       694 	
0007e8 4EB9 0000       695 	jsr OUTQ
       0000            695 
                       696 	
0007ee 0C80 0000       697 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            697 
                       698 
0007f4 6700 000A       699 	beq GETSTRING_END
                       700 
0007f8 12C1            701 	move.b %d1,(%a1)+	/*Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„Çí„Ç≥„Éî„Éº*/
                       702 
0007fa 5244            703 	addq #1,%d4		/*sz++*/
                       704 
0007fc 6000 FFE2       705 	bra LOOP_STEP6
                       706 
                       707 GETSTRING_END:
000800 2004            708 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       709 
000802 4CDF 7FFE       710 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       711 
000806 4E75            712 	rts
                       713 
                       714 
                       715 
                       716 
                       717 ***************************************************************************************************
                       718 ***      QUEUE SETTING
                       719 ***************************************************************************************************
                       720 
                       721 .section .data
                       722 .equ TOP, 0
                       723 .equ BOTTOM, 4
                       724 .equ IN, 8
                       725 .equ OUT, 12
                       726 .equ S, 16
                       727 .equ DATA_TOP, 18
                       728 .equ DATA_LEN, 256
                       729 .equ QUEUE_SIZE, DATA_TOP + DATA_LEN /* 18 + 256 = 274 */
                       730 
000808 0000 0000       731 QUEUE_TOP: ds.b QUEUE_SIZE * 2
       0000 0000       731 
       0000 0000       731 
       0000 0000       731 
       0000 0000       731 
                       732 
                       733 /* ÂàùÊúüÂåñ */
                       734 ********************
                       735 * ÂàùÊúüÂåñ
                       736 ********************
                       737 
                       738 Init_Q:
000a2c 48E7 C0E0       739     movem.l %d0-%d1/%a0-%a2, -(%sp) /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÈÄÄÈÅø */
                       740 
000a30 7000            741     move.l #0, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑ = 0 */
                       742 
                       743 Init_Q_sub:
000a32 41FA FDD4       744     lea.l QUEUE_TOP, %a0 /* „Ç≠„É•„Éº„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000a36 2200            745     move.l %d0, %d1
000a38 C2F8 0112       746     mulu.w QUEUE_SIZE, %d1 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000a3c D1C1            747     add.l %d1, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000a3e 43E8 0012       748     lea.l DATA_TOP(%a0), %a1 /* a1 = „Ç≠„É•„Éºn„ÅÆ„Éá„Éº„ÇøÈ†òÂüüÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = DATA_TOP + a0
000a42 2089            749     move.l %a1, TOP(%a0) /* „Ç≠„É•„Éºn„ÅÆTOP„ÅÆ„Ç¢„Éâ„É¨„Çπ = a0 + TOP „Åß„ÅÇ„Çã„ÅÆ„Åß„Åù„Åì„Å´a1„Ç
000a44 2149 0008       750     move.l %a1, IN(%a0) /* „Ç≠„É•„Éºn„ÅÆIN„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000a48 2149 000C       751     move.l %a1, OUT(%a0) /* „Ç≠„É•„Éºn„ÅÆOUT„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000a4c 43E8 0111       752     lea.l QUEUE_SIZE-1(%a0), %a1 /* a1 == BOTTOM = „Ç≠„É•„Éºn„ÅÆÁµÇÁ´Ø„Ç¢„Éâ„É¨„Çπ */
000a50 2149 0004       753     move.l %a1,BOTTOM(%a0)/*„Ç≠„É•„Éºn„ÅÆBOTTOM„Å´a1„ÇíÊ†ºÁ¥ç*/
000a54 317C 0000       754     move.w #0, S(%a0) /* „Éá„Éº„ÇøÊï∞ = 0 */
       0010            754 
000a5a 5280            755     addq.l #1, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑++ */
000a5c 0C80 0000       756     cmpi.l #2, %d0 /* „Ç≠„É•„Éº„ÅÆÂÄãÊï∞ÂàÜ(2)„É´„Éº„Éó */
       0002            756 
000a62 6600 FFCE       757     bne Init_Q_sub
                       758 
000a66 4CDF 0703       759     movem.l (%sp)+, %d0-%d1/%a0-%a2 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
000a6a 4E75            760     rts
                       761 
                       762 
                       763 *****************
                       764 ** INQ
                       765 *****************
                       766 
                       767 **************************************
                       768 **ÂÖ•Âäõ
                       769 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû [long]
                       770 **  d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø [long]
                       771 **Âá∫Âäõ
                       772 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       773 **************************************
                       774 INQ:
                       775 
                       776     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
000a6c 40E7            777     move.w %SR, -(%sp)
                       778 
                       779     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000a6e 46FC 2700       780     move.w #0x2700, %SR
                       781 
000a72 48E7 00C0       782     movem.l %a0-%a1, -(%sp)
000a76 41FA FD90       783     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000a7a C0F8 0112       784     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000a7e D1C0            785     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       786 
000a80 0C68 0100       787     cmpi.w #256, S(%a0)
       0010            787 
000a86 6600 0008       788     bne INQ_1
                       789 
                       790     /* S == 256„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000a8a 7000            791     move.l #0, %d0
000a8c 6000 0024       792     bra INQ_END
                       793 
                       794 INQ_1:
000a90 2268 0008       795     movea.l IN(%a0), %a1 /* a1 = in */
000a94 1281            796     move.b %d1, (%a1) /* q[in] = d1 */ 
                       797 
000a96 B3E8 0004       798     cmpa.l BOTTOM(%a0), %a1 /* in == bottom „Åã„ÇíÂà§ÂÆö */
000a9a 6600 000A       799     bne INQ_ELSE
                       800 
                       801     /* in == bottom „ÅÆ„Å®„Åç*/
000a9e 2150 0008       802     move.l TOP(%a0), IN(%a0) /* in = top */
000aa2 6000 0008       803     bra INQ_2
                       804 
                       805 /* in != bottom „ÅÆ„Å®„Åç*/
                       806 INQ_ELSE:
000aa6 5289            807     addq.l #1, %a1 /* a1++ */
000aa8 2149 0008       808     move.l %a1, IN(%a0) /* in = a1 */
                       809 
                       810 /* s++, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       811 INQ_2:
000aac 5268 0010       812     addq.w #1, S(%a0)
000ab0 7001            813     move.l #1, %d0
                       814 
                       815 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       816 INQ_END:
000ab2 4CDF 0300       817     movem.l (%sp)+, %a0-%a1 
000ab6 46DF            818     move.w (%sp)+, %SR
000ab8 4E75            819     rts
                       820 
                       821 
                       822 *****************
                       823 * OUTQ
                       824 *****************
                       825 
                       826 **********************************************
                       827 **ÂÖ•Âäõ
                       828 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû  [long]
                       829 
                       830 **Âá∫Âäõ
                       831 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       832 **  d1:Âèñ„ÇäÁµÑ„Çì„Å†„Éá„Éº„Çø [byte]
                       833 **********************************************
                       834 OUTQ:
                       835     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
000aba 40E7            836     move.w %SR, -(%sp)
                       837 
                       838     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000abc 46FC 2700       839     move.w #0x2700, %SR
                       840 
000ac0 48E7 00C0       841     movem.l %a0-%a1, -(%sp)
000ac4 41FA FD42       842     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000ac8 C0F8 0112       843     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000acc D1C0            844     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       845 
000ace 0C68 0000       846     cmpi.w #0, S(%a0)
       0010            846 
000ad4 6600 0008       847     bne OUTQ_1
                       848 
                       849     /* S == 0„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000ad8 7000            850     move.l #0, %d0
000ada 6000 0024       851     bra OUTQ_END
                       852 
                       853 OUTQ_1:
000ade 2268 000C       854     movea.l OUT(%a0), %a1 /* a1 = out */
000ae2 1211            855     move.b (%a1), %d1 /* d1 = q[out] */
                       856 
000ae4 B3E8 0004       857     cmpa.l BOTTOM(%a0), %a1 /* out == bottom „Åã„ÇíÂà§ÂÆö */
000ae8 6600 000A       858     bne OUTQ_ELSE
                       859 
                       860     /* out == bottom „ÅÆ„Å®„Åç*/
000aec 2150 000C       861     move.l TOP(%a0), OUT(%a0) /* out = top */
000af0 6000 0008       862     bra OUTQ_2
                       863 
                       864 /* out != bottom „ÅÆ„Å®„Åç*/
                       865 OUTQ_ELSE:
000af4 5289            866     addq.l #1, %a1 /* a1++ */
000af6 2149 000C       867     move.l %a1, OUT(%a0) /* out = a1 */
                       868 
                       869 /* s--, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       870 OUTQ_2:
000afa 5368 0010       871     subq.w #1, S(%a0)
000afe 7001            872     move.l #1, %d0
                       873 
                       874 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       875 OUTQ_END:
000b00 4CDF 0300       876     movem.l (%sp)+, %a0-%a1 
000b04 46DF            877     move.w (%sp)+, %SR
000b06 4E75            878     rts
                       879 
                       880 
                       881 ***** 
                       882 
                       883 
                       884 
                       885 ******************************************************
                       886 *** ÂàùÊúüÂåñ„ÅÆ„ÅÇ„Çã„Éá„Éº„ÇøÈ†òÂüü
                       887 ******************************************************
                       888 
                       889 .section .data
                       890 TMSG:
000b08 2A2A 2A2A       891 	.ascii	"******\r\n"			/*r:Ë°åÈ†≠„Å∏,n:ÊîπË°å*/
       2A2A 0D0A       891 
                       892 .even
                       893 TTC:
000b10 0000            894 	.dc.w 0
                       895 	.even
                       896 
                       897 ********************************
                       898 ** preparation to typing game
                       899 ********************************
                       900 NEW_LINE:
                       901     /* size : 2 */
000b12 0D0A            902     .ascii "\r\n"
                       903 INTRO:
                       904     /* size : 28*/
000b14 506C 6561       905     .ascii "Please type this sentence!\r\n"
       7365 2074       905 
       7970 6520       905 
       7468 6973       905 
       2073 656E       905 
                       906 TXT_hello:
                       907     /* size : 11*/
000b30 6865 6C6C       908     .ascii "hello world"
       6F20 776F       908 
       726C 64         908 
                       909 
                       910 .equ SIZE_hello, 11
                       911 
                       912 
                       913 
                       914 ******************************************************
                       915 *** ÂàùÊúüÂåñ„ÅÆ„Å™„ÅÑ„Éá„Éº„ÇøÈ†òÂüü
                       916 ******************************************************
                       917 .section .bss
                       918 
                       919 COUNT_SIZE:
004c3c 0000 0000       920     .ds.l 0x01
                       921 TXT_P:
004c40 0000 0000       922 	.ds.l 0x01
                       923 TXT_SIZE:
004c44 0000 0000       924 	.ds.l 0x01
                       925 
                       926 task_p:
004c48 0000 0000       927 	.ds.l	0x01
                       928 	.even
                       929 
                       930 BUF:
004c4c 0000 0000       931 	.ds.b 256				/*BUF[256]*/
       0000 0000       931 
       0000 0000       931 
       0000 0000       931 
       0000 0000       931 
                       932 	.even
                       933 
                       934 
                       935 
                       936 USR_STK:
004d4c 0000 0000       937 	.ds.b 0x4000				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü*/
       0000 0000       937 
       0000 0000       937 
       0000 0000       937 
       0000 0000       937 
                       938 	.even
                       939 
                       940 USR_STK_TOP:				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ*/
                       941 
                       942 
                       943 
