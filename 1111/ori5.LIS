                         4 .list
                         5 		***************************************************************
                         6 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 		***************************************************************
                         8 
                         9 		***************
                        10 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        11 		***************
                        12 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        13 		.equ IOBASE,    0x00d00000
                        14 
                        15 		***************
                        16 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        17 		***************
                        18 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        19 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        20 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        21 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        22 
                        23 		***************
                        24 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        25 		***************
                        26 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        27 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        28 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        29 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        30 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        31 
                        32 		***************
                        33 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        34 		***************
                        35 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        36 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        37 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        38 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        39 
                        40 		***************
                        41 		** LED
                        42 		***************
                        43 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        44 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        45 		.equ LED5,      IOBASE+0x000002b
                        46 		.equ LED4,      IOBASE+0x0000029
                        47 		.equ LED3,      IOBASE+0x000003f
                        48 		.equ LED2,      IOBASE+0x000003d
                        49 		.equ LED1,      IOBASE+0x000003b
                        50 		.equ LED0,      IOBASE+0x0000039
                        51 
                        52 		***************************************************************
                        53 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        54 		***************************************************************
                        55 		.section .bss
                        56 		.even
                        57 SYS_STK:
0009c4 0000 0000        58 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
                        59 		.even
                        60 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        61 
                        62 		***************************************************************
                        63 		** ÂàùÊúüÂåñ
                        64 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        65 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        66 		***************************************************************
                        67 
                        68 
                        69 .section .data
                        70 .even
000588 3031 3233        71 	TDATA1: .ascii "0123456789ABCDEF"
       3435 3637        71 
       3839 4142        71 
       4344 4546        71 
000598 6B6C 6D6E        72 	TDATA2: .ascii "klmnopqrstuvwxyz"
       6F70 7172        72 
       7374 7576        72 
       7778 797A        72 
                        73 .even
                        74 
                        75 		
                        76 
                        77 .section .text
                        78 		.even
                        79 boot:
                        80 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        81 		move.w #0x2700,%SR
000404 4FF9 0000        82 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             82 
                        83 
                        84 		****************
                        85 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        86 		****************
00040a 13FC 0040        87 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        87 
000412 23FC 00FF        88 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        88 
       F304             88 
                        89 
                        90 		****************
                        91 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        92 		****************
00041c 33FC 0000        93 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        93 
000424 33FC E100        94 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        94 
00042c 33FC 0038        95 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        95 
                        96 
                        97 		****************
                        98 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        99 		*****************
000434 33FC 0004       100 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600       100 
                       101 
                       102 		***************************************************************
                       103 		** STEP2„ÅÆÂá¶ÁêÜ
                       104 		***************************************************************
                       105 		/* ÂàùÊúüÂåñÂá¶ÁêÜ„Çí„É°„Ç§„É≥„É´„Éº„ÉÅ„É≥„Åã„Çâ„Åì„Å°„Çâ„Å∏ÁßªÂãï */
                       106 		*lea.l uart1_interrupt, %a0
                       107 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 21FC 0000       108 		move.l #uart1_interrupt, 0x110
       0000 0110       108 
000444 33FC E100       109 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ
       00FF F900       109 
00044c 23FC 00FF       110 		move.l #0x00ff3ffb,IMR  |UART1Ë®±ÂèØ
       3FFB 00FF       110 
       F304            110 
000456 46FC 2700       111 		move.w #0x2700, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´7 */
                       112 		
                       113 
00045a 6000 0002       114 		bra MAIN
                       115 
                       116 		***************************************************************
                       117 		** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                       118 		** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       119 		***************************************************************
                       120 		.section .text
                       121 		.even
                       122 
                       123 
                       124 
                       125 
                       126 	
                       127 MAIN:
00045e 4EB9 0000       128 		jsr Init_Q
       0000            128 
000464 13FC 0031       129 		move.b #'1', LED7
       00D0 002F       129 
00046c 33FC E108       130 		move.w #0xe108,USTCNT1
       00FF F900       130 
000474 46FC 2000       131 		move.w #0x2000, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´0 */
                       132 
                       133 
                       134 PS_TEST1:
                       135 		/* jsr PUTSTRING(0, #TDATA1, 16)*/
000478 7200            136 		move.l	#0x00, %d1
00047a 243C 0000       137 		move.l	#TDATA1, %d2
       0000            137 
000480 7610            138 		move.l	#0x10, %d3
000482 4EBA 00A4       139 		jsr PUTSTRING
                       140 		
                       141 	
000486 13FC 0032       142 		move.b #'2', LED6
       00D0 002D       142 
00048e 283C 0000       143 		move.l	#0x000fff, %d4
       0FFF            143 
                       144 	
                       145 		
                       146 LOOP:
000494 5384            147 		subq.l #1,%d4
000496 6700 000E       148 		beq PS_TEST2
00049a 13FC 0035       149 		move.b #'5', LED3
       00D0 003F       149 
                       150 		
0004a2 6000 FFF0       151 		bra LOOP
                       152 
                       153 PS_TEST2:
0004a6 13FC 0036       154 		move.b #'6', LED2
       00D0 003D       154 
0004ae 7200            155 		move.l	#0x00, %d1
0004b0 243C 0000       156 		move.l	#TDATA2, %d2
       0000            156 
0004b6 7610            157 		move.l	#0x010, %d3
0004b8 4EBA 006E       158 		jsr PUTSTRING
0004bc 6000 FFE8       159 		bra PS_TEST2
                       160 
                       161 
                       162 uart1_interrupt:
                       163 		
0004c0 48E7 8000       164 		movem.l %d0, -(%sp)
                       165 		
0004c4 3039 00FF       166 		move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            166 
0004ca 7200            167 		move.l #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
                       168 
0004cc 0C40 8000       169 		cmp.w #0x8000,%d0
0004d0 6400 0008       170 		bcc INTERPUT
                       171 
0004d4 4CDF 0001       172 		movem.l (%sp)+, %d0
                       173 		
0004d8 4E73            174 		rte
                       175 
                       176 
                       177 INTERPUT:
0004da 48E7 E000       178 		movem.l %d0-%d2, -(%sp)
                       179 
0004de 46FC 2700       180 		move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       181 
0004e2 0C81 0000       182 		cmp.l #0x0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
       0000            182 
                       183 
0004e8 6600 0030       184 		bne INTERPUT_END
                       185 
0004ec 7001            186 		move.l #1, %d0
                       187 
0004ee 4EB9 0000       188 		jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            188 
                       189 
0004f4 0C80 0000       190 		cmp.l #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
       0000            190 
0004fa 6700 0012       191 		beq INTERPUT_MASK
                       192 
0004fe 1401            193 		move.b %d1, %d2
000500 0642 0800       194 		addi.w #0x0800, %d2
000504 33C2 00FF       195 		move.w %d2, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            195 
                       196 
00050a 6000 000E       197 		bra INTERPUT_END
                       198 INTERPUT_MASK:
00050e 33FC E108       199 		move.w #0xe108, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       199 
                       200 		/* ‚Üë ‰ΩïÊïÖ„Åã„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„Åï„Çå„Å¶„ÅÑ„Åü„ÅÆ„Åß„ÄÅ‰øÆÊ≠£ */
                       201 
000516 6000 0002       202 		bra INTERPUT_END
                       203 
                       204 
                       205 INTERPUT_END:
00051a 13FC 0033       206 		move.b #'3', LED5
       00D0 002B       206 
000522 4CDF 0007       207 		movem.l (%sp)+, %d0-%d2
                       208 
                       209 
000526 4E73            210 		rte
                       211 
                       212 
                       213 *************************************************************
                       214 **PUTSTRING
                       215 **ÂÖ•Âäõ
                       216 **d1:„ÉÅ„É£„Éç„É´
                       217 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       218 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       219 **Êàª„ÇäÂÄ§
                       220 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       221 *************************************************************
                       222 PUTSTRING:
000528 48E7 7EFE       223 		movem.l %a0-%a6/%d1-%d6, -(%SP)
                       224 
00052c 0C81 0000       225 		cmp.l #0x00, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            225 
000532 6600 0044       226 		bne PUTSTRING_END
                       227 		/* rv: „Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅÆÊØîËºÉ„ÄÇÔºê„Åß„ÅØ„Å™„ÅÑ„Å®„Åç„Å´ÁµÇ‰∫Ü„Åô„Çã*/
                       228 
000536 7800            229 		move.l #0x0000,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       230 		/* rv: „Éá„Éº„ÇøÊï∞(sz)„ÅÆÂàùÊúüÂåñ*/
                       231 
000538 2242            232 		move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ/
                       233 		/* rv: Ë™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Çía1„Å´Ê†ºÁ¥ç„Åô„Çã*/	
                       234 
00053a 0C83 0000       235 		cmp.l #0x0000,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            235 
000540 6700 0036       236 		beq PUTSTRING_END
                       237 		/* rv: d3(size)„Åå0„Å™„Çâ„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
                       238 
                       239 
                       240 LOOP_STEP5:
000544 B684            241 		cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
000546 6700 001C       242 		beq PUTSTRING_MASK
                       243 		/* d3 „Å® d4 size = sz „Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï*/
                       244 
00054a 7001            245 		move.l #0x01,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
00054c 1219            246 		move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       247 		/* rv: ÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Åã„ÇâÈ†Ü„Å´Ê†ºÁ¥ç„Åô„Çã*/
                       248 
00054e 4EB9 0000       249 		jsr INQ
       0000            249 
                       250 
000554 0C80 0000       251 		cmp.l #0x00,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            251 
                       252 
00055a 6700 0008       253 		beq PUTSTRING_MASK
                       254 		/*rv : Â§±Êïó„Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï„Åô„Çã*/
                       255 
00055e 5284            256 		addq.l #0x01,%d4		/*sz++*/
000560 6000 FFE2       257 		bra LOOP_STEP5
                       258 
                       259 PUTSTRING_MASK:
                       260 
000564 33FC E10C       261 		move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       261 
00056c 13FC 0039       262 		move.b #'9', LED0
       00D0 0039       262 
                       263 
                       264 
000574 6000 0002       265 		bra PUTSTRING_END
                       266 
                       267 PUTSTRING_END:
                       268 
000578 2004            269 		move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
00057a 4CDF 7F7E       270 		movem.l (%SP)+, %a0-%a6/%d1-%d6
                       271 		/* bus errorÂá∫„Åü„ÅÆ„ÅßÂ§âÊõ¥„Åó„Åü*/
                       272 
                       273 		***
00057e 13FC 0034       274 		move.b #'4', LED4
       00D0 0029       274 
                       275 		***
000586 4E75            276 		rts
                       277 
                       278 
                       279 ******************************************************************************:
                       280 
                       281 ******
                       282 ******‰ª•ÈôçQUEUE
                       283 ******
                       284 
                       285 .section .data
                       286 .equ IN_COUNT, 257
                       287 .equ OUT_COUNT, 257
                       288 .equ queue_number, 1
                       289 .equ OFFSET_1, 0x100
                       290 .equ END_0, 0xff
                       291 .equ END_1, 0x1ff
0005a8 0000 0000       292 top: .ds.b 0x200
       0000 0000       292 
       0000 0000       292 
       0000 0000       292 
       0000 0000       292 
0007a8 0000 0000       293 bottom: .ds.l 1
0007ac 0000 0000       294 in: .ds.l 1
0007b0 0000 0000       295 in_0: .ds.l 1
0007b4 0000 0000       296 in_1: .ds.l 1
0007b8 0000 0000       297 out: .ds.l 1
0007bc 0000 0000       298 out_0: .ds.l 1
0007c0 0000 0000       299 out_1: .ds.l 1
0007c4 0000 0000       300 s: .ds.l 1
0007c8 0000 0000       301 s0: .ds.l 1
0007cc 0000 0000       302 s1: .ds.l 1
0007d0 0000 0000       303 START_LABEL: .ds.l 1
                       304 
                       305 /* ÂàùÊúüÂåñ*/
                       306 Init_Q:
0007d4 48E7 003E       307 movem.l %a2-%a6, -(%sp) /* ÂøúÊÄ•Âá¶ÁΩÆ*/
0007d8 45FA FDCE       308 lea.l top, %a2
0007dc 23CA 0000       309 move.l %a2, in_0
       0000            309 
0007e2 23CA 0000       310 move.l %a2, out_0
       0000            310 
0007e8 47EA 0100       311 lea.l OFFSET_1(%a2), %a3
0007ec 23CB 0000       312 move.l %a3, in_1
       0000            312 
0007f2 23CB 0000       313 move.l %a3, out_1
       0000            313 
0007f8 49FA FFCA       314 lea.l s, %a4
0007fc 4BFA FFCA       315 lea.l s0, %a5
000800 4DFA FFCA       316 lea.l s1, %a6
000804 28BC 0000       317 move.l #0,(%a4)
       0000            317 
00080a 2ABC 0000       318 move.l #0,(%a5)
       0000            318 
000810 2CBC 0000       319 move.l #0,(%a6)
       0000            319 
000816 4CDF 7C00       320 movem.l (%sp)+, %a2-%a6 /* ÂøúÊÄ•Âá¶ÁΩÆ*/
00081a 4E75            321 rts
                       322 
                       323 *****************************************************************
                       324 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       325 **d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø
                       326 **d1:Ëøî„ÇäÂÄ§„ÄÅÊàêÂäüorÂ§±Êïó
                       327 *****************************************************************
                       328 INQ:
00081c 48E7 1000       329 movem.l %d3, -(%sp)
000820 40C3            330 move.w %SR, %d3
000822 46FC 2700       331 move.w #0x2700, %SR
000826 4EBA 000E       332 jsr SELECT_QUEUE
00082a 4EBA 008C       333 jsr PUT_BUF
00082e 46C3            334 move.w %d3, %SR
000830 4CDF 0008       335 movem.l (%sp)+, %d3
000834 4E75            336 rts
                       337 
                       338 SELECT_QUEUE:
000836 0C00 0000       339 cmp.b #0, %d0
00083a 6700 000C       340 beq SET_0
00083e 0C00 0001       341 cmp.b #1, %d0
000842 6700 003A       342 beq SET_1
000846 4E75            343 rts
                       344 
                       345 SET_0:
000848 48E7 0030       346 movem.l %a2-%a3, -(%sp)
00084c 23FA FF62       347 move.l in_0, in
       0000 0000       347 
000854 23FA FF66       348 move.l out_0, out
       0000 0000       348 
                       349 
00085c 45FA FD4A       350 lea.l top, %a2
000860 23CA 0000       351 move.l %a2, START_LABEL
       0000            351 
000866 47EA 00FF       352 lea.l END_0(%a2), %a3
00086a 23CB 0000       353 move.l %a3, bottom
       0000            353 
000870 23FA FF56       354 move.l s0,s
       0000 0000       354 
000878 4CDF 0C00       355 movem.l (%sp)+, %a2-%a3
00087c 4E75            356 rts
                       357 
                       358 SET_1:
00087e 48E7 0030       359 movem.l %a2-%a3, -(%sp)
000882 23FA FF30       360 move.l in_1, in
       0000 0000       360 
00088a 23FA FF34       361 move.l out_1, out
       0000 0000       361 
                       362 
000892 45FA FD14       363 lea.l top, %a2
000896 47EA 0100       364 lea.l OFFSET_1(%a2), %a3
00089a 23CB 0000       365 move.l %a3, START_LABEL
       0000            365 
0008a0 47EA 01FF       366 lea.l END_1(%a2), %a3
0008a4 23CB 0000       367 move.l %a3, bottom
       0000            367 
0008aa 23FA FF20       368 move.l s1,s
       0000 0000       368 
0008b2 4CDF 0C00       369 movem.l (%sp)+, %a2-%a3
0008b6 4E75            370 rts
                       371 
                       372 PUT_BUF:
0008b8 48E7 407E       373 movem.l %a1-%a6/%d1, -(%sp)
                       374 
0008bc 243A FF06       375 move.l s,%d2
0008c0 0C82 0000       376 cmp.l #0x100,%d2
       0100            376 
0008c6 6700 0038       377 beq PUT_FAIL 
                       378 
0008ca 49FA FEF8       379 lea.l s,%a4
0008ce 5294            380 addq.l #1,(%a4)
0008d0 143C 0001       381 move.b #1,%d2 /*ÊàêÂäü*/
0008d4 227A FED6       382 movea.l in, %a1
0008d8 12C1            383 move.b %d1, (%a1)+  
                       384 
0008da 267A FECC       385 move.l bottom, %a3
0008de B3CB            386 cmpa.l %a3, %a1
0008e0 6300 0008       387 bls PUT_BUF_STEP1
0008e4 247A FEEA       388 move.l START_LABEL, %a2
0008e8 224A            389 movea.l %a2, %a1
                       390 
                       391 PUT_BUF_STEP1:
0008ea 23C9 0000       392 move.l %a1, in
       0000            392 
0008f0 B3FA FEC6       393 cmpa.l out, %a1
0008f4 6600 0002       394 bne PUT_BUF_STEP2
                       395 
                       396 PUT_BUF_STEP2:
0008f8 4EBA 0014       397 jsr UPDATE
0008fc 6000 000A       398 bra PUT_BUF_Finish
                       399 
                       400 PUT_FAIL:
000900 343C 0000       401 move.w #0,%d2 /*Â§±Êïó*/
000904 4EBA 0008       402 jsr UPDATE
                       403 
                       404 PUT_BUF_Finish:
000908 4CDF 7E02       405 movem.l (%sp)+, %a1-%a6/%d1
00090c 4E75            406 rts
                       407 
                       408 UPDATE:
00090e 0C00 0000       409 cmp.b #0, %d0
000912 6700 000C       410 beq QUEUE_0
000916 0C00 0001       411 cmp.b #1, %d0
00091a 6700 001E       412 beq QUEUE_1
00091e 4E75            413 rts
                       414 
                       415 QUEUE_0:
000920 23C9 0000       416 move.l %a1, in_0
       0000            416 
000926 23FA FE90       417 move.l out, out_0
       0000 0000       417 
00092e 23FA FE94       418 move.l s,s0
       0000 0000       418 
000936 3002            419 move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
                       420 
000938 4E75            421 rts
                       422 QUEUE_1:
00093a 23C9 0000       423 move.l %a1, in_1
       0000            423 
000940 23FA FE76       424 move.l out, out_1
       0000 0000       424 
000948 23FA FE7A       425 move.l s,s1
       0000 0000       425 
000950 3002            426 move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
000952 4E75            427 rts
                       428 
                       429 ********************************************
                       430 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       431 **d1:Êàª„ÇäÂÄ§„ÄÅÂèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø
                       432 ********************************************
                       433 OUTQ:
                       434 *move.w #0x0800+'a', UTX1
000954 48E7 1000       435 movem.l %d3, -(%sp)
000958 40C3            436 move.w %SR, %d3
00095a 46FC 2700       437 move.w #0x2700, %SR
00095e 4EBA FED6       438 jsr SELECT_QUEUE
000962 4EBA 000A       439 jsr GET_BUF
000966 46C3            440 move.w %d3, %SR
000968 4CDF 0008       441 movem.l (%sp)+, %d3
00096c 4E75            442 rts
                       443 
                       444 GET_BUF:
00096e 48E7 007E       445 movem.l %a1-%a6, -(%sp)
                       446 
000972 243A FE50       447 move.l s,%d2
000976 0C82 0000       448 cmp.l #0x00,%d2
       0000            448 
00097c 6700 0038       449 beq GET_FAIL
                       450 
000980 143C 0001       451 move.b #1,%d2 /*ÊàêÂäü*/
000984 49FA FE3E       452 lea.l s,%a4
000988 5394            453 subq.l #1,(%a4)
00098a 227A FE2C       454 movea.l out, %a1
00098e 1219            455 move.b (%a1)+, %d1     
000990 267A FE16       456 move.l bottom, %a3
000994 B3CB            457 cmpa.l %a3, %a1
000996 6300 0008       458 bls GET_BUF_STEP1
00099a 247A FE34       459 move.l START_LABEL, %a2
00099e 224A            460 movea.l %a2, %a1
                       461 
                       462 GET_BUF_STEP1:
0009a0 23C9 0000       463 move.l %a1, out
       0000            463 
0009a6 B3FA FE04       464 cmpa.l in, %a1
0009aa 6600 0002       465 bne GET_BUF_STEP2
                       466 
                       467 GET_BUF_STEP2:
0009ae 4EBA FF5E       468 jsr UPDATE
0009b2 6000 000A       469 bra GET_BUF_Finish
                       470 
                       471 GET_FAIL:
0009b6 343C 0000       472 move.w #0,%d2 /*Â§±Êïó*/
0009ba 4EBA FF52       473 jsr UPDATE
                       474 *move.w #0x0800+'e', UTX1
                       475 
                       476 GET_BUF_Finish:
0009be 4CDF 7E00       477 movem.l (%sp)+, %a1-%a6
0009c2 4E75            478 rts
                       479 
                       480 
                       481 
