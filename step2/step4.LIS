                         4 .list
                         5 		***************************************************************
                         6 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 		***************************************************************
                         8 
                         9 		***************
                        10 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        11 		***************
                        12 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        13 		.equ IOBASE,    0x00d00000
                        14 
                        15 		***************
                        16 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        17 		***************
                        18 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        19 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        20 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        21 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        22 
                        23 		***************
                        24 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        25 		***************
                        26 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        27 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        28 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        29 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        30 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        31 
                        32 		***************
                        33 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        34 		***************
                        35 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        36 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        37 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        38 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        39 
                        40 		***************
                        41 		** LED
                        42 		***************
                        43 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        44 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        45 		.equ LED5,      IOBASE+0x000002b
                        46 		.equ LED4,      IOBASE+0x0000029
                        47 		.equ LED3,      IOBASE+0x000003f
                        48 		.equ LED2,      IOBASE+0x000003d
                        49 		.equ LED1,      IOBASE+0x000003b
                        50 		.equ LED0,      IOBASE+0x0000039
                        51 
                        52 		***************************************************************
                        53 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        54 		***************************************************************
                        55 		.section .bss
                        56 		.even
                        57 SYS_STK:
000904 0000 0000        58 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
                        59 		.even
                        60 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        61 
                        62 		***************************************************************
                        63 		** ÂàùÊúüÂåñ
                        64 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        65 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        66 		***************************************************************
                        67 		.section .text
                        68 		.even
                        69 boot:
                        70 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        71 		move.w #0x2700,%SR
000404 4FF9 0000        72 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             72 
                        73 
                        74 		****************
                        75 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        76 		****************
00040a 13FC 0040        77 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        77 
000412 23FC 00FF        78 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        78 
       F304             78 
00041c 4EB9 0000        79 		jsr Init_Q
       0000             79 
                        80 
                        81 		****************
                        82 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        83 		****************
000422 33FC 0000        84 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        84 
00042a 33FC E100        85 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        85 
000432 33FC 0038        86 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        86 
                        87 
                        88 		****************
                        89 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        90 		*****************
00043a 33FC 0004        91 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        91 
                        92 
                        93 		***************************************************************
                        94 		** STEP2„ÅÆÂá¶ÁêÜ
                        95 		***************************************************************
                        96 		*lea.l uart1_interrupt, %a0
                        97 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
                        98 
                        99 		
                       100 		/**/
000442 21FC 0000       101 		move.l #INTERPUT, 0x11C
       0000 011C       101 
                       102 		
                       103 		
                       104 
00044a 21FC 0000       105 		move.l #uart1_interrupt, 0x110
       0000 0110       105 
000452 33FC E10C       106 		move.w #0xE10C, USTCNT1 |Âèó‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ„ÄÅÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøÁÑ°Âäπ /* STEP2.2 */
       00FF F900       106 
00045a 23FC 00FF       107 		move.l #0x00ff3ffb,IMR  |Âèó‰ø°Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       3FFB 00FF       107 
       F304            107 
000464 46FC 2000       108 		move.w #0x2000, %SR    /* STEP2.4 Ââ≤„ÇäËæº„ÅøË®±ÂèØÔºé(„Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂„É¢„Éº„Éâ„ÅÆÂ†¥Âêà) 
000468 6000 0002       109 		bra MAIN
                       110 
                       111 		***************************************************************
                       112 		** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                       113 		** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       114 		***************************************************************
                       115 		.section .text
                       116 		.even
                       117 
                       118 
                       119 
                       120 
                       121 	
                       122 MAIN:
                       123 		*move.w #0x0800+'a', UTX1 | 0x0800„ÇíË∂≥„ÅôÁêÜÁî±„Å´„Å§„ÅÑ„Å¶„ÅØÔºå|‰ªòÈå≤ÂèÇÁÖß
                       124 
                       125 
                       126 
00046c 4EBA 0006       127 		jsr TEST_READY
                       128 		
                       129 LOOP:
000470 6000 FFFE       130 		bra LOOP
                       131 
                       132 /*‰ª•‰∏ã„ÉÜ„Çπ„Éà*/
                       133 TEST_READY:
                       134 		*movem.l %d1-%d5, -(%sp)
                       135 	
000474 383C 0010       136 		move.w #16, %d4
000478 3A3C 0010       137 		move.w #16, %d5
00047c 123C 0061       138 		move.b #0x61, %d1
000480 6000 0008       139 		bra TEST_LOOP
                       140 
                       141 TEST_LOOP2:
                       142 
000484 5241            143 		addq #1, %d1
000486 383C 0010       144 		move.w #16, %d4
                       145 
                       146 TEST_LOOP:
00048a 7001            147 		moveq #1, %d0
00048c 4EB9 0000       148 		jsr INQ
       0000            148 
000492 5344            149 		subq #1, %d4
000494 6600 FFF4       150 		bne TEST_LOOP
000498 5345            151 		subq #1, %d5
00049a 6700 0006       152 		beq TEST_END
00049e 6000 FFE4       153 		bra TEST_LOOP2
                       154 
                       155 TEST_END:
                       156 		*movem.l (%sp)+, %d1-%d5
0004a2 4E75            157 		rts
                       158 /*‰ª•‰∏ä„ÉÜ„Çπ„Éà*/
                       159 
                       160 uart1_interrupt:
0004a4 48E7 8000       161 		movem.l %d0, -(%sp)
                       162 
                       163 		*move.b #'a', %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       164 		*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
                       165 		*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ *
                       166 
                       167 
0004a8 2039 00FF       168 		move.l UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            168 
                       169 		
0004ae 123C 0000       170 		move.b #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
                       171 
0004b2 0C80 0000       172 		cmp.l #0x8000,%d0
       8000            172 
0004b8 6000 0008       173 		bra INTERPUT
                       174 
                       175 INTERPUT_RTE:
0004bc 4CDF 0001       176 		movem.l (%sp)+, %d0
                       177 
0004c0 4E73            178 		rte
                       179 
                       180 
                       181 INTERPUT:
                       182 	/*‰∏ÄÂõûÁõÆ„Å†„ÅëÊèèÁîª*/
                       183 	*move.b #0x65, %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       184 	*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó *
                       185 	*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ */
                       186 
                       187 
0004c2 123C 0001       188 	move.b #1, %d1
                       189 
0004c6 46FC 2700       190 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       191 	
0004ca 0C01 0000       192 	cmp.b #0x0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
                       193 
0004ce 6600 001E       194 	bne INTERPUT_END
                       195 
0004d2 103C 0001       196 	move.b #1, %d0
0004d6 4EB9 0000       197 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            197 
                       198 
0004dc 0C40 0000       199 	cmp #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
0004e0 6700 0010       200 	beq INTERPUT_MASK
                       201 
0004e4 D278 0800       202 	add.w 0x0800, %d1
0004e8 33C1 00FF       203 	move.w %d1, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            203 
                       204 
                       205 
                       206 INTERPUT_END:
0004ee 4EFA FFCC       207 	jmp INTERPUT_RTE
                       208 
                       209 INTERPUT_MASK:
0004f2 23FC 0000       210 	move.l #0xE108, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       E108 00FF       210 
       F900            210 
                       211 	
0004fc 103C 0065       212 	move.b #0x65, %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
000500 0640 0800       213 	addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó *
                       214 	move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ */
                       215 
                       216 
000504 6000 FFE8       217 	bra INTERPUT_END
                       218 
                       219 
                       220 ******
                       221 ******‰ª•ÈôçQUEUE
                       222 ******
                       223 
                       224 .section .data
                       225 .equ IN_COUNT, 257
                       226 .equ OUT_COUNT, 257
                       227 .equ queue_number, 1
                       228 .equ OFFSET_1, 0x100
                       229 .equ END_0, 0xff
                       230 .equ END_1, 0x1ff
000508 0000 0000       231 top: .ds.b 0x200
       0000 0000       231 
       0000 0000       231 
       0000 0000       231 
       0000 0000       231 
000708 0000 0000       232 bottom: .ds.w 2
00070c 0000 0000       233 in: .ds.l 1
000710 0000 0000       234 in_0: .ds.l 1
000714 0000 0000       235 in_1: .ds.l 1
000718 0000 0000       236 out: .ds.l 1
00071c 0000 0000       237 out_0: .ds.l 1
000720 0000 0000       238 out_1: .ds.l 1
000724 0000 0000       239 s: .ds.l 1
000728 0000 0000       240 s0: .ds.l 1
00072c 0000 0000       241 s1: .ds.l 1
000730 0000 0000       242 START_LABEL: .ds.l 1
                       243 
                       244 /* ÂàùÊúüÂåñ*/
                       245 Init_Q:
000734 48E7 003E       246 movem.l %a2-%a6, -(%sp) /* ÂøúÊÄ•Âá¶ÁΩÆ*/
000738 45FA FDCE       247 lea.l top, %a2
00073c 23CA 0000       248 move.l %a2, in_0
       0000            248 
000742 23CA 0000       249 move.l %a2, out_0
       0000            249 
000748 47EA 0100       250 lea.l OFFSET_1(%a2), %a3
00074c 23CB 0000       251 move.l %a3, in_1
       0000            251 
000752 23CB 0000       252 move.l %a3, out_1
       0000            252 
000758 49FA FFCA       253 lea.l s, %a4
00075c 4BFA FFCA       254 lea.l s0, %a5
000760 4DFA FFCA       255 lea.l s1, %a6
000764 28BC 0000       256 move.l #0,(%a4)
       0000            256 
00076a 2ABC 0000       257 move.l #0,(%a5)
       0000            257 
000770 2CBC 0000       258 move.l #0,(%a6)
       0000            258 
000776 4CDF 7C00       259 movem.l (%sp)+, %a2-%a6 /* ÂøúÊÄ•Âá¶ÁΩÆ*/
00077a 4E75            260 rts
                       261 
                       262 *****************************************************************
                       263 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       264 **d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø
                       265 **d1:Ëøî„ÇäÂÄ§„ÄÅÊàêÂäüorÂ§±Êïó
                       266 *****************************************************************
                       267 INQ:
00077c 4EBA 0008       268 jsr SELECT_QUEUE
000780 4EBA 0086       269 jsr PUT_BUF
000784 4E75            270 rts
                       271 
                       272 SELECT_QUEUE:
000786 0C00 0000       273 cmp.b #0, %d0
00078a 6700 000C       274 beq SET_0
00078e 0C00 0001       275 cmp.b #1, %d0
000792 6700 003A       276 beq SET_1
000796 4E75            277 rts
                       278 
                       279 SET_0:
000798 48E7 0030       280 movem.l %a2-%a3, -(%sp)
00079c 23FA FF72       281 move.l in_0, in
       0000 0000       281 
0007a4 23FA FF76       282 move.l out_0, out
       0000 0000       282 
                       283 
0007ac 45FA FD5A       284 lea.l top, %a2
0007b0 23CA 0000       285 move.l %a2, START_LABEL
       0000            285 
0007b6 47EA 00FF       286 lea.l END_0(%a2), %a3
0007ba 23CB 0000       287 move.l %a3, bottom
       0000            287 
0007c0 23FA FF66       288 move.l s0,s
       0000 0000       288 
0007c8 4CDF 0C00       289 movem.l (%sp)+, %a2-%a3
0007cc 4E75            290 rts
                       291 
                       292 SET_1:
0007ce 48E7 0030       293 movem.l %a2-%a3, -(%sp)
0007d2 23FA FF40       294 move.l in_1, in
       0000 0000       294 
0007da 23FA FF44       295 move.l out_1, out
       0000 0000       295 
                       296 
0007e2 45FA FD24       297 lea.l top, %a2
0007e6 47EA 0100       298 lea.l OFFSET_1(%a2), %a3
0007ea 23CB 0000       299 move.l %a3, START_LABEL
       0000            299 
0007f0 47EA 01FF       300 lea.l END_1(%a2), %a3
0007f4 23CB 0000       301 move.l %a3, bottom
       0000            301 
0007fa 23FA FF2C       302 move.l s0,s
       0000 0000       302 
000802 4CDF 0C00       303 movem.l (%sp)+, %a2-%a3
000806 4E75            304 rts
                       305 
                       306 PUT_BUF:
000808 48E7 407E       307 movem.l %a1-%a6/%d1, -(%sp)
                       308 
00080c 243A FF16       309 move.l s,%d2
000810 0C82 0000       310 cmp.l #0x100,%d2
       0100            310 
000816 6700 0038       311 beq PUT_FAIL 
                       312 
00081a 49FA FF08       313 lea.l s,%a4
00081e 5294            314 addq.l #1,(%a4)
000820 143C 0001       315 move.b #1,%d2 /*ÊàêÂäü*/
000824 227A FEE6       316 movea.l in, %a1
000828 12C1            317 move.b %d1, (%a1)+  
                       318 
00082a 267A FEDC       319 move.l bottom, %a3
00082e B3CB            320 cmpa.l %a3, %a1
000830 6300 0008       321 bls PUT_BUF_STEP1
000834 247A FEFA       322 move.l START_LABEL, %a2
000838 224A            323 movea.l %a2, %a1
                       324 
                       325 PUT_BUF_STEP1:
00083a 23C9 0000       326 move.l %a1, in
       0000            326 
000840 B3FA FED6       327 cmpa.l out, %a1
000844 6600 0002       328 bne PUT_BUF_STEP2
                       329 
                       330 PUT_BUF_STEP2:
000848 4EBA 0014       331 jsr UPDATE
00084c 6000 000A       332 bra PUT_BUF_Finish
                       333 
                       334 PUT_FAIL:
000850 143C 0000       335 move.b #0,%d2 /*Â§±Êïó*/
000854 4EBA 0008       336 jsr UPDATE
                       337 
                       338 PUT_BUF_Finish:
000858 4CDF 7E02       339 movem.l (%sp)+, %a1-%a6/%d1
00085c 4E75            340 rts
                       341 
                       342 UPDATE:
00085e 0C40 0000       343 cmp #0, %d0
000862 6700 000C       344 beq QUEUE_0
000866 0C40 0001       345 cmp #1, %d0
00086a 6700 001E       346 beq QUEUE_1
00086e 4E75            347 rts
                       348 
                       349 QUEUE_0:
000870 23C9 0000       350 move.l %a1, in_0
       0000            350 
000876 23FA FEA0       351 move.l out, out_0
       0000 0000       351 
00087e 23FA FEA4       352 move.l s,s0
       0000 0000       352 
000886 1002            353 move.b %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
                       354 
000888 4E75            355 rts
                       356 QUEUE_1:
00088a 23C9 0000       357 move.l %a1, in_1
       0000            357 
000890 23FA FE86       358 move.l out, out_1
       0000 0000       358 
000898 23FA FE8A       359 move.l s,s1
       0000 0000       359 
0008a0 1002            360 move.b %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
0008a2 4E75            361 rts
                       362 
                       363 ********************************************
                       364 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       365 **d1:Êàª„ÇäÂÄ§„ÄÅÂèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø
                       366 ********************************************
                       367 OUTQ:
0008a4 4EBA FEE0       368 jsr SELECT_QUEUE
0008a8 4EBA 0004       369 jsr GET_BUF
0008ac 4E75            370 rts
                       371 
                       372 GET_BUF:
0008ae 48E7 007E       373 movem.l %a1-%a6, -(%sp)
                       374 
0008b2 243A FE70       375 move.l s,%d2
0008b6 0C82 0000       376 cmp.l #0x00,%d2
       0000            376 
0008bc 6700 0038       377 beq GET_FAIL
                       378 
0008c0 143C 0001       379 move.b #1,%d2 /*ÊàêÂäü*/
0008c4 49FA FE5E       380 lea.l s,%a4
0008c8 5394            381 subq.l #1,(%a4)
0008ca 227A FE4C       382 movea.l out, %a1
0008ce 1219            383 move.b (%a1)+, %d1     
0008d0 267A FE36       384 move.l bottom, %a3
0008d4 B3CB            385 cmpa.l %a3, %a1
0008d6 6300 0008       386 bls GET_BUF_STEP1
0008da 247A FE54       387 move.l START_LABEL, %a2
0008de 224A            388 movea.l %a2, %a1
                       389 
                       390 GET_BUF_STEP1:
0008e0 23C9 0000       391 move.l %a1, out
       0000            391 
0008e6 B3FA FE24       392 cmpa.l in, %a1
0008ea 6600 0002       393 bne GET_BUF_STEP2
                       394 
                       395 GET_BUF_STEP2:
0008ee 4EBA FF6E       396 jsr UPDATE
0008f2 6000 000A       397 bra GET_BUF_Finish
                       398 
                       399 GET_FAIL:
0008f6 143C 0000       400 move.b #0,%d2 /*Â§±Êïó*/
0008fa 4EBA FF62       401 jsr  UPDATE
                       402 
                       403 GET_BUF_Finish:
0008fe 4CDF 7E00       404 movem.l (%sp)+, %a1-%a6
000902 4E75            405 rts
                       406 
                       407 		
