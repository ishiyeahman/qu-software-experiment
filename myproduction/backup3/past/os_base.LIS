                         4 .list
                         5 /* ÂàùÊúüÂåñ*/
                         6 
                         7 		***************************************************************
                         8 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         9 		***************************************************************
                        10 
                        11 		***************
                        12 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        13 		***************
                        14 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        15 		.equ IOBASE,    0x00d00000
                        16 
                        17 		***************
                        18 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        19 		***************
                        20 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        21 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        22 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        23 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        24 
                        25 		***************
                        26 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        27 		***************
                        28 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        29 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        30 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        31 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        32 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        33 
                        34 		***************
                        35 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        36 		***************
                        37 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        38 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        39 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        40 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        41 
                        42 		***************
                        43 		** LED
                        44 		***************
                        45 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        46 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        47 		.equ LED5,      IOBASE+0x000002b
                        48 		.equ LED4,      IOBASE+0x0000029
                        49 		.equ LED3,      IOBASE+0x000003f
                        50 		.equ LED2,      IOBASE+0x000003d
                        51 		.equ LED1,      IOBASE+0x000003b
                        52 		.equ LED0,      IOBASE+0x0000039
                        53 
                        54 		***************************************************************
                        55 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        56 		***************************************************************
                        57 		.section .bss
                        58 		.even
                        59 SYS_STK:
0009fc 0000 0000        60 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
                        61 		.even
                        62 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
0049fc 0000 0000        63 		WORK: .ds.b 256 /*step6_test*/
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
                        64 		***************************************************************
                        65 		** ÂàùÊúüÂåñ
                        66 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        67 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        68 		***************************************************************
                        69 		.section .text
                        70 		.even
                        71 boot:
                        72 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        73 		move.w #0x2700,%SR
000404 4FF9 0000        74 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             74 
                        75 
                        76 		****************
                        77 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        78 		****************
00040a 13FC 0040        79 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        79 
000412 23FC 00FF        80 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        80 
       F304             80 
                        81 
                        82 		****************
                        83 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        84 		****************
00041c 33FC 0000        85 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        85 
000424 33FC E108        86 		move.w #0xe108, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        86 
00042c 33FC 0038        87 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        87 
                        88 
                        89 		****************
                        90 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        91 		****************
000434 33FC 0004        92 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        92 
                        93 
                        94 		***************************************************************
                        95 		** STEP2„ÅÆÂá¶ÁêÜ
                        96 		***************************************************************
                        97 		*lea.l uart1_interrupt, %a0
                        98 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 23FC 00FF        99 		move.l #0x00ff3ff9,IMR  |UART1Ë®±ÂèØ
       3FF9 00FF        99 
       F304             99 
                       100 
                       101 		/*trap #0„Å´ÁôªÈå≤*/
000446 21FC 0000       102 		move.l #CALL_SYSTEM, 0x080
       0000 0080       102 
                       103 
00044e 21FC 0000       104 		move.l #uart1_interrupt, 0x110
       0000 0110       104 
000456 21FC 0000       105 		move.l #timer1_interrupt, 0x118 /* „Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„ÅÆÁôªÈå≤ */
       0000 0118       105 
                       106 		
                       107 
                       108 		/* task_p „Å´„Çø„Ç§„Éû„ÉºÂâ≤„ÇäËæº„Åø„ÅßÂÆüË°å„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆ„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•„Çå„Å¶„Åä„Åè
                       109 		*lea.l TT,  %a0
                       110 		*move.l	%a0, task_p
                       111 		*move.l #TT, task_p
                       112 
                       113 		/*step9„ÅÆMAIN„Å∏*/
00045e 6000 00C4       114 		bra MAIN		
                       115 
                       116 
                       117 
                       118 /*trap #0„Åß„ÅÆÂá¶ÁêÜ,SYSTEMCALL*/
                       119 CALL_SYSTEM:
                       120 	*move.w #0x2000, %SR /* „Åì„ÅÑ„Å§„ÅÆ„Åõ„ÅÑ„Åß„ÄÅ„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Ç®„É©„ÉºÁô∫Áîü */
                       121 
000462 0C40 0001       122 	cmpi #1, %d0
000466 6600 000A       123 	bne CALL_PUT
                       124 
                       125 	*lea.l GETSTRING, %a0
                       126 	*move.l (%a0), %d0
                       127 	*jmp (%a0)
                       128 	
00046a 4EBA 0248       129 	jsr GETSTRING	
                       130 	
00046e 6000 0032       131 	bra CALL_END
                       132 
                       133 CALL_PUT:
000472 0C40 0002       134 	cmpi #2, %d0
000476 6600 000A       135 	bne CALL_RESET
                       136 
                       137 	*lea.l PUTSTRING, %a0
                       138 	*move.l (%a0), %d0
                       139 	*jmp %a0
                       140 
00047a 4EBA 01E8       141 	jsr PUTSTRING
                       142 
00047e 6000 0022       143 	bra CALL_END
                       144 
                       145 
                       146 CALL_RESET:
000482 0C40 0003       147 	cmpi #3, %d0
000486 6600 000A       148 	bne CALL_SET
                       149 	
                       150 	*lea.l RESET_TIMER, %a0
                       151 	*move.l (%a0), %d0
                       152 	*jmp (%a0)
                       153 	
00048a 4EBA 0018       154 	jsr RESET_TIMER
                       155 	
00048e 6000 0012       156 	bra CALL_END
                       157 
                       158 CALL_SET:
000492 0C40 0004       159 	cmpi #4, %d0
000496 6600 000A       160 	bne CALL_END
                       161 
                       162 	*lea.l SET_TIMER, %a0
                       163 	*move.l (%a0), %d0
                       164 	*jmp (%a0)
                       165 	
00049a 4EBA 001A       166 	jsr SET_TIMER
                       167 	
00049e 6000 0002       168 	bra CALL_END
                       169 
                       170 
                       171 CALL_END:
0004a2 4E73            172 	rte /* ‚òì rte -> rts */
                       173 
                       174 
                       175 
                       176 *****************************************************************************************
                       177 ** TIMER SETTING
                       178 *****************************************************************************************
                       179 
                       180 ************************************************************* 
                       181 **RESET_TIMER 
                       182 **Ê©üËÉΩ 
                       183 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã 
                       184 ************************************************************* 
                       185 
                       186 RESET_TIMER: 
0004a4 13FC 0035       187 	move.b  #'5', LED3      /*ÊñáÂ≠ó‚Äô5‚Äô„ÇíLED„ÅÆ4Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 003F       187 
0004ac 33FC 0004       188 	move.w #0x0004, TCTL1 /* 1.TCTL1„Çí„Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢„Å´Ë®≠ÂÆö */ 
       00FF F600       188 
0004b4 4E75            189 	rts
                       190 
                       191 
                       192   
                       193 ************************************************************* 
                       194 **SET_TIMER 
                       195 **Ê©üËÉΩ 
                       196 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âëº„Å≥
                       197 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÂë®Êúüt„ÇíË®≠ÂÆö„ÅóÔºåt*0.1msecÁßíÊØé„Å´Ââ≤„ÇäËæº„Åø„ÅåÁô∫Áîü„Åô„Çã„Çà„ÅÜ„Å
                       198 **	„Çø„Ç§„Éû‰ΩøÁî®„ÇíË®±ÂèØ„ÅóÔºå„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„ÇíË®±ÂèØ„Åô„ÇãÔºé(=„Çø„Ç§„Éû„Çí„Çπ„Çø„Éº„Éà„
                       199 **ÂÖ•Âäõ 
                       200 **	d1:„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü 
                       201 **	d2:Ââ≤„ÇäËæº„ÅøÊôÇ„Å´Ëµ∑Âãï„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       202 **Êàª„ÇäÂÄ§ 
                       203 **	„Å™„Åó 
                       204 *************************************************************
                       205   
                       206 
                       207 SET_TIMER:
0004b6 13FC 0031       208 	move.b  #'1', LED7      /*ÊñáÂ≠ó‚Äô1‚Äô„ÇíLED„ÅÆ8Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002F       208 
0004be 23C2 0000       209 	move.l %d2, task_p /* 1.Ââ≤„ÇäËæº„Åø„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„ÇíÔºåtask_p„Å´‰ª£ÂÖ• „Å°„Çá„
       0000            209 
0004c4 33FC 00CE       210 	move.w #0x00ce, TPRER1 /* 2.TPRER1„Çí„ÄÅ0.1msecÈÄ≤„ÇÄ„Å®„Ç´„Ç¶„É≥„Çø„Åå1Â¢ó„Åà„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö *
       00FF F602       210 
0004cc 33C1 00FF       211 	move.w %d1, TCMP1 /* 3.„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü„ÇíÔºåTCMP1„Å´‰ª£ÂÖ• Ë¶Å‰øÆÊ≠£ */ 
       F604            211 
0004d2 33FC 0015       212 	move.w #0x0015, TCTL1 /* 4.TCTL1„ÇíÂâ≤„ÇäËæº„ÅøË®±ÂèØ„Å´Ë®≠ÂÆö */  
       00FF F600       212 
0004da 4E75            213 	rts
                       214 
                       215 ************************************************************* 
                       216 **CALL_RP 
                       217 **Ê©üËÉΩ 
                       218 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âá¶ÁêÜ„Åô„Åπ„Åç„É´„Éº„ÉÅ„É≥„ÇíÂëº„Å≥Âá∫„Åô 
                       219 ************************************************************* 
                       220 
                       221 CALL_RP: 
0004dc 13FC 0032       222 	move.b  #'2', LED6      /*ÊñáÂ≠ó‚Äô2‚Äô„ÇíLED„ÅÆ7Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002D       222 
0004e4 2079 0000       223 	movea.l task_p, %a0
       0000            223 
0004ea 4E90            224 	jsr (%a0)
                       225 	*jsr task_p /* 1.task_p„ÅÆÊåá„Åô„Ç¢„Éâ„É¨„Çπ„Å∏„Ç∏„É£„É≥„Éó„Åô„Çã „Åì„ÅìËá™‰ø°„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„Å™„Ç
0004ec 4E75            226 	rts /* Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„Å´Êàª„Çã */ 
                       227 
                       228  
                       229 ************************************************************* 
                       230 **p 
                       231 **Ê©üËÉΩ 
                       232 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥ 
                       233 **Â§öÂàÜÂêÑËá™„Åß‰ΩúÊàê (Ë™≤È°å10) 
                       234 ************************************************************* 
                       235 *p: 
                       236 	*rts /* CALL_RP„Å´Êàª„Çã */ 
                       237  
                       238 
                       239 
                       240 
                       241 ***************************************************************************************************
                       242 **   CALL SETTING
                       243 ***************************************************************************************************
                       244 /*ÂêÑ„Ç∑„Çπ„ÉÜ„É†„ÅÆÂëº„Å≥Âá∫„Åó,t„ÉÜ„Çπ„Éà„Åß„ÅØMAIN„Å´„ÅÇ„Çã„Åü„ÇÅ‰ΩøÁî®„Åó„Å™„ÅÑ?*/
                       245 /*GETSTRINGÂëº„Å≥Âá∫„Åó*/
                       246 CALL_GETSTRING:
0004ee 7001            247 	move.l #1, %d0		/*GETSTRING*/
0004f0 7200            248 	move.l #0,%d1		/*ch=0*/
0004f2 243C 0000       249 	move.l #BUF, %d2	/*p=#BUF*/
       0000            249 
0004f8 263C 0000       250 	move.l #256, %d3	/*size=256*/
       0100            250 
0004fe 4E40            251 	trap #0
                       252 
                       253 /*PUTSTRINGÂëº„Å≥Âá∫„Åó*/
                       254 CALL_PUTSTRING:
000500 7002            255 	move.l #2, %d0		/*PUTSTRING*/
000502 7200            256 	move.l #0,%d1		/*ch=0*/
000504 243C 0000       257 	move.l #BUF, %d2	/*p=#BUF*/
       0000            257 
00050a 263C 0000       258 	move.l #256, %d3	/*size=256*/
       0100            258 
000510 4E40            259 	trap #0
                       260 
                       261 /*RESET_TIMERÂëº„Å≥Âá∫„Åó*/
                       262 CALL_RESET_TIMER:
000512 7003            263 	move.l #3, %d0		/*RESET_TIMER*/
000514 4E40            264 	trap #0
                       265 
                       266 /*SET_TIMERÂëº„Å≥Âá∫„Åó*/
                       267 CALL_SET_TIMER:
000516 7004            268 	move.l #4, %d0		/*SET_TIMER*/
000518 323C C350       269 	move.w #50000, %d1		/*d1=„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü*/
00051c 243C 0000       270 	move.l #TT, %d2		/*„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπd2=#TT*/
       0000            270 
000522 4E40            271 	trap #0
                       272 
                       273 
                       274 /*‰ª•‰∏ästep8*/
                       275 
                       276 
                       277 
                       278 
                       279 
                       280 ******************************************************
                       281 ***„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´Áï™Âè∑
                       282 ******************************************************
                       283 	.equ SYSCALL_NUM_GETSTRING,	1
                       284 	.equ SYSCALL_NUM_PUTSTRING,	2
                       285 	.equ SYSCALL_NUM_RESET_TIMER,	3
                       286 	.equ SYSCALL_NUM_SET_TIMER,	4
                       287 
                       288 
                       289 ******************************************************
                       290 ***„Éó„É≠„Ç∞„É©„É†È†òÂüü
                       291 ******************************************************
                       292 .section .text
                       293 .even
                       294 MAIN:						/*Ëµ∞Ë°å„É¢„Éº„Éâ„Å®„É¨„Éô„É´„ÅÆË®≠ÂÆö(„É¶„Éº„Ç∂„É¢„Éº„Éâ„Å∏ÁßªË°å)*/
                       295 
000524 4EB9 0000       296 	jsr Init_Q
       0000            296 
00052a 46FC 0000       297 	move.w #0x0000, %SR				/*USER_MODE_LEBEL„Çí0„Å´*/
00052e 4FF9 0000       298 	lea.l USR_STK_TOP, %SP				/*USER_STACK„ÇíË®≠ÂÆö*/
       0000            298 
                       299 
                       300 
000534 7003            301 	move.l #SYSCALL_NUM_RESET_TIMER, %d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßRESET_TIMER„ÅÆËµ∑Âãï*/
000536 4E40            302 	trap #0
                       303 
                       304 
000538 7004            305 	move.l #SYSCALL_NUM_SET_TIMER,%d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßSET_TIMER„ÅÆËµ∑Âãï*/
00053a 323C C350       306 	move.w #50000, %d1
00053e 243C 0000       307 	move.l #TT, %d2
       0000            307 
000544 4E40            308 	trap #0
                       309 
000546 6000 0002       310 	bra LOOP
                       311 
                       312 ******************************************************
                       313 ***sys_GETSTRING,SYS_PUTSTRING„ÅÆ„ÉÜ„Çπ„Éà
                       314 ***„Çø„Éº„Éü„Éä„É´„ÅÆÂÖ•Âäõ„Çí„Ç®„Ç≥„Éº„Éê„ÉÉ„ÇØ
                       315 ******************************************************
                       316 
                       317 LOOP:
00054a 7001            318 	move.l #SYSCALL_NUM_GETSTRING, %d0	/*GETSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
00054c 7200            319 	move.l #0, %d1				/*ch=0*/
00054e 243C 0000       320 	move.l #BUF, %d2			/*p=#BUF*/
       0000            320 
000554 263C 0000       321 	move.l #256, %d3			/*size=256*/
       0100            321 
00055a 4E40            322 	trap #0
                       323 
00055c 2600            324 	move.l %d0, %d3				/*size=d0*/
00055e 7002            325 	move.l #SYSCALL_NUM_PUTSTRING, %d0	/*PUTSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
000560 7200            326 	move.l #0, %d1				/*ch=0*/
000562 243C 0000       327 	move.l #BUF, %d2			/*p=#BUF*/
       0000            327 
000568 4E40            328 	trap #0
                       329 
00056a 6000 FFDE       330 	bra LOOP
                       331 
                       332 ******************************************************
                       333 ***„Çø„Ç§„Éû„ÅÆ„ÉÜ„Çπ„Éà
                       334 ***'******'„ÇíË°®Á§∫„ÅóÊîπË°å
                       335 ***5ÂõûÂÆüË°å„Åó„Å¶RESET_TIMER
                       336 ******************************************************
                       337 
                       338 TT:
00056e 13FC 0034       339 	move.b  #'4', LED4      /*ÊñáÂ≠ó‚Äô4‚Äô„ÇíLED„ÅÆ5Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 0029       339 
000576 48E7 FFFE       340 	movem.l %d0-%d7/%a0-%a6,-(%SP)		/*„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
00057a 0C79 0005       341 	cmpi.w #5, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Åß5ÂõûÂÆüË°å„Çí„Ç´„Ç¶„É≥„Éà*/
       0000 0000       341 
000582 6700 001C       342 	beq TTKILL				/*5ÂõûÂÆüË°å„Åó„Åü„Çâ„Çø„Ç§„Éû„ÇíÂÅúÊ≠¢*/
                       343 
000586 7002            344 	move.l #SYSCALL_NUM_PUTSTRING, %d0
000588 7200            345 	move.l #0, %d1				/*ch=0*/
00058a 243C 0000       346 	move.l #TMSG, %d2			/*p=#TMSG*/
       0000            346 
000590 7608            347 	move.l #8, %d3				/*size=8*/
000592 4E40            348 	trap #0
                       349 
000594 0679 0001       350 	addi.w #1, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Çí1„Å§Â¢ó„ÇÑ„Åô*/
       0000 0000       350 
00059c 6000 0006       351 	bra TTEND				/*„Åù„ÅÆ„Åæ„ÅæÊàª„Çã*/
                       352 
                       353 TTKILL:
0005a0 7003            354 	move.l #SYSCALL_NUM_RESET_TIMER, %d0	/*RESET_TIMER„ÅÆÂëº„Å≥Âá∫„Åó*/
0005a2 4E40            355 	trap #0
                       356 TTEND:
0005a4 4CDF 7FFF       357 	movem.l (%SP)+, %d0-%d7/%a0-%a6		/*„É¨„Ç∏„Çπ„ÇøÂæ©Â∏∞*/
0005a8 4E75            358 	rts
                       359 
                       360 
                       361 
                       362 
                       363 *****************************************************
                       364 **    Ââ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éï„Çß„Éº„Çπ
                       365 *****************************************************
                       366 uart1_interrupt:
0005aa 48E7 F000       367 	movem.l %d0-%d3, -(%sp)
                       368 
                       369 
0005ae 3639 00FF       370 	move.w URX1, %d3
       F904            370 
0005b4 1403            371 	move.b %d3, %d2
0005b6 0C43 2000       372 	cmp.w #0x2000, %d3
0005ba 6400 0086       373 	bcc INTERGET
                       374 
                       375 
0005be 3039 00FF       376 	move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            376 
0005c4 7200            377 	move.l #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
0005c6 0C40 8000       378 	cmp.w #0x8000,%d0
0005ca 6400 0034       379 	bcc INTERPUT
                       380 
                       381 		
                       382 		
                       383 
0005ce 4CDF 000F       384 	movem.l (%sp)+, %d0-%d3
0005d2 4E73            385 	rte
                       386 
                       387 
                       388 
                       389 
                       390 ************************************************************
                       391 ** „Çø„Ç§„Éû„ÉºÂâ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
                       392 ************************************************************
                       393 
                       394 timer1_interrupt:
0005d4 13FC 0033       395 	move.b  #'3', LED5      /*ÊñáÂ≠ó‚Äô3‚Äô„ÇíLED„ÅÆ6Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002B       395 
0005dc 48E7 0800       396 	movem.l %d4, -(%sp)
                       397 	*move.w %SR, %d3
                       398 	*move.w #0x2600, %SR
                       399 
                       400 	*move.l #0, %d4
                       401 	*move.b TSTAT1, %d4
                       402 	*andi.b #0x01, %d4	/* 0bit„Åå1„Å™„Çâ d4 == 1,0„Å™„Çâ d4 == 0 */
                       403 	*cmpi.b #0, %d4 /* 0 -> 1 */
                       404 	*beq timer1_end
                       405 
                       406 /* ‰ª•‰∏ã‰øÆÊ≠£ÈÉ®ÂàÜ */
0005e0 3839 00FF       407 	move.w TSTAT1, %d4
       F60A            407 
0005e6 0C44 0001       408 	cmpi.w #0x01, %d4 /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„ÅãÊØîËºÉ */
0005ea 6600 000E       409 	bne timer1_end /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„Å™„Çâ„ÄÅrte„ÅßÂæ©Â∏∞ */
0005ee 5344            410 	sub.w #0x01, %d4 /* 2.Á¨¨0„Éì„ÉÉ„Éà„Çí0„ÇØ„É™„Ç¢ */
0005f0 33C4 00FF       411 	move.w %d4, TSTAT1
       F60A            411 
0005f6 4EBA FEE4       412 	jsr CALL_RP
                       413 /* ‰ª•‰∏ä‰øÆÊ≠£ÈÉ®ÂàÜ */
                       414 
                       415 timer1_end:
                       416 	*move.w %d3, %SR
0005fa 4CDF 0010       417 	movem.l (%sp)+, %d4
0005fe 4E73            418 	rte
                       419 
                       420 
                       421 
                       422 
                       423 **************************************************************
                       424 ** INTERPUT
                       425 ** ÂºïÊï∞
                       426 ** D1 : „ÉÅ„É£„Éç„É´„ÅÆÈÅ∏Êäû
                       427 ** Êàª„ÇäÂÄ§
                       428 **     „Å™„Åó
                       429 **************************************************************
                       430 
                       431 INTERPUT:
000600 48E7 E000       432 	movem.l %d0-%d2, -(%sp)
                       433 
000604 46FC 2700       434 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       435 	
000608 0C81 0000       436 	cmp.l #0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
       0000            436 
                       437 
00060e 6600 001C       438 	bne INTERPUT_END
                       439 
000612 7001            440 	move.l #1, %d0
                       441 	*move.w #0x0800+'a', UTX1
000614 4EB9 0000       442 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            442 
                       443 
00061a 0C40 0000       444 	cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
00061e 6700 0016       445 	beq INTERPUT_MASK
                       446 	*move.b %d1, %d2
000622 0641 0800       447 	addi.w #0x0800, %d1
                       448 	*move.w #0x0800+'f', UTX1
000626 33C1 00FF       449 	move.w %d1, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            449 
                       450 a:
                       451 
                       452 INTERPUT_END:
                       453 	*move.w #0x0800+'c', UTX1
00062c 4CDF 0007       454 	movem.l (%sp)+, %d0-%d2
000630 4CDF 000F       455 	movem.l (%sp)+, %d0-%d3
000634 4E73            456 	rte
                       457 
                       458 INTERPUT_MASK:
                       459 	*move.w #0x0800+'b', UTX1
000636 33FC E108       460 	move.w #0xe108, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       460 
00063e 6000 FFEC       461 	bra INTERPUT_END
                       462 
                       463 
                       464 *******************************
                       465 **INTERGET
                       466 **d1:„ÉÅ„É£„Éç„É´
                       467 **d2:Âèó‰ø°„Éá„Éº„Çø
                       468 *******************************
                       469 INTERGET:
                       470 	
000642 48E7 FFFE       471 	movem.l %a0-%a6/%d0-%d7, -(%SP)
                       472 
000646 0C81 0000       473 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            473 
                       474 	
00064c 6600 000C       475 	bne INTERGET_END
                       476 
000650 7000            477 	move.l #0, %d0		/*„Ç≠„É•„ÉºÁï™Âè∑„ÇíË®≠ÂÆö*/
                       478 
000652 1202            479 	move.b %d2,%d1		/*„Ç≠„É•„Éº„Å´ÂÖ•„Çå„Çã„Éá„Éº„Çø„Çíd1„Å´Ê†ºÁ¥ç*/
                       480 	
000654 4EB9 0000       481 	jsr INQ
       0000            481 
                       482 
                       483 INTERGET_END:
00065a 4CDF 7FFF       484 	movem.l (%SP)+, %a0-%a6/%d0-%d7
00065e 4CDF 000F       485 	movem.l (%sp)+, %d0-%d3
                       486 	
000662 4E73            487 	rte
                       488 
                       489 
                       490 
                       491 *************************************************************
                       492 **PUTSTRING
                       493 **ÂÖ•Âäõ
                       494 **d1:„ÉÅ„É£„Éç„É´
                       495 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       496 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       497 **Êàª„ÇäÂÄ§
                       498 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       499 *************************************************************
                       500 PUTSTRING:
000664 48E7 7FFE       501 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       502 
000668 0C81 0000       503 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            503 
                       504 	
00066e 6600 003C       505 	bne PUTSTRING_END
                       506 	
000672 7800            507 	move.l #0,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       508 
000674 2242            509 	move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ*/
                       510 
000676 0C83 0000       511 	cmp.l #0,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            511 
                       512 
00067c 6700 002E       513 	beq PUTSTRING_END
                       514 
                       515 LOOP_STEP5:
000680 B684            516 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       517 
000682 6700 001C       518 	beq PUTSTRING_MASK
                       519 
000686 7001            520 	move.l #1,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       521 
000688 1219            522 	move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       523 
00068a 4EB9 0000       524 	jsr INQ
       0000            524 
                       525 
000690 0C80 0000       526 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            526 
                       527 
000696 6700 0008       528 	beq PUTSTRING_MASK
                       529 
                       530 
00069a 5244            531 	addq #1,%d4		/*sz++*/
                       532 
00069c 6000 FFE2       533 	bra LOOP_STEP5
                       534 
                       535 PUTSTRING_MASK:
0006a0 33FC E10C       536 	move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       536 
                       537 
0006a8 6000 0002       538 	bra PUTSTRING_END
                       539 
                       540 PUTSTRING_END:
0006ac 2004            541 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       542 	
0006ae 4CDF 7FFE       543 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       544 
0006b2 4E75            545 	rts 			/*?*/
                       546 
                       547 
                       548 *************************************************************
                       549 **GETSTRING
                       550 **ÂÖ•Âäõ
                       551 **d1:„ÉÅ„É£„Éç„É´
                       552 **d2:„Éá„Éº„ÇøÊõ∏„ÅçËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       553 **d3:Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆÊï∞
                       554 **Êàª„ÇäÂÄ§
                       555 **d0:ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„ÅÆÊï∞
                       556 *************************************************************
                       557 GETSTRING:
                       558 	*move.w #0x0800+'c', UTX1
0006b4 48E7 7FFE       559 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       560 
0006b8 0C81 0000       561 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            561 
                       562 	
0006be 6600 0026       563 	bne GETSTRING_END
                       564 
0006c2 7800            565 	move.l #0,%d4 		/*%d4=sz:Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       566 
0006c4 2242            567 	move.l %d2,%a1 		/*%a1:„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Ç¢„Éâ„É¨„Çπ*/
                       568 
                       569 LOOP_STEP6:
0006c6 B684            570 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       571 
0006c8 6700 001C       572 	beq GETSTRING_END
                       573 	
0006cc 7000            574 	move.l #0,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       575 	
0006ce 4EB9 0000       576 	jsr OUTQ
       0000            576 
                       577 	
0006d4 0C80 0000       578 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            578 
                       579 
0006da 6700 000A       580 	beq GETSTRING_END
                       581 
0006de 12C1            582 	move.b %d1,(%a1)+	/*Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„Çí„Ç≥„Éî„Éº*/
                       583 
0006e0 5244            584 	addq #1,%d4		/*sz++*/
                       585 
0006e2 6000 FFE2       586 	bra LOOP_STEP6
                       587 
                       588 GETSTRING_END:
0006e6 2004            589 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       590 
0006e8 4CDF 7FFE       591 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       592 
0006ec 4E75            593 	rts
                       594 
                       595 
                       596 
                       597 
                       598 ***************************************************************************************************
                       599 ***      QUEUE SETTING
                       600 ***************************************************************************************************
                       601 
                       602 .section .data
                       603 .equ TOP, 0
                       604 .equ BOTTOM, 4
                       605 .equ IN, 8
                       606 .equ OUT, 12
                       607 .equ S, 16
                       608 .equ DATA_TOP, 18
                       609 .equ DATA_LEN, 256
                       610 .equ QUEUE_SIZE, DATA_TOP + DATA_LEN /* 18 + 256 = 274 */
                       611 
0006f0 0000 0000       612 QUEUE_TOP: ds.b QUEUE_SIZE * 2
       0000 0000       612 
       0000 0000       612 
       0000 0000       612 
       0000 0000       612 
                       613 
                       614 /* ÂàùÊúüÂåñ */
                       615 ********************
                       616 * ÂàùÊúüÂåñ
                       617 ********************
                       618 
                       619 Init_Q:
000914 48E7 C0E0       620     movem.l %d0-%d1/%a0-%a2, -(%sp) /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÈÄÄÈÅø */
                       621 
000918 7000            622     move.l #0, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑ = 0 */
                       623 
                       624 Init_Q_sub:
00091a 41FA FDD4       625     lea.l QUEUE_TOP, %a0 /* „Ç≠„É•„Éº„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
00091e 2200            626     move.l %d0, %d1
000920 C2F8 0112       627     mulu.w QUEUE_SIZE, %d1 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000924 D1C1            628     add.l %d1, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000926 43E8 0012       629     lea.l DATA_TOP(%a0), %a1 /* a1 = „Ç≠„É•„Éºn„ÅÆ„Éá„Éº„ÇøÈ†òÂüüÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = DATA_TOP + a0
00092a 2089            630     move.l %a1, TOP(%a0) /* „Ç≠„É•„Éºn„ÅÆTOP„ÅÆ„Ç¢„Éâ„É¨„Çπ = a0 + TOP „Åß„ÅÇ„Çã„ÅÆ„Åß„Åù„Åì„Å´a1„Ç
00092c 2149 0008       631     move.l %a1, IN(%a0) /* „Ç≠„É•„Éºn„ÅÆIN„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000930 2149 000C       632     move.l %a1, OUT(%a0) /* „Ç≠„É•„Éºn„ÅÆOUT„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000934 43E8 0111       633     lea.l QUEUE_SIZE-1(%a0), %a1 /* a1 == BOTTOM = „Ç≠„É•„Éºn„ÅÆÁµÇÁ´Ø„Ç¢„Éâ„É¨„Çπ */
000938 2149 0004       634     move.l %a1,BOTTOM(%a0)/*„Ç≠„É•„Éºn„ÅÆBOTTOM„Å´a1„ÇíÊ†ºÁ¥ç*/
00093c 317C 0000       635     move.w #0, S(%a0) /* „Éá„Éº„ÇøÊï∞ = 0 */
       0010            635 
000942 5280            636     addq.l #1, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑++ */
000944 0C80 0000       637     cmpi.l #2, %d0 /* „Ç≠„É•„Éº„ÅÆÂÄãÊï∞ÂàÜ(2)„É´„Éº„Éó */
       0002            637 
00094a 6600 FFCE       638     bne Init_Q_sub
                       639 
00094e 4CDF 0703       640     movem.l (%sp)+, %d0-%d1/%a0-%a2 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
000952 4E75            641     rts
                       642 
                       643 
                       644 *****************
                       645 ** INQ
                       646 *****************
                       647 
                       648 **************************************
                       649 **ÂÖ•Âäõ
                       650 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû [long]
                       651 **  d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø [long]
                       652 **Âá∫Âäõ
                       653 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       654 **************************************
                       655 INQ:
                       656 
                       657     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
000954 40E7            658     move.w %SR, -(%sp)
                       659 
                       660     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000956 46FC 2700       661     move.w #0x2700, %SR
                       662 
00095a 48E7 00C0       663     movem.l %a0-%a1, -(%sp)
00095e 41FA FD90       664     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000962 C0F8 0112       665     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000966 D1C0            666     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       667 
000968 0C68 0100       668     cmpi.w #256, S(%a0)
       0010            668 
00096e 6600 0008       669     bne INQ_1
                       670 
                       671     /* S == 256„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000972 7000            672     move.l #0, %d0
000974 6000 0024       673     bra INQ_END
                       674 
                       675 INQ_1:
000978 2268 0008       676     movea.l IN(%a0), %a1 /* a1 = in */
00097c 1281            677     move.b %d1, (%a1) /* q[in] = d1 */ 
                       678 
00097e B3E8 0004       679     cmpa.l BOTTOM(%a0), %a1 /* in == bottom „Åã„ÇíÂà§ÂÆö */
000982 6600 000A       680     bne INQ_ELSE
                       681 
                       682     /* in == bottom „ÅÆ„Å®„Åç*/
000986 2150 0008       683     move.l TOP(%a0), IN(%a0) /* in = top */
00098a 6000 0008       684     bra INQ_2
                       685 
                       686 /* in != bottom „ÅÆ„Å®„Åç*/
                       687 INQ_ELSE:
00098e 5289            688     addq.l #1, %a1 /* a1++ */
000990 2149 0008       689     move.l %a1, IN(%a0) /* in = a1 */
                       690 
                       691 /* s++, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       692 INQ_2:
000994 5268 0010       693     addq.w #1, S(%a0)
000998 7001            694     move.l #1, %d0
                       695 
                       696 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       697 INQ_END:
00099a 4CDF 0300       698     movem.l (%sp)+, %a0-%a1 
00099e 46DF            699     move.w (%sp)+, %SR
0009a0 4E75            700     rts
                       701 
                       702 
                       703 *****************
                       704 * OUTQ
                       705 *****************
                       706 
                       707 **********************************************
                       708 **ÂÖ•Âäõ
                       709 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû  [long]
                       710 
                       711 **Âá∫Âäõ
                       712 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       713 **  d1:Âèñ„ÇäÁµÑ„Çì„Å†„Éá„Éº„Çø [byte]
                       714 **********************************************
                       715 OUTQ:
                       716     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
0009a2 40E7            717     move.w %SR, -(%sp)
                       718 
                       719     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
0009a4 46FC 2700       720     move.w #0x2700, %SR
                       721 
0009a8 48E7 00C0       722     movem.l %a0-%a1, -(%sp)
0009ac 41FA FD42       723     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
0009b0 C0F8 0112       724     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
0009b4 D1C0            725     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       726 
0009b6 0C68 0000       727     cmpi.w #0, S(%a0)
       0010            727 
0009bc 6600 0008       728     bne OUTQ_1
                       729 
                       730     /* S == 0„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
0009c0 7000            731     move.l #0, %d0
0009c2 6000 0024       732     bra OUTQ_END
                       733 
                       734 OUTQ_1:
0009c6 2268 000C       735     movea.l OUT(%a0), %a1 /* a1 = out */
0009ca 1211            736     move.b (%a1), %d1 /* d1 = q[out] */
                       737 
0009cc B3E8 0004       738     cmpa.l BOTTOM(%a0), %a1 /* out == bottom „Åã„ÇíÂà§ÂÆö */
0009d0 6600 000A       739     bne OUTQ_ELSE
                       740 
                       741     /* out == bottom „ÅÆ„Å®„Åç*/
0009d4 2150 000C       742     move.l TOP(%a0), OUT(%a0) /* out = top */
0009d8 6000 0008       743     bra OUTQ_2
                       744 
                       745 /* out != bottom „ÅÆ„Å®„Åç*/
                       746 OUTQ_ELSE:
0009dc 5289            747     addq.l #1, %a1 /* a1++ */
0009de 2149 000C       748     move.l %a1, OUT(%a0) /* out = a1 */
                       749 
                       750 /* s--, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       751 OUTQ_2:
0009e2 5368 0010       752     subq.w #1, S(%a0)
0009e6 7001            753     move.l #1, %d0
                       754 
                       755 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       756 OUTQ_END:
0009e8 4CDF 0300       757     movem.l (%sp)+, %a0-%a1 
0009ec 46DF            758     move.w (%sp)+, %SR
0009ee 4E75            759     rts
                       760 
                       761 
                       762 ***** 
                       763 
                       764 
                       765 
                       766 ******************************************************
                       767 *** ÂàùÊúüÂåñ„ÅÆ„ÅÇ„Çã„Éá„Éº„ÇøÈ†òÂüü
                       768 ******************************************************
                       769 
                       770 .section .data
                       771 TMSG:
0009f0 2A2A 2A2A       772 	.ascii	"******\r\n"			/*r:Ë°åÈ†≠„Å∏,n:ÊîπË°å*/
       2A2A 0D0A       772 
                       773 .even
                       774 TTC:
0009f8 0000            775 	.dc.w 0
                       776 	.even
                       777 
                       778 ******************************************************
                       779 *** ÂàùÊúüÂåñ„ÅÆ„Å™„ÅÑ„Éá„Éº„ÇøÈ†òÂüü
                       780 ******************************************************
                       781 .section .bss
                       782 
                       783 task_p:
004afc 0000 0000       784 	.ds.l	0x01
                       785 	.even
                       786 
                       787 BUF:
004b00 0000 0000       788 	.ds.b 256				/*BUF[256]*/
       0000 0000       788 
       0000 0000       788 
       0000 0000       788 
       0000 0000       788 
                       789 	.even
                       790 
                       791 
                       792 
                       793 USR_STK:
004c00 0000 0000       794 	.ds.b 0x4000				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü*/
       0000 0000       794 
       0000 0000       794 
       0000 0000       794 
       0000 0000       794 
                       795 	.even
                       796 
                       797 USR_STK_TOP:				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ*/
                       798 
                       799 
                       800 
