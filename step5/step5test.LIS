                         4 .list
                         5 		***************************************************************
                         6 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 		***************************************************************
                         8 
                         9 		***************
                        10 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        11 		***************
                        12 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        13 		.equ IOBASE,    0x00d00000
                        14 
                        15 		***************
                        16 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        17 		***************
                        18 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        19 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        20 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        21 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        22 
                        23 		***************
                        24 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        25 		***************
                        26 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        27 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        28 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        29 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        30 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        31 
                        32 		***************
                        33 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        34 		***************
                        35 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        36 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        37 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        38 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        39 
                        40 		***************
                        41 		** LED
                        42 		***************
                        43 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        44 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        45 		.equ LED5,      IOBASE+0x000002b
                        46 		.equ LED4,      IOBASE+0x0000029
                        47 		.equ LED3,      IOBASE+0x000003f
                        48 		.equ LED2,      IOBASE+0x000003d
                        49 		.equ LED1,      IOBASE+0x000003b
                        50 		.equ LED0,      IOBASE+0x0000039
                        51 
                        52 		***************************************************************
                        53 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        54 		***************************************************************
                        55 		.section .bss
                        56 		.even
                        57 SYS_STK:
0009e4 0000 0000        58 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
                        59 		.even
                        60 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        61 
                        62 		***************************************************************
                        63 		** ÂàùÊúüÂåñ
                        64 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        65 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        66 		***************************************************************
                        67 
                        68 
                        69 .section .data
                        70 .even
0005a8 3031 3233        71 	TDATA1: .ascii "0123456789ABCDEF"
       3435 3637        71 
       3839 4142        71 
       4344 4546        71 
0005b8 6B6C 6D6E        72 	TDATA2: .ascii "klmnopqrstuvwxyz"
       6F70 7172        72 
       7374 7576        72 
       7778 797A        72 
                        73 .even
                        74 
                        75 		
                        76 
                        77 .section .text
                        78 		.even
                        79 boot:
                        80 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        81 		move.w #0x2700,%SR
000404 4FF9 0000        82 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             82 
                        83 
                        84 		****************
                        85 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        86 		****************
00040a 13FC 0040        87 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        87 
000412 23FC 00FF        88 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        88 
       F304             88 
                        89 
                        90 		****************
                        91 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        92 		****************
00041c 33FC 0000        93 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        93 
000424 33FC E100        94 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        94 
00042c 33FC 0038        95 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        95 
                        96 
                        97 		****************
                        98 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        99 		*****************
000434 33FC 0004       100 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600       100 
                       101 
                       102 		***************************************************************
                       103 		** STEP2„ÅÆÂá¶ÁêÜ
                       104 		***************************************************************
                       105 		*lea.l uart1_interrupt, %a0
                       106 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
                       107 
                       108 
                       109 
                       110 
00043c 21FC 0000       111 		move.l #uart1_interrupt, 0x110
       0000 0110       111 
                       112 		*move.l #PUTSTRING, 0x110 /* add new level*/
                       113 		
                       114 
000444 6000 0002       115 		bra MAIN
                       116 
                       117 		***************************************************************
                       118 		** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                       119 		** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       120 		***************************************************************
                       121 		.section .text
                       122 		.even
                       123 
                       124 
                       125 
                       126 
                       127 	
                       128 MAIN:
                       129 
000448 4EB9 0000       130 		jsr Init_Q
       0000            130 
00044e 13FC 0031       131 		move.b #'1', LED7
       00D0 002F       131 
000456 33FC E108       132 		move.w #0xe108,USTCNT1
       00FF F900       132 
                       133 		*move.w #0xe108, USTCNT1 |ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„Åæ„Åß„Éû„Çπ„ÇØ
00045e 23FC 00FF       134 		move.l #0x00ff3ffb,IMR  |UART1Ë®±ÂèØ
       3FFB 00FF       134 
       F304            134 
000468 46FC 2000       135 		move.w #0x2000, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´0 */
                       136 
                       137 
                       138 PS_TEST1:
                       139 		/* jsr PUTSTRING(0, #TDATA1, 16)*/
00046c 7200            140 		move.l	#0x00, %d1
00046e 243C 0000       141 		move.l	#TDATA1, %d2
       0000            141 
000474 760F            142 		move.l	#0x0f, %d3
000476 4EBA 00DA       143 		jsr PUTSTRING
                       144 		
                       145 	
00047a 13FC 0032       146 		move.b #'2', LED6
       00D0 002D       146 
000482 283C 0000       147 		move.l	#0x000fff, %d4
       0FFF            147 
                       148 	
                       149 		
                       150 LOOP:
000488 5384            151 		subq.l #1,%d4
00048a 6700 001C       152 		beq PS_TEST2
00048e 13FC 0035       153 		move.b #'5', LED3
       00D0 003F       153 
                       154 		
                       155 	***
000496 1C3C 0061       156 		move.b #'a', %d6 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
00049a 0646 0800       157 		addi.w #0x0800, %d6 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
00049e 33C6 00FF       158 		move.w %d6, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ */
       F906            158 
                       159 	***	
0004a4 6000 FFE2       160 		bra LOOP
                       161 
                       162 PS_TEST2:
0004a8 13FC 0036       163 		move.b #'6', LED2
       00D0 003D       163 
0004b0 7200            164 		move.l	#0x00, %d1
0004b2 243C 0000       165 		move.l	#TDATA2, %d2
       0000            165 
0004b8 760F            166 		move.l	#0x0f, %d3
0004ba 4EBA 0096       167 		jsr PUTSTRING
0004be 6000 FFE8       168 		bra PS_TEST2
                       169 
                       170 /*‰ª•‰∏ã„ÉÜ„Çπ„Éà*/
                       171 TEST_READY:
                       172 		*movem.l %d1-%d5, -(%sp)
                       173 	
0004c2 383C 0010       174 		move.w #16, %d4
0004c6 3A3C 0010       175 		move.w #16, %d5
0004ca 123C 0061       176 		move.b #0x61, %d1
0004ce 6000 0008       177 		bra TEST_LOOP
                       178 
                       179 TEST_LOOP2:
                       180 
0004d2 5241            181 		addq #1, %d1
0004d4 383C 0010       182 		move.w #16, %d4
                       183 
                       184 TEST_LOOP:
0004d8 7001            185 		moveq #1, %d0
                       186 		*move.w #0x1000, %d0
0004da 4EB9 0000       187 		jsr INQ
       0000            187 
                       188 		*jsr OUTQ
0004e0 5344            189 		subq #1, %d4
0004e2 6600 FFF4       190 		bne TEST_LOOP
0004e6 5345            191 		subq #1, %d5
0004e8 6700 0006       192 		beq TEST_END
0004ec 6000 FFE4       193 		bra TEST_LOOP2
                       194 
                       195 TEST_END:
                       196 		*movem.l (%sp)+, %d1-%d5
0004f0 4E75            197 		rts
                       198 /*‰ª•‰∏ä„ÉÜ„Çπ„Éà*/
                       199 
                       200 uart1_interrupt:
0004f2 13FC 0033       201 		move.b #'3', LED5
       00D0 002B       201 
0004fa 48E7 8000       202 		movem.l %d0, -(%sp)
                       203 
                       204 		*move.b #'a', %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       205 		*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
                       206 		*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ *
                       207 
                       208 
0004fe 3039 00FF       209 		move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            209 
                       210 		
000504 123C 0000       211 		move.b #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
                       212 
000508 0C40 8000       213 		cmp #0x8000,%d0
00050c 6400 0008       214 		bcc INTERPUT
                       215 
000510 4CDF 0001       216 		movem.l (%sp)+, %d0
                       217 		
000514 4E73            218 		rte
                       219 
                       220 
                       221 INTERPUT:
000516 48E7 E000       222 	movem.l %d0-%d2, -(%sp)
                       223 
00051a 46FC 2700       224 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       225 	
00051e 0C01 0000       226 	cmp.b #0x0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
                       227 
000522 6600 0020       228 	bne INTERPUT_END
                       229 
000526 103C 0001       230 	move.b #1, %d0
                       231 	*move.w #0x0800+'a', UTX1
00052a 4EB9 0000       232 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            232 
                       233 
000530 0C40 0000       234 	cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
000534 6700 0018       235 	beq INTERPUT_MASK
000538 1401            236 	move.b %d1, %d2
                       237 
00053a 0642 0800       238 	addi.w #0x0800, %d2
                       239 	*move.w #0x0800+'d', UTX1
00053e 33C2 00FF       240 	move.w %d2, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            240 
                       241 
                       242 
                       243 INTERPUT_END:
                       244 	*move.w #0x0800+'c', UTX1
000544 4CDF 0007       245 	movem.l (%sp)+, %d0-%d2
000548 4CDF 0001       246 	movem.l (%sp)+, %d0
00054c 4E73            247 	rte
                       248 
                       249 INTERPUT_MASK:
                       250 	*move.w #0x0800+'b', UTX1
                       251 	*move.w #0xe100, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
00054e 6000 FFF4       252 	bra INTERPUT_END
                       253 
                       254 *************************************************************
                       255 **PUTSTRING
                       256 **ÂÖ•Âäõ
                       257 **d1:„ÉÅ„É£„Éç„É´
                       258 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       259 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       260 **Êàª„ÇäÂÄ§
                       261 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       262 *************************************************************
                       263 PUTSTRING:
000552 48E7 7FFE       264 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       265 
000556 0C01 0000       266 	cmp.b #0x00, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/	
00055a 6600 003C       267 	bne PUTSTRING_END
                       268 	/* rv: „Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅÆÊØîËºÉ„ÄÇÔºê„Åß„ÅØ„Å™„ÅÑ„Å®„Åç„Å´ÁµÇ‰∫Ü„Åô„Çã*/
                       269 	
00055e 383C 0000       270 	move.w #0x0000,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       271 	/* rv: „Éá„Éº„ÇøÊï∞(sz)„ÅÆÂàùÊúüÂåñ*/
                       272 
000562 2242            273 	move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ */
                       274 	/* rv: Ë™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Çía1„Å´Ê†ºÁ¥ç„Åô„Çã*/	
                       275 
000564 0C43 0000       276 	cmp.w #0x0000,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
000568 6700 002E       277 	beq PUTSTRING_END
                       278 	/* rv: d3(size)„Åå0„Å™„Çâ„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
                       279 
                       280 
                       281 LOOP_STEP5:
00056c B644            282 	cmp.w %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
00056e 6700 001C       283 	beq PUTSTRING_MASK
                       284 	/* d3 „Å® d4 size = sz „Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï*/
                       285 
000572 103C 0001       286 	move.b #0x01,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
000576 1219            287 	move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       288 	/* rv: ÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Åã„ÇâÈ†Ü„Å´Ê†ºÁ¥ç„Åô„Çã*/
                       289 
000578 4EB9 0000       290 	jsr INQ
       0000            290 
                       291 
00057e 0C00 0000       292 	cmp.b #0x00,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
000582 6700 0008       293 	beq PUTSTRING_MASK
                       294 	/*rv : Â§±Êïó„Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï„Åô„Çã*/
                       295 
000586 5244            296 	addq.w #0x01,%d4		/*sz++*/
000588 6000 FFE2       297 	bra LOOP_STEP5
                       298 
                       299 PUTSTRING_MASK:
                       300 
                       301 	*move.w #0xE10C, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
00058c 33FC E10C       302 	move.w #0xe10C, USTCNT1
       00FF F900       302 
000594 6000 0002       303 	bra PUTSTRING_END
                       304 
                       305 PUTSTRING_END:
                       306 
000598 3004            307 	move.w %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/	
00059a 4CDF 7FFE       308 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       309 
                       310 	*rte 			/*?*/
                       311 	/* bus errorÂá∫„Åü„ÅÆ„ÅßÂ§âÊõ¥„Åó„Åü*/
                       312 	
                       313 	***
00059e 13FC 0034       314 	move.b #'4', LED4
       00D0 0029       314 
                       315 	***
0005a6 4E75            316 	rts
                       317 
                       318 ******************************************************************************:
                       319 
                       320 ******
                       321 ******‰ª•ÈôçQUEUE
                       322 ******
                       323 
                       324 .section .data
                       325 .equ IN_COUNT, 257
                       326 .equ OUT_COUNT, 257
                       327 .equ queue_number, 1
                       328 .equ OFFSET_1, 0x100
                       329 .equ END_0, 0xff
                       330 .equ END_1, 0x1ff
0005c8 0000 0000       331 top: .ds.b 0x200
       0000 0000       331 
       0000 0000       331 
       0000 0000       331 
       0000 0000       331 
0007c8 0000 0000       332 bottom: .ds.l 1
0007cc 0000 0000       333 in: .ds.l 1
0007d0 0000 0000       334 in_0: .ds.l 1
0007d4 0000 0000       335 in_1: .ds.l 1
0007d8 0000 0000       336 out: .ds.l 1
0007dc 0000 0000       337 out_0: .ds.l 1
0007e0 0000 0000       338 out_1: .ds.l 1
0007e4 0000 0000       339 s: .ds.l 1
0007e8 0000 0000       340 s0: .ds.l 1
0007ec 0000 0000       341 s1: .ds.l 1
0007f0 0000 0000       342 START_LABEL: .ds.l 1
                       343 
                       344 /* ÂàùÊúüÂåñ*/
                       345 Init_Q:
0007f4 48E7 003E       346 movem.l %a2-%a6, -(%sp) /* ÂøúÊÄ•Âá¶ÁΩÆ*/
0007f8 45FA FDCE       347 lea.l top, %a2
0007fc 23CA 0000       348 move.l %a2, in_0
       0000            348 
000802 23CA 0000       349 move.l %a2, out_0
       0000            349 
000808 47EA 0100       350 lea.l OFFSET_1(%a2), %a3
00080c 23CB 0000       351 move.l %a3, in_1
       0000            351 
000812 23CB 0000       352 move.l %a3, out_1
       0000            352 
000818 49FA FFCA       353 lea.l s, %a4
00081c 4BFA FFCA       354 lea.l s0, %a5
000820 4DFA FFCA       355 lea.l s1, %a6
000824 28BC 0000       356 move.l #0,(%a4)
       0000            356 
00082a 2ABC 0000       357 move.l #0,(%a5)
       0000            357 
000830 2CBC 0000       358 move.l #0,(%a6)
       0000            358 
000836 4CDF 7C00       359 movem.l (%sp)+, %a2-%a6 /* ÂøúÊÄ•Âá¶ÁΩÆ*/
00083a 4E75            360 rts
                       361 
                       362 *****************************************************************
                       363 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       364 **d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø
                       365 **d1:Ëøî„ÇäÂÄ§„ÄÅÊàêÂäüorÂ§±Êïó
                       366 *****************************************************************
                       367 INQ:
00083c 48E7 1000       368 movem.l %d3, -(%sp)
000840 40C3            369 move.w %SR, %d3
000842 46FC 2700       370 move.w #0x2700, %SR
000846 4EBA 000E       371 jsr SELECT_QUEUE
00084a 4EBA 008C       372 jsr PUT_BUF
00084e 46C3            373 move.w %d3, %SR
000850 4CDF 0008       374 movem.l (%sp)+, %d3
000854 4E75            375 rts
                       376 
                       377 SELECT_QUEUE:
000856 0C00 0000       378 cmp.b #0, %d0
00085a 6700 000C       379 beq SET_0
00085e 0C00 0001       380 cmp.b #1, %d0
000862 6700 003A       381 beq SET_1
000866 4E75            382 rts
                       383 
                       384 SET_0:
000868 48E7 0030       385 movem.l %a2-%a3, -(%sp)
00086c 23FA FF62       386 move.l in_0, in
       0000 0000       386 
000874 23FA FF66       387 move.l out_0, out
       0000 0000       387 
                       388 
00087c 45FA FD4A       389 lea.l top, %a2
000880 23CA 0000       390 move.l %a2, START_LABEL
       0000            390 
000886 47EA 00FF       391 lea.l END_0(%a2), %a3
00088a 23CB 0000       392 move.l %a3, bottom
       0000            392 
000890 23FA FF56       393 move.l s0,s
       0000 0000       393 
000898 4CDF 0C00       394 movem.l (%sp)+, %a2-%a3
00089c 4E75            395 rts
                       396 
                       397 SET_1:
00089e 48E7 0030       398 movem.l %a2-%a3, -(%sp)
0008a2 23FA FF30       399 move.l in_1, in
       0000 0000       399 
0008aa 23FA FF34       400 move.l out_1, out
       0000 0000       400 
                       401 
0008b2 45FA FD14       402 lea.l top, %a2
0008b6 47EA 0100       403 lea.l OFFSET_1(%a2), %a3
0008ba 23CB 0000       404 move.l %a3, START_LABEL
       0000            404 
0008c0 47EA 01FF       405 lea.l END_1(%a2), %a3
0008c4 23CB 0000       406 move.l %a3, bottom
       0000            406 
0008ca 23FA FF20       407 move.l s1,s
       0000 0000       407 
0008d2 4CDF 0C00       408 movem.l (%sp)+, %a2-%a3
0008d6 4E75            409 rts
                       410 
                       411 PUT_BUF:
0008d8 48E7 407E       412 movem.l %a1-%a6/%d1, -(%sp)
                       413 
0008dc 243A FF06       414 move.l s,%d2
0008e0 0C82 0000       415 cmp.l #0x100,%d2
       0100            415 
0008e6 6700 0038       416 beq PUT_FAIL 
                       417 
0008ea 49FA FEF8       418 lea.l s,%a4
0008ee 5294            419 addq.l #1,(%a4)
0008f0 143C 0001       420 move.b #1,%d2 /*ÊàêÂäü*/
0008f4 227A FED6       421 movea.l in, %a1
0008f8 12C1            422 move.b %d1, (%a1)+  
                       423 
0008fa 267A FECC       424 move.l bottom, %a3
0008fe B3CB            425 cmpa.l %a3, %a1
000900 6300 0008       426 bls PUT_BUF_STEP1
000904 247A FEEA       427 move.l START_LABEL, %a2
000908 224A            428 movea.l %a2, %a1
                       429 
                       430 PUT_BUF_STEP1:
00090a 23C9 0000       431 move.l %a1, in
       0000            431 
000910 B3FA FEC6       432 cmpa.l out, %a1
000914 6600 0002       433 bne PUT_BUF_STEP2
                       434 
                       435 PUT_BUF_STEP2:
000918 4EBA 0014       436 jsr UPDATE
00091c 6000 000A       437 bra PUT_BUF_Finish
                       438 
                       439 PUT_FAIL:
000920 343C 0000       440 move.w #0,%d2 /*Â§±Êïó*/
000924 4EBA 0008       441 jsr UPDATE
                       442 
                       443 PUT_BUF_Finish:
000928 4CDF 7E02       444 movem.l (%sp)+, %a1-%a6/%d1
00092c 4E75            445 rts
                       446 
                       447 UPDATE:
00092e 0C00 0000       448 cmp.b #0, %d0
000932 6700 000C       449 beq QUEUE_0
000936 0C00 0001       450 cmp.b #1, %d0
00093a 6700 001E       451 beq QUEUE_1
00093e 4E75            452 rts
                       453 
                       454 QUEUE_0:
000940 23C9 0000       455 move.l %a1, in_0
       0000            455 
000946 23FA FE90       456 move.l out, out_0
       0000 0000       456 
00094e 23FA FE94       457 move.l s,s0
       0000 0000       457 
000956 3002            458 move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
                       459 
000958 4E75            460 rts
                       461 QUEUE_1:
00095a 23C9 0000       462 move.l %a1, in_1
       0000            462 
000960 23FA FE76       463 move.l out, out_1
       0000 0000       463 
000968 23FA FE7A       464 move.l s,s1
       0000 0000       464 
000970 3002            465 move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
000972 4E75            466 rts
                       467 
                       468 ********************************************
                       469 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       470 **d1:Êàª„ÇäÂÄ§„ÄÅÂèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø
                       471 ********************************************
                       472 OUTQ:
                       473 *move.w #0x0800+'a', UTX1
000974 48E7 1000       474 movem.l %d3, -(%sp)
000978 40C3            475 move.w %SR, %d3
00097a 46FC 2700       476 move.w #0x2700, %SR
00097e 4EBA FED6       477 jsr SELECT_QUEUE
000982 4EBA 000A       478 jsr GET_BUF
000986 46C3            479 move.w %d3, %SR
000988 4CDF 0008       480 movem.l (%sp)+, %d3
00098c 4E75            481 rts
                       482 
                       483 GET_BUF:
00098e 48E7 007E       484 movem.l %a1-%a6, -(%sp)
                       485 
000992 243A FE50       486 move.l s,%d2
000996 0C82 0000       487 cmp.l #0x00,%d2
       0000            487 
00099c 6700 0038       488 beq GET_FAIL
                       489 
0009a0 143C 0001       490 move.b #1,%d2 /*ÊàêÂäü*/
0009a4 49FA FE3E       491 lea.l s,%a4
0009a8 5394            492 subq.l #1,(%a4)
0009aa 227A FE2C       493 movea.l out, %a1
0009ae 1219            494 move.b (%a1)+, %d1     
0009b0 267A FE16       495 move.l bottom, %a3
0009b4 B3CB            496 cmpa.l %a3, %a1
0009b6 6300 0008       497 bls GET_BUF_STEP1
0009ba 247A FE34       498 move.l START_LABEL, %a2
0009be 224A            499 movea.l %a2, %a1
                       500 
                       501 GET_BUF_STEP1:
0009c0 23C9 0000       502 move.l %a1, out
       0000            502 
0009c6 B3FA FE04       503 cmpa.l in, %a1
0009ca 6600 0002       504 bne GET_BUF_STEP2
                       505 
                       506 GET_BUF_STEP2:
0009ce 4EBA FF5E       507 jsr UPDATE
0009d2 6000 000A       508 bra GET_BUF_Finish
                       509 
                       510 GET_FAIL:
0009d6 343C 0000       511 move.w #0,%d2 /*Â§±Êïó*/
0009da 4EBA FF52       512 jsr UPDATE
                       513 *move.w #0x0800+'e', UTX1
                       514 
                       515 GET_BUF_Finish:
0009de 4CDF 7E00       516 movem.l (%sp)+, %a1-%a6
0009e2 4E75            517 rts
                       518 
                       519 
                       520 
                       521 
                       522 
                       523 
                       524 
                       525 
                       526 
