                         4 .list
                         5 		***************************************************************
                         6 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 		***************************************************************
                         8 
                         9 		***************
                        10 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        11 		***************
                        12 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        13 		.equ IOBASE,    0x00d00000
                        14 
                        15 		***************
                        16 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        17 		***************
                        18 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        19 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        20 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        21 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        22 
                        23 		***************
                        24 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        25 		***************
                        26 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        27 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        28 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        29 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        30 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        31 
                        32 		***************
                        33 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        34 		***************
                        35 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        36 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        37 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        38 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        39 
                        40 		***************
                        41 		** LED
                        42 		***************
                        43 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        44 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        45 		.equ LED5,      IOBASE+0x000002b
                        46 		.equ LED4,      IOBASE+0x0000029
                        47 		.equ LED3,      IOBASE+0x000003f
                        48 		.equ LED2,      IOBASE+0x000003d
                        49 		.equ LED1,      IOBASE+0x000003b
                        50 		.equ LED0,      IOBASE+0x0000039
                        51 
                        52 		***************************************************************
                        53 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        54 		***************************************************************
                        55 		.section .bss
                        56 		.even
                        57 SYS_STK:
0009cc 0000 0000        58 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
                        59 		.even
                        60 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        61 
                        62 		***************************************************************
                        63 		** ÂàùÊúüÂåñ
                        64 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        65 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        66 		***************************************************************
                        67 		.section .text
                        68 		.even
                        69 boot:
                        70 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        71 		move.w #0x2700,%SR
000404 4FF9 0000        72 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             72 
                        73 
                        74 		****************
                        75 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        76 		****************
00040a 13FC 0040        77 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        77 
000412 23FC 00FF        78 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        78 
       F304             78 
                        79 
                        80 		****************
                        81 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        82 		****************
00041c 33FC 0000        83 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        83 
000424 33FC E100        84 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        84 
00042c 33FC 0038        85 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        85 
                        86 
                        87 		****************
                        88 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        89 		*****************
000434 33FC 0004        90 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        90 
                        91 
                        92 		***************************************************************
                        93 		** STEP2„ÅÆÂá¶ÁêÜ
                        94 		***************************************************************
00043c 41FA 0152        95 		lea.l uart1_interrupt, %a0
000440 21C8 0110        96 		move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„Ç
000444 33FC E108        97 		move.w #0xe108, USTCNT1 |Âèó‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ„ÄÅÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøÁÑ°Âäπ /* STEP2.2 */
       00FF F900        97 
00044c 23FC 00FF        98 		move.l #0x00ff3ffb,IMR  |Âèó‰ø°Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       3FFB 00FF        98 
       F304             98 
000456 46FC 2000        99 		move.w #0x2000, %SR    /* STEP2.4 Ââ≤„ÇäËæº„ÅøË®±ÂèØÔºé(„Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂„É¢„Éº„Éâ„ÅÆÂ†¥Âêà) 
                       100 
00045a 6000 0126       101 		bra MAIN
                       102 
                       103 		***************************************************************
                       104 		** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                       105 		** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       106 		***************************************************************
                       107 		.section .text
                       108 		.even
                       109 
                       110 
                       111 /*‰ª•‰∏ã„ÉÜ„Çπ„Éà*/
                       112 TEST_READY:
00045e 383C 0010       113 		move.w #16, %d4
                       114 TEST_LOOPa:
000462 323C 0061       115 		move.w #0x61, %d1
000466 4EB9 0000       116 		jsr INQ
       0000            116 
00046c 5344            117 		subq #1, %d4
00046e 6600 FFF2       118 		bne TEST_LOOPa
                       119 
000472 5241            120 		addq #1, %d1
000474 383C 0010       121 		move.w #16, %d4
                       122 TEST_LOOPb:
000478 4EB9 0000       123 		jsr INQ
       0000            123 
00047e 5344            124 		subq #1, %d4
000480 6600 FFF6       125 		bne TEST_LOOPb
                       126 
000484 5241            127 		addq #1, %d1
000486 383C 0010       128 		move.w #16, %d4
                       129 TEST_LOOPc:
00048a 4EB9 0000       130 		jsr INQ
       0000            130 
000490 5344            131 		subq #1, %d4
000492 6600 FFF6       132 		bne TEST_LOOPc
                       133 
000496 5241            134 		addq #1, %d1
000498 383C 0010       135 		move.w #16, %d4
                       136 TEST_LOOPd:
00049c 4EB9 0000       137 		jsr INQ
       0000            137 
0004a2 5344            138 		subq #1, %d4
0004a4 6600 FFF6       139 		bne TEST_LOOPd
                       140 
0004a8 5241            141 		addq #1, %d1
0004aa 383C 0010       142 		move.w #16, %d4
                       143 TEST_LOOPe:
0004ae 4EB9 0000       144 		jsr INQ
       0000            144 
0004b4 5344            145 		subq #1, %d4
0004b6 6600 FFF6       146 		bne TEST_LOOPe
                       147 
0004ba 5241            148 		addq #1, %d1
0004bc 383C 0010       149 		move.w #16, %d4
                       150 TEST_LOOPf:
0004c0 4EB9 0000       151 		jsr INQ
       0000            151 
0004c6 5344            152 		subq #1, %d4
0004c8 6600 FFF6       153 		bne TEST_LOOPf
                       154 
0004cc 5241            155 		addq #1, %d1
0004ce 383C 0010       156 		move.w #16, %d4
                       157 TEST_LOOPg:
0004d2 4EB9 0000       158 		jsr INQ
       0000            158 
0004d8 5344            159 		subq #1, %d4
0004da 6600 FFF6       160 		bne TEST_LOOPg
                       161 
0004de 5241            162 		addq #1, %d1
0004e0 383C 0010       163 		move.w #16, %d4
                       164 TEST_LOOPh:
0004e4 4EB9 0000       165 		jsr INQ
       0000            165 
0004ea 5344            166 		subq #1, %d4
0004ec 6600 FFF6       167 		bne TEST_LOOPh
                       168 
0004f0 5241            169 		addq #1, %d1
0004f2 383C 0010       170 		move.w #16, %d4
                       171 TEST_LOOPi:
0004f6 4EB9 0000       172 		jsr INQ
       0000            172 
0004fc 5344            173 		subq #1, %d4
0004fe 6600 FFF6       174 		bne TEST_LOOPi
                       175 
000502 5241            176 		addq #1, %d1
000504 383C 0010       177 		move.w #16, %d4
                       178 TEST_LOOPj:
000508 4EB9 0000       179 		jsr INQ
       0000            179 
00050e 5344            180 		subq #1, %d4
000510 6600 FFF6       181 		bne TEST_LOOPj
                       182 
000514 5241            183 		addq #1, %d1
000516 383C 0010       184 		move.w #16, %d4
                       185 TEST_LOOPk:
00051a 4EB9 0000       186 		jsr INQ
       0000            186 
000520 5344            187 		subq #1, %d4
000522 6600 FFF6       188 		bne TEST_LOOPk
                       189 
000526 5241            190 		addq #1, %d1
000528 383C 0010       191 		move.w #16, %d4
                       192 TEST_LOOPl:
00052c 4EB9 0000       193 		jsr INQ
       0000            193 
000532 5344            194 		subq #1, %d4
000534 6600 FFF6       195 		bne TEST_LOOPl
                       196 
000538 5241            197 		addq #1, %d1
00053a 383C 0010       198 		move.w #16, %d4
                       199 TEST_LOOPm:
00053e 4EB9 0000       200 		jsr INQ
       0000            200 
000544 5344            201 		subq #1, %d4
000546 6600 FFF6       202 		bne TEST_LOOPm
                       203 
00054a 5241            204 		addq #1, %d1
00054c 383C 0010       205 		move.w #16, %d4
                       206 TEST_LOOPn:
000550 4EB9 0000       207 		jsr INQ
       0000            207 
000556 5344            208 		subq #1, %d4
000558 6600 FFF6       209 		bne TEST_LOOPn
                       210 
00055c 5241            211 		addq #1, %d1
00055e 383C 0010       212 		move.w #16, %d4
                       213 TEST_LOOPo:
000562 4EB9 0000       214 		jsr INQ
       0000            214 
000568 5344            215 		subq #1, %d4
00056a 6600 FFF6       216 		bne TEST_LOOPo
                       217 
00056e 5241            218 		addq #1, %d1
000570 383C 0010       219 		move.w #16, %d4
                       220 TEST_LOOPp:
000574 4EB9 0000       221 		jsr INQ
       0000            221 
00057a 5344            222 		subq #1, %d4
00057c 6600 FFF6       223 		bne TEST_LOOPp
                       224 
                       225 
000580 4E75            226 		rts
                       227 /*‰ª•‰∏ä„ÉÜ„Çπ„Éà*/
                       228 
                       229 	
                       230 MAIN:
                       231 		*move.w #0x0800+'a', UTX1 | 0x0800„ÇíË∂≥„ÅôÁêÜÁî±„Å´„Å§„ÅÑ„Å¶„ÅØÔºå|‰ªòÈå≤ÂèÇÁÖß
                       232 
000582 4EB9 0000       233 		jsr Init_Q
       0000            233 
                       234 
000588 4EBA FED4       235 		jsr TEST_READY
                       236 		
                       237 LOOP:
00058c 6000 FFFE       238 		bra LOOP
                       239 
                       240 uart1_interrupt:
000590 48E7 8000       241 		movem.l %d0, -(%sp)
                       242 		*move.b #'a', %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       243 		*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
                       244 		*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ *
                       245 
                       246 
                       247 
                       248 
                       249 
000594 3639 00FF       250 		move.w UTX1, %d3	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            250 
00059a 0C43 8000       251 		cmp #0x8000,%d3
00059e 6400 0008       252 		bcc INTERPUT
                       253 
0005a2 4CDF 0001       254 		movem.l (%SP)+, %d0
0005a6 4E73            255 		rte
                       256 
                       257 
                       258 INTERPUT:
0005a8 48E7 FFFF       259 	movem.l %a0-%a7/%d0-%d7, -(%a7)
                       260 
0005ac 46FC 2700       261 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       262 	
0005b0 0C41 0000       263 	cmp #0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
                       264 
0005b4 6600 0016       265 	bne INTERPUT_END
                       266 
0005b8 4EB9 0000       267 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            267 
                       268 
0005be 0C5B 0000       269 	cmp #0, (%a3)+		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
0005c2 6700 000E       270 	beq INTERPUT_MASK
                       271 
0005c6 33DA 00FF       272 	move.w (%a2)+, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            272 
                       273 
                       274 INTERPUT_END:
0005cc 4CDF FFFF       275 	movem.l (%a7)+, %a0-%a7/%d0-%d7
0005d0 4E73            276 	rte
                       277 
                       278 INTERPUT_MASK:
0005d2 33FC 0000       279 	move.w #0x0000, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       279 
0005da 6000 FFF0       280 	bra INTERPUT_END
                       281 
                       282 
                       283 ******
                       284 ******‰ª•ÈôçQUEUE
                       285 ******
                       286 
                       287 .section .data
                       288 .equ IN_COUNT, 257
                       289 .equ OUT_COUNT, 257
                       290 .equ queue_number, 1
                       291 .equ OFFSET_1, 0x100
                       292 .equ END_0, 0xff
                       293 .equ END_1, 0x1ff
0005e0 0000 0000       294 top: .ds.b 0x200
       0000 0000       294 
       0000 0000       294 
       0000 0000       294 
       0000 0000       294 
0007e0 0000 0000       295 bottom: .ds.w 2
0007e4 0000 0000       296 in: .ds.l 1
0007e8 0000 0000       297 in_0: .ds.l 1
0007ec 0000 0000       298 in_1: .ds.l 1
0007f0 0000 0000       299 out: .ds.l 1
0007f4 0000 0000       300 out_0: .ds.l 1
0007f8 0000 0000       301 out_1: .ds.l 1
0007fc 0000 0000       302 s: .ds.l 1
000800 0000 0000       303 s0: .ds.l 1
000804 0000 0000       304 s1: .ds.l 1
000808 0000 0000       305 START_LABEL: .ds.l 1
                       306 
                       307 /* ÂàùÊúüÂåñ*/
                       308 Init_Q:
00080c 48E7 007E       309 movem.l %a1-%a6, -(%sp)
000810 45FA FDCE       310 lea.l top, %a2
000814 23CA 0000       311 move.l %a2, in_0
       0000            311 
00081a 23CA 0000       312 move.l %a2, out_0
       0000            312 
000820 47EA 0100       313 lea.l OFFSET_1(%a2), %a3
000824 23CB 0000       314 move.l %a3, in_1
       0000            314 
00082a 23CB 0000       315 move.l %a3, out_1
       0000            315 
000830 49FA FFCA       316 lea.l s, %a4
000834 4BFA FFCA       317 lea.l s0, %a5
000838 4DFA FFCA       318 lea.l s1, %a6
00083c 28BC 0000       319 move.l #0,(%a4)
       0000            319 
000842 2ABC 0000       320 move.l #0,(%a5)
       0000            320 
000848 2CBC 0000       321 move.l #0,(%a6)
       0000            321 
00084e 4CDF 7E00       322 movem.l (%sp)+, %a1-%a6
000852 4E75            323 rts
                       324 
                       325 *****************************************************************
                       326 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       327 **d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø
                       328 **d1:Ëøî„ÇäÂÄ§„ÄÅÊàêÂäüorÂ§±Êïó
                       329 *****************************************************************
                       330 INQ:
000854 4EBA 0008       331 jsr SELECT_QUEUE
000858 4EBA 007E       332 jsr PUT_BUF
00085c 4E75            333 rts
                       334 
                       335 SELECT_QUEUE:
00085e 0C00 0000       336 cmp.b #0, %d0
000862 6700 000C       337 beq SET_0
000866 0C00 0001       338 cmp.b #1, %d0
00086a 6700 0036       339 beq SET_1
00086e 4E75            340 rts
                       341 
                       342 SET_0:
000870 48E7 0010       343 movem.l %a3, -(%sp)
000874 23FA FF72       344 move.l in_0, in
       0000 0000       344 
00087c 23FA FF76       345 move.l out_0, out
       0000 0000       345 
                       346 
000884 23CA 0000       347 move.l %a2, START_LABEL
       0000            347 
00088a 47EA 00FF       348 lea.l END_0(%a2), %a3
00088e 23CB 0000       349 move.l %a3, bottom
       0000            349 
000894 23FA FF6A       350 move.l s0,s
       0000 0000       350 
00089c 4CDF 0800       351 movem.l (%sp)+, %a3
0008a0 4E75            352 rts
                       353 
                       354 SET_1:
0008a2 48E7 0010       355 movem.l %a3, -(%sp)
0008a6 23FA FF44       356 move.l in_1, in
       0000 0000       356 
0008ae 23FA FF48       357 move.l out_1, out
       0000 0000       357 
                       358 
0008b6 47EA 0100       359 lea.l OFFSET_1(%a2), %a3
0008ba 23CB 0000       360 move.l %a3, START_LABEL
       0000            360 
0008c0 47EA 01FF       361 lea.l END_1(%a2), %a3
0008c4 23CB 0000       362 move.l %a3, bottom
       0000            362 
0008ca 23FA FF34       363 move.l s0,s
       0000 0000       363 
0008d2 4CDF 0800       364 movem.l (%sp)+, %a3
0008d6 4E75            365 rts
                       366 
                       367 PUT_BUF:
0008d8 48E7 007E       368 movem.l %a1-%a6, -(%sp)
                       369 
0008dc 243A FF1E       370 move.l s,%d2
0008e0 0C82 0000       371 cmp.l #0x100,%d2
       0100            371 
0008e6 6700 0038       372 beq PUT_FAIL 
                       373 
0008ea 49FA FF10       374 lea.l s,%a4
0008ee 5294            375 addq.l #1,(%a4)
0008f0 143C 0001       376 move.b #1,%d2 /*ÊàêÂäü*/
0008f4 227A FEEE       377 movea.l in, %a1
0008f8 12C1            378 move.b %d1, (%a1)+  
                       379 
0008fa 267A FEE4       380 move.l bottom, %a3
0008fe B3CB            381 cmpa.l %a3, %a1
000900 6300 0008       382 bls PUT_BUF_STEP1
000904 247A FF02       383 move.l START_LABEL, %a2
000908 224A            384 movea.l %a2, %a1
                       385 
                       386 PUT_BUF_STEP1:
00090a 23C9 0000       387 move.l %a1, in
       0000            387 
000910 B3FA FEDE       388 cmpa.l out, %a1
000914 6600 0002       389 bne PUT_BUF_STEP2
                       390 
                       391 PUT_BUF_STEP2:
000918 4EBA 0010       392 jsr UPDATE
00091c 6000 0006       393 bra PUT_BUF_Finish
                       394 
                       395 PUT_FAIL:
000920 143C 0000       396 move.b #0,%d2 /*Â§±Êïó*/
                       397 
                       398 PUT_BUF_Finish:
000924 4CDF 7E00       399 movem.l (%sp)+, %a1-%a6
000928 4E75            400 rts
                       401 
                       402 UPDATE:
00092a 0C40 0000       403 cmp #0, %d0
00092e 6700 000C       404 beq QUEUE_0
000932 0C40 0001       405 cmp #1, %d0
000936 6700 001E       406 beq QUEUE_1
00093a 4E75            407 rts
                       408 
                       409 QUEUE_0:
00093c 23C9 0000       410 move.l %a1, in_0
       0000            410 
000942 23FA FEAC       411 move.l out, out_0
       0000 0000       411 
00094a 23FA FEB0       412 move.l s,s0
       0000 0000       412 
000952 1002            413 move.b %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
                       414 
000954 4E75            415 rts
                       416 QUEUE_1:
000956 23C9 0000       417 move.l %a1, in_1
       0000            417 
00095c 23FA FE92       418 move.l out, out_1
       0000 0000       418 
000964 23FA FE96       419 move.l s,s1
       0000 0000       419 
00096c 1002            420 move.b %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
00096e 4E75            421 rts
                       422 
                       423 ********************************************
                       424 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       425 **d1:Êàª„ÇäÂÄ§„ÄÅÂèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø
                       426 ********************************************
                       427 OUTQ:
000970 4EBA FEEC       428 jsr SELECT_QUEUE
000974 4EBA 0004       429 jsr GET_BUF
000978 4E75            430 rts
                       431 
                       432 GET_BUF:
00097a 48E7 007E       433 movem.l %a1-%a6, -(%sp)
                       434 
00097e 243A FE7C       435 move.l s,%d2
000982 0C82 0000       436 cmp.l #0x00,%d2
       0000            436 
000988 6700 0038       437 beq GET_FAIL
                       438 
00098c 143C 0001       439 move.b #1,%d2 /*ÊàêÂäü*/
000990 49FA FE6A       440 lea.l s,%a4
000994 5394            441 subq.l #1,(%a4)
000996 227A FE58       442 movea.l out, %a1
00099a 1219            443 move.b (%a1)+, %d1     
00099c 267A FE42       444 move.l bottom, %a3
0009a0 B3CB            445 cmpa.l %a3, %a1
0009a2 6300 0008       446 bls GET_BUF_STEP1
0009a6 247A FE60       447 move.l START_LABEL, %a2
0009aa 224A            448 movea.l %a2, %a1
                       449 
                       450 GET_BUF_STEP1:
0009ac 23C9 0000       451 move.l %a1, out
       0000            451 
0009b2 B3FA FE30       452 cmpa.l in, %a1
0009b6 6600 0002       453 bne GET_BUF_STEP2
                       454 
                       455 GET_BUF_STEP2:
0009ba 4EBA FF6E       456 jsr UPDATE
0009be 6000 0006       457 bra GET_BUF_Finish
                       458 
                       459 GET_FAIL:
0009c2 143C 0000       460 move.b #0,%d2 /*Â§±Êïó*/
                       461 GET_BUF_Finish:
0009c6 4CDF 7E00       462 movem.l (%sp)+, %a1-%a6
0009ca 4E75            463 rts
                       464 
                       465 		
