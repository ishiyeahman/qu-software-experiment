                         4 .list
                         5 /* ÂàùÊúüÂåñ*/
                         6 
                         7 		***************************************************************
                         8 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         9 		***************************************************************
                        10 
                        11 		***************
                        12 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        13 		***************
                        14 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        15 		.equ IOBASE,    0x00d00000
                        16 
                        17 		***************
                        18 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        19 		***************
                        20 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        21 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        22 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        23 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        24 
                        25 		***************
                        26 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        27 		***************
                        28 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        29 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        30 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        31 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        32 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        33 
                        34 		***************
                        35 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        36 		***************
                        37 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        38 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        39 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        40 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        41 
                        42 		***************
                        43 		** LED
                        44 		***************
                        45 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        46 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        47 		.equ LED5,      IOBASE+0x000002b
                        48 		.equ LED4,      IOBASE+0x0000029
                        49 		.equ LED3,      IOBASE+0x000003f
                        50 		.equ LED2,      IOBASE+0x000003d
                        51 		.equ LED1,      IOBASE+0x000003b
                        52 		.equ LED0,      IOBASE+0x0000039
                        53 
                        54 		***************************************************************
                        55 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        56 		***************************************************************
                        57 		.section .bss
                        58 		.even
                        59 SYS_STK:
000a80 0000 0000        60 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
                        61 		.even
                        62 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
004a80 0000 0000        63 		WORK: .ds.b 256 /*step6_test*/
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
                        64 		***************************************************************
                        65 		** ÂàùÊúüÂåñ
                        66 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        67 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        68 		***************************************************************
                        69 		.section .text
                        70 		.even
                        71 boot:
                        72 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        73 		move.w #0x2700,%SR
000404 4FF9 0000        74 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             74 
                        75 
                        76 		****************
                        77 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        78 		****************
00040a 13FC 0040        79 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        79 
000412 23FC 00FF        80 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        80 
       F304             80 
                        81 
                        82 		****************
                        83 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        84 		****************
00041c 33FC 0000        85 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        85 
000424 33FC E108        86 		move.w #0xe108, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        86 
00042c 33FC 0038        87 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        87 
                        88 
                        89 		****************
                        90 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        91 		****************
000434 33FC 0004        92 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        92 
                        93 
                        94 		***************************************************************
                        95 		** STEP2„ÅÆÂá¶ÁêÜ
                        96 		***************************************************************
                        97 		*lea.l uart1_interrupt, %a0
                        98 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 23FC 00FF        99 		move.l #0x00ff3ff9,IMR  |UART1Ë®±ÂèØ
       3FF9 00FF        99 
       F304             99 
                       100 
                       101 		/*trap #0„Å´ÁôªÈå≤*/
000446 21FC 0000       102 		move.l #CALL_SYSTEM, 0x080
       0000 0080       102 
                       103 
00044e 21FC 0000       104 		move.l #uart1_interrupt, 0x110
       0000 0110       104 
000456 21FC 0000       105 		move.l #timer1_interrupt, 0x118 /* „Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„ÅÆÁôªÈå≤ */
       0000 0118       105 
                       106 		
                       107 
                       108 		/* task_p „Å´„Çø„Ç§„Éû„ÉºÂâ≤„ÇäËæº„Åø„ÅßÂÆüË°å„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆ„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•„Çå„Å¶„Åä„Åè
                       109 		*lea.l TT,  %a0
                       110 		*move.l	%a0, task_p
                       111 		*move.l #TT, task_p
                       112 
                       113         /* Queue initialize */
00045e 4EB9 0000       114         jsr Init_Q
       0000            114 
                       115 
                       116 
                       117 		/*step9„ÅÆMAIN„Å∏*/
000464 6000 00C4       118 		bra MAIN		
                       119 
                       120 
                       121 
                       122 /*trap #0„Åß„ÅÆÂá¶ÁêÜ,SYSTEMCALL*/
                       123 CALL_SYSTEM:
                       124 	*move.w #0x2000, %SR /* „Åì„ÅÑ„Å§„ÅÆ„Åõ„ÅÑ„Åß„ÄÅ„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Ç®„É©„ÉºÁô∫Áîü */
                       125 
000468 0C40 0001       126 	cmpi #1, %d0
00046c 6600 000A       127 	bne CALL_PUT
                       128 
                       129 	*lea.l GETSTRING, %a0
                       130 	*move.l (%a0), %d0
                       131 	*jmp (%a0)
                       132 	
000470 4EBA 029E       133 	jsr GETSTRING	
                       134 	
000474 6000 0032       135 	bra CALL_END
                       136 
                       137 CALL_PUT:
000478 0C40 0002       138 	cmpi #2, %d0
00047c 6600 000A       139 	bne CALL_RESET
                       140 
                       141 	*lea.l PUTSTRING, %a0
                       142 	*move.l (%a0), %d0
                       143 	*jmp %a0
                       144 
000480 4EBA 023E       145 	jsr PUTSTRING
                       146 
000484 6000 0022       147 	bra CALL_END
                       148 
                       149 
                       150 CALL_RESET:
000488 0C40 0003       151 	cmpi #3, %d0
00048c 6600 000A       152 	bne CALL_SET
                       153 	
                       154 	*lea.l RESET_TIMER, %a0
                       155 	*move.l (%a0), %d0
                       156 	*jmp (%a0)
                       157 	
000490 4EBA 0018       158 	jsr RESET_TIMER
                       159 	
000494 6000 0012       160 	bra CALL_END
                       161 
                       162 CALL_SET:
000498 0C40 0004       163 	cmpi #4, %d0
00049c 6600 000A       164 	bne CALL_END
                       165 
                       166 	*lea.l SET_TIMER, %a0
                       167 	*move.l (%a0), %d0
                       168 	*jmp (%a0)
                       169 	
0004a0 4EBA 001A       170 	jsr SET_TIMER
                       171 	
0004a4 6000 0002       172 	bra CALL_END
                       173 
                       174 
                       175 CALL_END:
0004a8 4E73            176 	rte /* ‚òì rte -> rts */
                       177 
                       178 
                       179 
                       180 *****************************************************************************************
                       181 ** TIMER SETTING
                       182 *****************************************************************************************
                       183 
                       184 ************************************************************* 
                       185 **RESET_TIMER 
                       186 **Ê©üËÉΩ 
                       187 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã 
                       188 ************************************************************* 
                       189 
                       190 RESET_TIMER: 
0004aa 13FC 0035       191 	move.b  #'5', LED3      /*ÊñáÂ≠ó‚Äô5‚Äô„ÇíLED„ÅÆ4Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 003F       191 
0004b2 33FC 0004       192 	move.w #0x0004, TCTL1 /* 1.TCTL1„Çí„Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢„Å´Ë®≠ÂÆö */ 
       00FF F600       192 
0004ba 4E75            193 	rts
                       194 
                       195 
                       196   
                       197 ************************************************************* 
                       198 **SET_TIMER 
                       199 **Ê©üËÉΩ 
                       200 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âëº„Å≥
                       201 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÂë®Êúüt„ÇíË®≠ÂÆö„ÅóÔºåt*0.1msecÁßíÊØé„Å´Ââ≤„ÇäËæº„Åø„ÅåÁô∫Áîü„Åô„Çã„Çà„ÅÜ„Å
                       202 **	„Çø„Ç§„Éû‰ΩøÁî®„ÇíË®±ÂèØ„ÅóÔºå„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„ÇíË®±ÂèØ„Åô„ÇãÔºé(=„Çø„Ç§„Éû„Çí„Çπ„Çø„Éº„Éà„
                       203 **ÂÖ•Âäõ 
                       204 **	d1:„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü 
                       205 **	d2:Ââ≤„ÇäËæº„ÅøÊôÇ„Å´Ëµ∑Âãï„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       206 **Êàª„ÇäÂÄ§ 
                       207 **	„Å™„Åó 
                       208 *************************************************************
                       209   
                       210 
                       211 SET_TIMER:
0004bc 13FC 0031       212 	move.b  #'1', LED7      /*ÊñáÂ≠ó‚Äô1‚Äô„ÇíLED„ÅÆ8Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002F       212 
0004c4 23C2 0000       213 	move.l %d2, task_p /* 1.Ââ≤„ÇäËæº„Åø„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„ÇíÔºåtask_p„Å´‰ª£ÂÖ• „Å°„Çá„
       0000            213 
0004ca 33FC 00CE       214 	move.w #0x00ce, TPRER1 /* 2.TPRER1„Çí„ÄÅ0.1msecÈÄ≤„ÇÄ„Å®„Ç´„Ç¶„É≥„Çø„Åå1Â¢ó„Åà„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö *
       00FF F602       214 
0004d2 33C1 00FF       215 	move.w %d1, TCMP1 /* 3.„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü„ÇíÔºåTCMP1„Å´‰ª£ÂÖ• Ë¶Å‰øÆÊ≠£ */ 
       F604            215 
0004d8 33FC 0015       216 	move.w #0x0015, TCTL1 /* 4.TCTL1„ÇíÂâ≤„ÇäËæº„ÅøË®±ÂèØ„Å´Ë®≠ÂÆö */  
       00FF F600       216 
0004e0 4E75            217 	rts
                       218 
                       219 ************************************************************* 
                       220 **CALL_RP 
                       221 **Ê©üËÉΩ 
                       222 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âá¶ÁêÜ„Åô„Åπ„Åç„É´„Éº„ÉÅ„É≥„ÇíÂëº„Å≥Âá∫„Åô 
                       223 ************************************************************* 
                       224 
                       225 CALL_RP: 
0004e2 13FC 0032       226 	move.b  #'2', LED6      /*ÊñáÂ≠ó‚Äô2‚Äô„ÇíLED„ÅÆ7Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002D       226 
0004ea 2079 0000       227 	movea.l task_p, %a0
       0000            227 
0004f0 4E90            228 	jsr (%a0)
                       229 	*jsr task_p /* 1.task_p„ÅÆÊåá„Åô„Ç¢„Éâ„É¨„Çπ„Å∏„Ç∏„É£„É≥„Éó„Åô„Çã „Åì„ÅìËá™‰ø°„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„Å™„Ç
0004f2 4E75            230 	rts /* Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„Å´Êàª„Çã */ 
                       231 
                       232  
                       233 ************************************************************* 
                       234 **p 
                       235 **Ê©üËÉΩ 
                       236 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥ 
                       237 **Â§öÂàÜÂêÑËá™„Åß‰ΩúÊàê (Ë™≤È°å10) 
                       238 ************************************************************* 
                       239 *p: 
                       240 	*rts /* CALL_RP„Å´Êàª„Çã */ 
                       241  
                       242 
                       243 
                       244 
                       245 ***************************************************************************************************
                       246 **   CALL SETTING
                       247 ***************************************************************************************************
                       248 /*ÂêÑ„Ç∑„Çπ„ÉÜ„É†„ÅÆÂëº„Å≥Âá∫„Åó,t„ÉÜ„Çπ„Éà„Åß„ÅØMAIN„Å´„ÅÇ„Çã„Åü„ÇÅ‰ΩøÁî®„Åó„Å™„ÅÑ?*/
                       249 /*GETSTRINGÂëº„Å≥Âá∫„Åó*/
                       250 CALL_GETSTRING:
0004f4 7001            251 	move.l #1, %d0		/*GETSTRING*/
0004f6 7200            252 	move.l #0,%d1		/*ch=0*/
0004f8 243C 0000       253 	move.l #BUF, %d2	/*p=#BUF*/
       0000            253 
0004fe 263C 0000       254 	move.l #256, %d3	/*size=256*/
       0100            254 
000504 4E40            255 	trap #0
                       256 
                       257 /*PUTSTRINGÂëº„Å≥Âá∫„Åó*/
                       258 CALL_PUTSTRING:
000506 7002            259 	move.l #2, %d0		/*PUTSTRING*/
000508 7200            260 	move.l #0,%d1		/*ch=0*/
00050a 243C 0000       261 	move.l #BUF, %d2	/*p=#BUF*/
       0000            261 
000510 263C 0000       262 	move.l #256, %d3	/*size=256*/
       0100            262 
000516 4E40            263 	trap #0
                       264 
                       265 /*RESET_TIMERÂëº„Å≥Âá∫„Åó*/
                       266 CALL_RESET_TIMER:
000518 7003            267 	move.l #3, %d0		/*RESET_TIMER*/
00051a 4E40            268 	trap #0
                       269 
                       270 /*SET_TIMERÂëº„Å≥Âá∫„Åó*/
                       271 CALL_SET_TIMER:
00051c 7004            272 	move.l #4, %d0		/*SET_TIMER*/
00051e 323C C350       273 	move.w #50000, %d1		/*d1=„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü*/
000522 243C 0000       274 	move.l #TT, %d2		/*„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπd2=#TT*/
       0000            274 
000528 4E40            275 	trap #0
                       276 
                       277 
                       278 /*‰ª•‰∏ästep8*/
                       279 
                       280 
                       281 
                       282 
                       283 
                       284 ******************************************************
                       285 ***„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´Áï™Âè∑
                       286 ******************************************************
                       287 	.equ SYSCALL_NUM_GETSTRING,	1
                       288 	.equ SYSCALL_NUM_PUTSTRING,	2
                       289 	.equ SYSCALL_NUM_RESET_TIMER,	3
                       290 	.equ SYSCALL_NUM_SET_TIMER,	4
                       291 
                       292 
                       293 ******************************************************
                       294 ***„Éó„É≠„Ç∞„É©„É†È†òÂüü
                       295 ******************************************************
                       296 .section .text
                       297 .even
                       298 MAIN:						/*Ëµ∞Ë°å„É¢„Éº„Éâ„Å®„É¨„Éô„É´„ÅÆË®≠ÂÆö(„É¶„Éº„Ç∂„É¢„Éº„Éâ„Å∏ÁßªË°å)*/
                       299 
00052a 46FC 0000       300 	move.w #0x0000, %SR				/*USER_MODE_LEBEL„Çí0„Å´*/
00052e 4FF9 0000       301 	lea.l USR_STK_TOP, %SP				/*USER_STACK„ÇíË®≠ÂÆö*/
       0000            301 
                       302 
                       303 
                       304     
                       305 	*move.l #SYSCALL_NUM_RESET_TIMER, %d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßRESET_TIMER„ÅÆËµ∑Âãï*/
                       306 	*trap #0
                       307 
                       308 
                       309 	*move.l #SYSCALL_NUM_SET_TIMER,%d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßSET_TIMER„ÅÆËµ∑Âãï*/
                       310 	*move.w #50000, %d1
                       311 	*move.l #TT, %d2
                       312 	*trap #0
                       313 
                       314 	*bra LOOP
                       315 	
                       316 ** !! *********************************
                       317 ** Typing Game routine
                       318 ** !! *********************************
                       319 
                       320 TYPE_GAME_INTRO:
000534 7002            321    	move.l #SYSCALL_NUM_PUTSTRING, %d0
000536 7200            322 	move.l #0, %d1				/*ch=0*/
000538 243C 0000       323 	move.l #INTRO, %d2			/*p=#INTRO*/
       0000            323 
00053e 761C            324 	move.l #28, %d3				/*size=8*/
000540 4E40            325 	trap #0
                       326 
                       327 TYPE_GAME_PRINT_TXT:
000542 7002            328     	move.l #SYSCALL_NUM_PUTSTRING, %d0
000544 7200            329 	move.l #0, %d1				/*ch=0*/
000546 243C 0000       330 	move.l #TXT_hello, %d2			/*p=#INTRO*/
       0000            330 
00054c 263C 0000       331 	move.l #SIZE_hello, %d3				/*size=8*/
       000B            331 
000552 4E40            332 	trap #0
                       333 
                       334 TYPE_GAME_PRINT_NEW_LINE:
000554 7002            335     	move.l #SYSCALL_NUM_PUTSTRING, %d0
000556 7200            336 	move.l #0, %d1				/*ch=0*/
000558 243C 0000       337 	move.l #NEW_LINE, %d2			/*p=#INTRO*/
       0000            337 
00055e 7602            338 	move.l #2, %d3				/*size=8*/
000560 4E40            339 	trap #0
                       340 
                       341 TYPE_GAME_SETTING:
000562 23FC 0000       342 	move.l #0, (COUNT_SIZE)
       0000 0000       342 
       0000            342 
00056c 6000 0002       343     	bra LOOP
                       344 
                       345 
                       346 
                       347 
                       348 
                       349 ******************************************************
                       350 ***sys_GETSTRING,SYS_PUTSTRING„ÅÆ„ÉÜ„Çπ„Éà
                       351 ***„Çø„Éº„Éü„Éä„É´„ÅÆÂÖ•Âäõ„Çí„Ç®„Ç≥„Éº„Éê„ÉÉ„ÇØ
                       352 ******************************************************
                       353 
                       354 LOOP:
000570 7001            355 	move.l #SYSCALL_NUM_GETSTRING, %d0	/*GETSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
000572 7200            356 	move.l #0, %d1				/*ch=0*/
000574 243C 0000       357 	move.l #BUF, %d2			/*p=#BUF*/
       0000            357 
00057a 263C 0000       358 	move.l #256, %d3			/*size=256*/
       0100            358 
000580 4E40            359 	trap #0
                       360 
                       361 
000582 2600            362 	move.l %d0, %d3				/*size=d0*/
000584 7002            363 	move.l #SYSCALL_NUM_PUTSTRING, %d0	/*PUTSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
000586 7200            364 	move.l #0, %d1				/*ch=0*/
000588 243C 0000       365 	move.l #BUF, %d2			/*p=#BUF*/
       0000            365 
00058e 4E40            366 	trap #0
                       367 
000590 6000 FFDE       368 	bra LOOP
                       369 
                       370 ******************************************************
                       371 ***„Çø„Ç§„Éû„ÅÆ„ÉÜ„Çπ„Éà
                       372 ***'******'„ÇíË°®Á§∫„ÅóÊîπË°å
                       373 ***5ÂõûÂÆüË°å„Åó„Å¶RESET_TIMER
                       374 ******************************************************
                       375 
                       376 TT:
000594 13FC 0034       377 	move.b  #'4', LED4      /*ÊñáÂ≠ó‚Äô4‚Äô„ÇíLED„ÅÆ5Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 0029       377 
00059c 48E7 FFFE       378 	movem.l %d0-%d7/%a0-%a6,-(%SP)		/*„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
0005a0 0C79 0005       379 	cmpi.w #5, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Åß5ÂõûÂÆüË°å„Çí„Ç´„Ç¶„É≥„Éà*/
       0000 0000       379 
0005a8 6700 001C       380 	beq TTKILL				/*5ÂõûÂÆüË°å„Åó„Åü„Çâ„Çø„Ç§„Éû„ÇíÂÅúÊ≠¢*/
                       381 
0005ac 7002            382 	move.l #SYSCALL_NUM_PUTSTRING, %d0
0005ae 7200            383 	move.l #0, %d1				/*ch=0*/
0005b0 243C 0000       384 	move.l #TMSG, %d2			/*p=#TMSG*/
       0000            384 
0005b6 7608            385 	move.l #8, %d3				/*size=8*/
0005b8 4E40            386 	trap #0
                       387 
0005ba 0679 0001       388 	addi.w #1, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Çí1„Å§Â¢ó„ÇÑ„Åô*/
       0000 0000       388 
0005c2 6000 0006       389 	bra TTEND				/*„Åù„ÅÆ„Åæ„ÅæÊàª„Çã*/
                       390 
                       391 TTKILL:
0005c6 7003            392 	move.l #SYSCALL_NUM_RESET_TIMER, %d0	/*RESET_TIMER„ÅÆÂëº„Å≥Âá∫„Åó*/
0005c8 4E40            393 	trap #0
                       394 TTEND:
0005ca 4CDF 7FFF       395 	movem.l (%SP)+, %d0-%d7/%a0-%a6		/*„É¨„Ç∏„Çπ„ÇøÂæ©Â∏∞*/
0005ce 4E75            396 	rts
                       397 
                       398 
                       399 
                       400 
                       401 *****************************************************
                       402 **    Ââ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éï„Çß„Éº„Çπ
                       403 *****************************************************
                       404 uart1_interrupt:
0005d0 48E7 F000       405 	movem.l %d0-%d3, -(%sp)
                       406 
                       407 
0005d4 3639 00FF       408 	move.w URX1, %d3
       F904            408 
0005da 1403            409 	move.b %d3, %d2
0005dc 0C43 2000       410 	cmp.w #0x2000, %d3
0005e0 6400 0086       411 	bcc INTERGET
                       412 
                       413 
0005e4 3039 00FF       414 	move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            414 
0005ea 7200            415 	move.l #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
0005ec 0C40 8000       416 	cmp.w #0x8000,%d0
0005f0 6400 0034       417 	bcc INTERPUT
                       418 
                       419 		
                       420 		
                       421 
0005f4 4CDF 000F       422 	movem.l (%sp)+, %d0-%d3
0005f8 4E73            423 	rte
                       424 
                       425 
                       426 
                       427 
                       428 ************************************************************
                       429 ** „Çø„Ç§„Éû„ÉºÂâ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
                       430 ************************************************************
                       431 
                       432 timer1_interrupt:
0005fa 13FC 0033       433 	move.b  #'3', LED5      /*ÊñáÂ≠ó‚Äô3‚Äô„ÇíLED„ÅÆ6Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002B       433 
000602 48E7 0800       434 	movem.l %d4, -(%sp)
                       435 
                       436 /* ‰ª•‰∏ã‰øÆÊ≠£ÈÉ®ÂàÜ */
000606 3839 00FF       437 	move.w TSTAT1, %d4
       F60A            437 
00060c 0C44 0001       438 	cmpi.w #0x01, %d4 /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„ÅãÊØîËºÉ */
000610 6600 000E       439 	bne timer1_end /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„Å™„Çâ„ÄÅrte„ÅßÂæ©Â∏∞ */
000614 5344            440 	sub.w #0x01, %d4 /* 2.Á¨¨0„Éì„ÉÉ„Éà„Çí0„ÇØ„É™„Ç¢ */
000616 33C4 00FF       441 	move.w %d4, TSTAT1
       F60A            441 
00061c 4EBA FEC4       442 	jsr CALL_RP
                       443 /* ‰ª•‰∏ä‰øÆÊ≠£ÈÉ®ÂàÜ */
                       444 
                       445 timer1_end:
                       446 	*move.w %d3, %SR
000620 4CDF 0010       447 	movem.l (%sp)+, %d4
000624 4E73            448 	rte
                       449 
                       450 
                       451 
                       452 
                       453 **************************************************************
                       454 ** INTERPUT
                       455 ** ÂºïÊï∞
                       456 ** D1 : „ÉÅ„É£„Éç„É´„ÅÆÈÅ∏Êäû
                       457 ** Êàª„ÇäÂÄ§
                       458 **     „Å™„Åó
                       459 **************************************************************
                       460 
                       461 INTERPUT:
000626 48E7 E000       462 	movem.l %d0-%d2, -(%sp)
                       463 
00062a 46FC 2700       464 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       465 	
00062e 0C81 0000       466 	cmp.l #0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
       0000            466 
                       467 
000634 6600 001C       468 	bne INTERPUT_END
                       469 
000638 7001            470 	move.l #1, %d0
                       471 	*move.w #0x0800+'a', UTX1
00063a 4EB9 0000       472 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            472 
                       473 
000640 0C40 0000       474 	cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
000644 6700 0016       475 	beq INTERPUT_MASK
                       476 	*move.b %d1, %d2
000648 0641 0800       477 	addi.w #0x0800, %d1
                       478 	*move.w #0x0800+'f', UTX1
00064c 33C1 00FF       479 	move.w %d1, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            479 
                       480 
                       481 INTERPUT_END:
                       482 	*move.w #0x0800+'c', UTX1
000652 4CDF 0007       483 	movem.l (%sp)+, %d0-%d2
000656 4CDF 000F       484 	movem.l (%sp)+, %d0-%d3
00065a 4E73            485 	rte
                       486 
                       487 INTERPUT_MASK:
                       488 	*move.w #0x0800+'b', UTX1
00065c 33FC E108       489 	move.w #0xe108, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       489 
000664 6000 FFEC       490 	bra INTERPUT_END
                       491 
                       492 
                       493 *******************************
                       494 **INTERGET
                       495 **d1:„ÉÅ„É£„Éç„É´
                       496 **d2:Âèó‰ø°„Éá„Éº„Çø
                       497 *******************************
                       498 INTERGET:
                       499 	
000668 48E7 FFFE       500 	movem.l %a0-%a6/%d0-%d7, -(%SP)
                       501 
00066c 0C81 0000       502 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            502 
                       503 	
000672 6600 0042       504 	bne INTERGET_END
                       505 
000676 7000            506 	move.l #0, %d0		/*„Ç≠„É•„ÉºÁï™Âè∑„ÇíË®≠ÂÆö*/
                       507 
000678 1202            508 	move.b %d2,%d1		/*„Ç≠„É•„Éº„Å´ÂÖ•„Çå„Çã„Éá„Éº„Çø„Çíd1„Å´Ê†ºÁ¥ç*/
                       509 
                       510 	
                       511 /* TYPE GAME VERSION ========================================== */    
                       512 TYPE_GAME_CHAR_CHECK:
                       513     	
                       514 	
00067a 43F9 0000       515 	lea.l COUNT_SIZE, %a1
       0000            515 
000680 2A11            516 	move.l (%a1), %d5
                       517  	
                       518 
                       519 
                       520     	/* ÂÖ•Âäõ„ÅåÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç*/
000682 0C85 0000       521 	cmp.l   #SIZE_hello, %d5
       000B            521 
000688 6700 002C       522   	beq INTERGET_END
                       523 	
                       524 
                       525     	/* ÂèÇÁÖß„Åô„Åπ„ÅçÊñáÂ≠óÂàó„ÇíÁî®ÊÑè„Åô„Çã*/
                       526 
00068c 43F9 0000       527    	lea.l TXT_hello, %a1
       0000            527 
                       528 	
000692 D3C5            529 	adda.l %d5, %a1
                       530 		
000694 1C11            531 	move.b (%a1), %d6
000696 13FC 0039       532 	move.b #'9', LED0 
       00D0 0039       532 
                       533     	  
                       534 	/* ‰∏ÄËá¥„Åó„Å™„Åë„Çå„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
00069e B206            535    	cmp.b  %d6, %d1
0006a0 6600 0014       536    	bne INTERGET_END
                       537 	
                       538     	/* ÊñáÂ≠ó„ÇíÂá∫Âäõ„Åó„Ç´„Ç¶„É≥„Éà„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà„Åô„Çã */
                       539 	
0006a4 4EB9 0000       540    	jsr INQ
       0000            540 
0006aa 0685 0000       541    	addi.l #1, %d5
       0001            541 
0006b0 23C5 0000       542    	move.l %d5, (COUNT_SIZE)
       0000            542 
                       543     
                       544 /* TYPE GAME VERSION ========================================== */   
                       545 
                       546 INTERGET_END:
0006b6 4CDF 7FFF       547 	movem.l (%SP)+, %a0-%a6/%d0-%d7
0006ba 4CDF 000F       548 	movem.l (%sp)+, %d0-%d3
                       549 	
0006be 4E73            550 	rte
                       551 
                       552 
                       553 
                       554 *************************************************************
                       555 **PUTSTRING
                       556 **ÂÖ•Âäõ
                       557 **d1:„ÉÅ„É£„Éç„É´
                       558 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       559 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       560 **Êàª„ÇäÂÄ§
                       561 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       562 *************************************************************
                       563 PUTSTRING:
0006c0 48E7 7FFE       564 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       565 
0006c4 0C81 0000       566 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            566 
                       567 	
0006ca 6600 003C       568 	bne PUTSTRING_END
                       569 	
0006ce 7800            570 	move.l #0,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       571 
0006d0 2242            572 	move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ*/
                       573 
0006d2 0C83 0000       574 	cmp.l #0,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            574 
                       575 
0006d8 6700 002E       576 	beq PUTSTRING_END
                       577 
                       578 LOOP_STEP5:
0006dc B684            579 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       580 
0006de 6700 001C       581 	beq PUTSTRING_MASK
                       582 
0006e2 7001            583 	move.l #1,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       584 
0006e4 1219            585 	move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       586 
0006e6 4EB9 0000       587 	jsr INQ
       0000            587 
                       588 
0006ec 0C80 0000       589 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            589 
                       590 
0006f2 6700 0008       591 	beq PUTSTRING_MASK
                       592 
                       593 
0006f6 5244            594 	addq #1,%d4		/*sz++*/
                       595 
0006f8 6000 FFE2       596 	bra LOOP_STEP5
                       597 
                       598 PUTSTRING_MASK:
0006fc 33FC E10C       599 	move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       599 
                       600 
000704 6000 0002       601 	bra PUTSTRING_END
                       602 
                       603 PUTSTRING_END:
000708 2004            604 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       605 	
00070a 4CDF 7FFE       606 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       607 
00070e 4E75            608 	rts 			/*?*/
                       609 
                       610 
                       611 *************************************************************
                       612 **GETSTRING
                       613 **ÂÖ•Âäõ
                       614 **d1:„ÉÅ„É£„Éç„É´
                       615 **d2:„Éá„Éº„ÇøÊõ∏„ÅçËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       616 **d3:Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆÊï∞
                       617 **Êàª„ÇäÂÄ§
                       618 **d0:ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„ÅÆÊï∞
                       619 *************************************************************
                       620 GETSTRING:
                       621 	*move.w #0x0800+'c', UTX1
000710 48E7 7FFE       622 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       623 
000714 0C81 0000       624 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            624 
                       625 	
00071a 6600 0026       626 	bne GETSTRING_END
                       627 
00071e 7800            628 	move.l #0,%d4 		/*%d4=sz:Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       629 
000720 2242            630 	move.l %d2,%a1 		/*%a1:„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Ç¢„Éâ„É¨„Çπ*/
                       631 
                       632 LOOP_STEP6:
000722 B684            633 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       634 
000724 6700 001C       635 	beq GETSTRING_END
                       636 	
000728 7000            637 	move.l #0,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       638 	
00072a 4EB9 0000       639 	jsr OUTQ
       0000            639 
                       640 	
000730 0C80 0000       641 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            641 
                       642 
000736 6700 000A       643 	beq GETSTRING_END
                       644 
00073a 12C1            645 	move.b %d1,(%a1)+	/*Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„Çí„Ç≥„Éî„Éº*/
                       646 
00073c 5244            647 	addq #1,%d4		/*sz++*/
                       648 
00073e 6000 FFE2       649 	bra LOOP_STEP6
                       650 
                       651 GETSTRING_END:
000742 2004            652 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       653 
000744 4CDF 7FFE       654 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       655 
000748 4E75            656 	rts
                       657 
                       658 
                       659 
                       660 
                       661 ***************************************************************************************************
                       662 ***      QUEUE SETTING
                       663 ***************************************************************************************************
                       664 
                       665 .section .data
                       666 .equ TOP, 0
                       667 .equ BOTTOM, 4
                       668 .equ IN, 8
                       669 .equ OUT, 12
                       670 .equ S, 16
                       671 .equ DATA_TOP, 18
                       672 .equ DATA_LEN, 256
                       673 .equ QUEUE_SIZE, DATA_TOP + DATA_LEN /* 18 + 256 = 274 */
                       674 
00074c 0000 0000       675 QUEUE_TOP: ds.b QUEUE_SIZE * 2
       0000 0000       675 
       0000 0000       675 
       0000 0000       675 
       0000 0000       675 
                       676 
                       677 /* ÂàùÊúüÂåñ */
                       678 ********************
                       679 * ÂàùÊúüÂåñ
                       680 ********************
                       681 
                       682 Init_Q:
000970 48E7 C0E0       683     movem.l %d0-%d1/%a0-%a2, -(%sp) /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÈÄÄÈÅø */
                       684 
000974 7000            685     move.l #0, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑ = 0 */
                       686 
                       687 Init_Q_sub:
000976 41FA FDD4       688     lea.l QUEUE_TOP, %a0 /* „Ç≠„É•„Éº„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
00097a 2200            689     move.l %d0, %d1
00097c C2F8 0112       690     mulu.w QUEUE_SIZE, %d1 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000980 D1C1            691     add.l %d1, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000982 43E8 0012       692     lea.l DATA_TOP(%a0), %a1 /* a1 = „Ç≠„É•„Éºn„ÅÆ„Éá„Éº„ÇøÈ†òÂüüÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = DATA_TOP + a0
000986 2089            693     move.l %a1, TOP(%a0) /* „Ç≠„É•„Éºn„ÅÆTOP„ÅÆ„Ç¢„Éâ„É¨„Çπ = a0 + TOP „Åß„ÅÇ„Çã„ÅÆ„Åß„Åù„Åì„Å´a1„Ç
000988 2149 0008       694     move.l %a1, IN(%a0) /* „Ç≠„É•„Éºn„ÅÆIN„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
00098c 2149 000C       695     move.l %a1, OUT(%a0) /* „Ç≠„É•„Éºn„ÅÆOUT„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000990 43E8 0111       696     lea.l QUEUE_SIZE-1(%a0), %a1 /* a1 == BOTTOM = „Ç≠„É•„Éºn„ÅÆÁµÇÁ´Ø„Ç¢„Éâ„É¨„Çπ */
000994 2149 0004       697     move.l %a1,BOTTOM(%a0)/*„Ç≠„É•„Éºn„ÅÆBOTTOM„Å´a1„ÇíÊ†ºÁ¥ç*/
000998 317C 0000       698     move.w #0, S(%a0) /* „Éá„Éº„ÇøÊï∞ = 0 */
       0010            698 
00099e 5280            699     addq.l #1, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑++ */
0009a0 0C80 0000       700     cmpi.l #2, %d0 /* „Ç≠„É•„Éº„ÅÆÂÄãÊï∞ÂàÜ(2)„É´„Éº„Éó */
       0002            700 
0009a6 6600 FFCE       701     bne Init_Q_sub
                       702 
0009aa 4CDF 0703       703     movem.l (%sp)+, %d0-%d1/%a0-%a2 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
0009ae 4E75            704     rts
                       705 
                       706 
                       707 *****************
                       708 ** INQ
                       709 *****************
                       710 
                       711 **************************************
                       712 **ÂÖ•Âäõ
                       713 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû [long]
                       714 **  d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø [long]
                       715 **Âá∫Âäõ
                       716 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       717 **************************************
                       718 INQ:
                       719 
                       720     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
0009b0 40E7            721     move.w %SR, -(%sp)
                       722 
                       723     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
0009b2 46FC 2700       724     move.w #0x2700, %SR
                       725 
0009b6 48E7 00C0       726     movem.l %a0-%a1, -(%sp)
0009ba 41FA FD90       727     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
0009be C0F8 0112       728     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
0009c2 D1C0            729     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       730 
0009c4 0C68 0100       731     cmpi.w #256, S(%a0)
       0010            731 
0009ca 6600 0008       732     bne INQ_1
                       733 
                       734     /* S == 256„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
0009ce 7000            735     move.l #0, %d0
0009d0 6000 0024       736     bra INQ_END
                       737 
                       738 INQ_1:
0009d4 2268 0008       739     movea.l IN(%a0), %a1 /* a1 = in */
0009d8 1281            740     move.b %d1, (%a1) /* q[in] = d1 */ 
                       741 
0009da B3E8 0004       742     cmpa.l BOTTOM(%a0), %a1 /* in == bottom „Åã„ÇíÂà§ÂÆö */
0009de 6600 000A       743     bne INQ_ELSE
                       744 
                       745     /* in == bottom „ÅÆ„Å®„Åç*/
0009e2 2150 0008       746     move.l TOP(%a0), IN(%a0) /* in = top */
0009e6 6000 0008       747     bra INQ_2
                       748 
                       749 /* in != bottom „ÅÆ„Å®„Åç*/
                       750 INQ_ELSE:
0009ea 5289            751     addq.l #1, %a1 /* a1++ */
0009ec 2149 0008       752     move.l %a1, IN(%a0) /* in = a1 */
                       753 
                       754 /* s++, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       755 INQ_2:
0009f0 5268 0010       756     addq.w #1, S(%a0)
0009f4 7001            757     move.l #1, %d0
                       758 
                       759 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       760 INQ_END:
0009f6 4CDF 0300       761     movem.l (%sp)+, %a0-%a1 
0009fa 46DF            762     move.w (%sp)+, %SR
0009fc 4E75            763     rts
                       764 
                       765 
                       766 *****************
                       767 * OUTQ
                       768 *****************
                       769 
                       770 **********************************************
                       771 **ÂÖ•Âäõ
                       772 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû  [long]
                       773 
                       774 **Âá∫Âäõ
                       775 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       776 **  d1:Âèñ„ÇäÁµÑ„Çì„Å†„Éá„Éº„Çø [byte]
                       777 **********************************************
                       778 OUTQ:
                       779     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
0009fe 40E7            780     move.w %SR, -(%sp)
                       781 
                       782     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000a00 46FC 2700       783     move.w #0x2700, %SR
                       784 
000a04 48E7 00C0       785     movem.l %a0-%a1, -(%sp)
000a08 41FA FD42       786     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000a0c C0F8 0112       787     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000a10 D1C0            788     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       789 
000a12 0C68 0000       790     cmpi.w #0, S(%a0)
       0010            790 
000a18 6600 0008       791     bne OUTQ_1
                       792 
                       793     /* S == 0„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000a1c 7000            794     move.l #0, %d0
000a1e 6000 0024       795     bra OUTQ_END
                       796 
                       797 OUTQ_1:
000a22 2268 000C       798     movea.l OUT(%a0), %a1 /* a1 = out */
000a26 1211            799     move.b (%a1), %d1 /* d1 = q[out] */
                       800 
000a28 B3E8 0004       801     cmpa.l BOTTOM(%a0), %a1 /* out == bottom „Åã„ÇíÂà§ÂÆö */
000a2c 6600 000A       802     bne OUTQ_ELSE
                       803 
                       804     /* out == bottom „ÅÆ„Å®„Åç*/
000a30 2150 000C       805     move.l TOP(%a0), OUT(%a0) /* out = top */
000a34 6000 0008       806     bra OUTQ_2
                       807 
                       808 /* out != bottom „ÅÆ„Å®„Åç*/
                       809 OUTQ_ELSE:
000a38 5289            810     addq.l #1, %a1 /* a1++ */
000a3a 2149 000C       811     move.l %a1, OUT(%a0) /* out = a1 */
                       812 
                       813 /* s--, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       814 OUTQ_2:
000a3e 5368 0010       815     subq.w #1, S(%a0)
000a42 7001            816     move.l #1, %d0
                       817 
                       818 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       819 OUTQ_END:
000a44 4CDF 0300       820     movem.l (%sp)+, %a0-%a1 
000a48 46DF            821     move.w (%sp)+, %SR
000a4a 4E75            822     rts
                       823 
                       824 
                       825 ***** 
                       826 
                       827 
                       828 
                       829 ******************************************************
                       830 *** ÂàùÊúüÂåñ„ÅÆ„ÅÇ„Çã„Éá„Éº„ÇøÈ†òÂüü
                       831 ******************************************************
                       832 
                       833 .section .data
                       834 TMSG:
000a4c 2A2A 2A2A       835 	.ascii	"******\r\n"			/*r:Ë°åÈ†≠„Å∏,n:ÊîπË°å*/
       2A2A 0D0A       835 
                       836 .even
                       837 TTC:
000a54 0000            838 	.dc.w 0
                       839 	.even
                       840 
                       841 ********************************
                       842 ** preparation to typing game
                       843 ********************************
                       844 NEW_LINE:
                       845     /* size : 2 */
000a56 0D0A            846     .ascii "\r\n"
                       847 INTRO:
                       848     /* size : 28*/
000a58 506C 6561       849     .ascii "Please type this sentence!\r\n"
       7365 2074       849 
       7970 6520       849 
       7468 6973       849 
       2073 656E       849 
                       850 TXT_hello:
                       851     /* size : 11*/
000a74 6865 6C6C       852     .ascii "hello world"
       6F20 776F       852 
       726C 64         852 
                       853 
                       854 .equ SIZE_hello, 11
                       855 
                       856 
                       857 
                       858 ******************************************************
                       859 *** ÂàùÊúüÂåñ„ÅÆ„Å™„ÅÑ„Éá„Éº„ÇøÈ†òÂüü
                       860 ******************************************************
                       861 .section .bss
                       862 
                       863 COUNT_SIZE:
004b80 0000 0000       864     .ds.l 0x01
                       865 TXT_P:
004b84 0000 0000       866 	.ds.l 0x01
                       867 TXT_SIZE:
004b88 0000 0000       868 	.ds.l 0x01
                       869 
                       870 task_p:
004b8c 0000 0000       871 	.ds.l	0x01
                       872 	.even
                       873 
                       874 BUF:
004b90 0000 0000       875 	.ds.b 256				/*BUF[256]*/
       0000 0000       875 
       0000 0000       875 
       0000 0000       875 
       0000 0000       875 
                       876 	.even
                       877 
                       878 
                       879 
                       880 USR_STK:
004c90 0000 0000       881 	.ds.b 0x4000				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü*/
       0000 0000       881 
       0000 0000       881 
       0000 0000       881 
       0000 0000       881 
                       882 	.even
                       883 
                       884 USR_STK_TOP:				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ*/
                       885 
                       886 
                       887 
