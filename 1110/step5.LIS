                         4 .list
                         5 
                         6 		***************************************************************
                         7 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         8 		***************************************************************
                         9 
                        10 		***************
                        11 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        12 		***************
                        13 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        14 		.equ IOBASE,    0x00d00000
                        15 
                        16 		***************
                        17 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        18 		***************
                        19 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        20 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        21 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        22 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        23 
                        24 		***************
                        25 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        26 		***************
                        27 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        28 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        29 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        30 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        31 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        32 
                        33 		***************
                        34 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        35 		***************
                        36 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        37 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        38 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        39 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        40 
                        41 		***************
                        42 		** LED
                        43 		***************
                        44 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        45 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        46 		.equ LED5,      IOBASE+0x000002b
                        47 		.equ LED4,      IOBASE+0x0000029
                        48 		.equ LED3,      IOBASE+0x000003f
                        49 		.equ LED2,      IOBASE+0x000003d
                        50 		.equ LED1,      IOBASE+0x000003b
                        51 		.equ LED0,      IOBASE+0x0000039
                        52 
                        53 		***************************************************************
                        54 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        55 		***************************************************************
                        56 		.section .bss
                        57 		.even
                        58 SYS_STK:
0009f0 0000 0000        59 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        59 
       0000 0000        59 
       0000 0000        59 
       0000 0000        59 
                        60 		.even
                        61 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        62 
                        63 		***************************************************************
                        64 		** ÂàùÊúüÂåñ
                        65 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        66 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        67 		***************************************************************
                        68 
                        69 
                        70 .section .data
                        71 .even
000580 3031 3233        72 	TDATA1: .ascii "0123456789ABCDEF"
       3435 3637        72 
       3839 4142        72 
       4344 4546        72 
000590 6B6C 6D6E        73 	TDATA2: .ascii "klmnopqrstuvwxyz"
       6F70 7172        73 
       7374 7576        73 
       7778 797A        73 
                        74 .even
                        75 
                        76 		
                        77 
                        78 .section .text
                        79 		.even
                        80 boot:
                        81 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        82 		move.w #0x2700,%SR
000404 4FF9 0000        83 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             83 
                        84 
                        85 		****************
                        86 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        87 		****************
00040a 13FC 0040        88 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        88 
000412 23FC 00FF        89 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        89 
       F304             89 
                        90 
                        91 		****************
                        92 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        93 		****************
00041c 33FC 0000        94 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        94 
000424 33FC E100        95 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        95 
00042c 33FC 0038        96 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        96 
                        97 
                        98 		****************
                        99 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                       100 		*****************
000434 33FC 0004       101 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600       101 
                       102 
                       103 		***************************************************************
                       104 		** STEP2„ÅÆÂá¶ÁêÜ
                       105 		***************************************************************
                       106 		/* ÂàùÊúüÂåñÂá¶ÁêÜ„Çí„É°„Ç§„É≥„É´„Éº„ÉÅ„É≥„Åã„Çâ„Åì„Å°„Çâ„Å∏ÁßªÂãï */
                       107 		*lea.l uart1_interrupt, %a0
                       108 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 21FC 0000       109 		move.l #uart1_interrupt, 0x110
       0000 0110       109 
000444 33FC E100       110 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ
       00FF F900       110 
00044c 23FC 00FF       111 		move.l #0x00ff3ffb,IMR  |UART1Ë®±ÂèØ
       3FFB 00FF       111 
       F304            111 
000456 46FC 2700       112 		move.w #0x2700, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´7 */
                       113 		
                       114 
00045a 6000 0002       115 		bra MAIN
                       116 
                       117 		***************************************************************
                       118 		** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                       119 		** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       120 		***************************************************************
                       121 		.section .text
                       122 		.even
                       123 
                       124 
                       125 ******************************
                       126 ** PUTSTRING Âãï‰Ωú„ÉÜ„Çπ„Éà
                       127 ******************************
                       128 	
                       129 MAIN:
00045e 4EB9 0000       130 		jsr Init_Q
       0000            130 
000464 13FC 0031       131 		move.b #'1', LED7
       00D0 002F       131 
00046c 33FC E108       132 		move.w #0xe108,USTCNT1
       00FF F900       132 
000474 46FC 2000       133 		move.w #0x2000, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´0 */
                       134 
                       135 
                       136 PS_TEST1:
                       137         /* TDATA1 ÈÄÅ‰ø°Áî® */
                       138 		/* jsr PUTSTRING(0, #TDATA1, 16)*/
000478 7200            139 		move.l	#0x00, %d1
00047a 243C 0000       140 		move.l	#TDATA1, %d2
       0000            140 
                       141 		
                       142         * move.l	#0x0f, %d3
000480 7610            143         move.l	#0x010, %d3
                       144 		
000482 4EBA 00A2       145         jsr PUTSTRING
                       146 		
                       147 	
000486 13FC 0032       148 		move.b #'2', LED6
       00D0 002D       148 
00048e 283C 0000       149 		move.l	#0x000fff, %d4
       0FFF            149 
                       150 	
                       151 		
                       152 LOOP:
                       153         /* ÂæÖ„Å°ÊôÇÈñì„É´„Éº„Éó */
000494 5384            154 		subq.l #1,%d4
000496 6700 000E       155 		beq PS_TEST2
00049a 13FC 0035       156 		move.b #'5', LED3
       00D0 003F       156 
                       157 		
0004a2 6000 FFF0       158 		bra LOOP
                       159 
                       160 PS_TEST2:
                       161         /* TDATA2 ÈÄÅ‰ø°Áî® */
                       162 
                       163         /* jsr PUTSTRING(0, #TDATA2, 16)*/
0004a6 13FC 0036       164 		move.b #'6', LED2
       00D0 003D       164 
0004ae 7200            165 		move.l	#0x00, %d1
0004b0 243C 0000       166 		move.l	#TDATA2, %d2
       0000            166 
                       167 
                       168 		*move.l	#0x0f, %d3
0004b6 7610            169         move.l	#0x10, %d3
                       170 
0004b8 4EBA 006C       171 		jsr PUTSTRING
0004bc 6000 FFE8       172 		bra PS_TEST2
                       173 
                       174 
                       175 *****************************
                       176 ** UART1  Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ
                       177 *****************************
                       178 
                       179 uart1_interrupt:
0004c0 13FC 0033       180 		move.b #'3', LED5
       00D0 002B       180 
0004c8 48E7 8000       181 		movem.l %d0, -(%sp)
                       182 
                       183 		*move.b #'a', %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       184 		*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
                       185 		*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ */
                       186 
                       187 
0004cc 3039 00FF       188 		move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            188 
                       189 		
0004d2 123C 0000       190 		move.b #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
                       191 
0004d6 0C40 8000       192 		cmp #0x8000,%d0
0004da 6400 0008       193 		bcc INTERPUT
                       194 
0004de 4CDF 0001       195 		movem.l (%sp)+, %d0
                       196 		
0004e2 4E73            197 		rte
                       198 
                       199 **********************************************
                       200 ** INTERPUT  („Éá„Éº„Çø„Çµ„Ç§„Ç∫„ÇíÂèØËÉΩ„Å™„Åã„Åé„Çälong„Å´„Åó„Åü)
                       201 **********************************************
                       202 
                       203 INTERPUT:
0004e4 48E7 E000       204 		movem.l %d0-%d2, -(%sp)
                       205 
                       206         /*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
0004e8 46FC 2700       207 		move.w #0x2700, %SR	
                       208 
                       209         /*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
0004ec 0C81 0000       210 		cmp.l #0x0, %d1		
       0000            210 
0004f2 6600 0020       211 		bne INTERPUT_END
                       212 
                       213         /* QUEUE„ÅÆÈÅ∏Êäû */
0004f6 7001            214 		move.l #1, %d0
                       215 
                       216         /*step4.3:OUTQ„ÅÆÂÆüË°å*/
0004f8 4EB9 0000       217 		jsr OUTQ		
       0000            217 
                       218 
                       219         /*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
0004fe 0C80 0000       220 		cmp.l #0, %d0		
       0000            220 
000504 6700 0014       221 		beq INTERPUT_MASK
                       222 
                       223         /*=========„Éá„Éº„Çø„ÅÆÈÄÅ‰ø°=======*/ 
                       224         /* ÊñáÂ≠óÂåñ„Åë„Åó„Åü„Çâ„Åì„Åì„Å´Ê≥®ÊÑè */
000508 1401            225 		move.b %d1, %d2
                       226         /*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
00050a 0642 0800       227 		addi.w #0x0800, %d2
00050e 33C2 00FF       228 		move.w %d2, UTX1	
       F906            228 
                       229         /*=========================*/
                       230 
                       231 
                       232 INTERPUT_END:
000514 4CDF 0007       233 		movem.l (%sp)+, %d0-%d2
                       234 		*movem.l (%sp)+, %d0
                       235 
000518 4E73            236 		rte
                       237 
                       238 INTERPUT_MASK:
00051a 33FC E100       239 		move.w #0xe100, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       239 
                       240 		/* ‚Üë ‰ΩïÊïÖ„Åã„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„Åï„Çå„Å¶„ÅÑ„Åü„ÅÆ„Åß„ÄÅ‰øÆÊ≠£ */
                       241 
000522 6000 FFF0       242 		bra INTERPUT_END
                       243 
                       244 
                       245 *************************************************************
                       246 **                 PUTSTRING („Éá„Éº„Çø„Çµ„Ç§„Ç∫„ÇíÂèØËÉΩ„Å™„Åã„Åé„Çälong„Å´„Åó„Åü) 
                       247 *************************************************************
                       248 
                       249 **ÂÖ•Âäõ
                       250 **  d1:„ÉÅ„É£„Éç„É´ [long]
                       251 **  d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ [long]
                       252 **  d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size [long]
                       253 
                       254 **Êàª„ÇäÂÄ§
                       255 **  d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞ [long]
                       256 
                       257 *************************************************************
                       258 
                       259 
                       260 PUTSTRING:
000526 48E7 7FFE       261 		movem.l %a0-%a6/%d1-%d7, -(%SP)
                       262 
00052a 0C81 0000       263 		cmp.l #0x00, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            263 
000530 6600 003C       264 		bne PUTSTRING_END
                       265 		/* rv: „Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅÆÊØîËºÉ„ÄÇÔºê„Åß„ÅØ„Å™„ÅÑ„Å®„Åç„Å´ÁµÇ‰∫Ü„Åô„Çã*/
                       266 
000534 7800            267 		move.l #0x0000,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       268 		/* rv: „Éá„Éº„ÇøÊï∞(sz)„ÅÆÂàùÊúüÂåñ*/
                       269 
000536 2242            270 		move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ/
                       271 		/* rv: Ë™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Çía1„Å´Ê†ºÁ¥ç„Åô„Çã*/	
                       272 
000538 0C83 0000       273 		cmp.l #0x0000,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            273 
00053e 6700 002E       274 		beq PUTSTRING_END
                       275 		/* rv: d3(size)„Åå0„Å™„Çâ„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
                       276 
                       277 
                       278 LOOP_STEP5:
                       279         /*sz=size„ÅßÂàÜÂ≤ê*/
000542 B684            280 		cmp.l %d4,%d3		
000544 6700 001C       281 		beq PUTSTRING_MASK
                       282 		/* d3 „Å® d4 size = sz „Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï*/
                       283 
                       284         /*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
000548 7001            285 		move.l #0x01,%d0 		
                       286 		*move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/ *!?
                       287         
                       288         /*ÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
00054a 2219            289         move.l (%a1)+,%d1	
                       290 		/* rv: ÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Åã„ÇâÈ†Ü„Å´Ê†ºÁ¥ç„Åô„Çã*/
                       291 
00054c 4EB9 0000       292 		jsr INQ
       0000            292 
                       293 
                       294         /*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
000552 0C80 0000       295 		cmp.l #0x00,%d0		
       0000            295 
000558 6700 0008       296 		beq PUTSTRING_MASK
                       297 		/*rv : Â§±Êïó„Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï„Åô„Çã*/
                       298 
00055c 5284            299 		addq.l #0x01,%d4		/*sz++*/
00055e 6000 FFE2       300 		bra LOOP_STEP5
                       301 
                       302 PUTSTRING_MASK:
                       303 
000562 33FC E10C       304 		move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       304 
00056a 6000 0002       305 		bra PUTSTRING_END
                       306 
                       307 PUTSTRING_END:
00056e 3004            308 		move.w %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
000570 4CDF 7FFE       309 		movem.l (%SP)+, %a0-%a6/%d1-%d7
                       310 
                       311 		*rte 			/*?*/
                       312 		/* bus errorÂá∫„Åü„ÅÆ„ÅßÂ§âÊõ¥„Åó„Åü*/
                       313 
                       314 		***
000574 13FC 0034       315 		move.b #'4', LED4
       00D0 0029       315 
                       316 		***
00057c 4E75            317 		rts
                       318 
                       319 
                       320 
                       321 
                       322 .section .data
                       323 ******************************
                       324 ** „Ç≠„É•„ÉºÁî®„ÅÆ„É°„É¢„É™È†òÂüüÁ¢∫‰øù ‚Üì‚Üì
                       325 ******************************
                       326 .equ B_SIZE, 256
                       327 .equ ALL_B_SIZE, B_SIZE + B_SIZE |Âèó‰ø°„Å®ÈÄÅ‰ø°„ÅßÔºëÊú¨„Åö„Å§|
                       328 
0005a0 0000 0000       329 top: .ds.b ALL_B_SIZE-1 |„Ç≠„É•„Éº„ÅÆ„Éá„Éº„ÇøÈ†òÂüü|
       0000 0000       329 
       0000 0000       329 
       0000 0000       329 
       0000 0000       329 
00079f 00              330 bottom: .ds.b 1
0007a0 0000 0000       331 in: .ds.l 2 |„Ç≠„É•„Éº„ÅÆÂêÑÁ®Æ„Éù„Ç§„É≥„Çø‚Üì|
       0000 0000       331 
0007a8 0000 0000       332 out: .ds.l 2
       0000 0000       332 
0007b0 0000            333 PUT_FLG: .ds.b 2
0007b2 0000            334 GET_FLG: .ds.b 2
0007b4 0000 0000       335 s: .ds.l 2
       0000 0000       335 
                       336 
0007bc 0000 0000       337 top_ptr: .ds.l 1 |ÂÆüË°åÊôÇÁî®‰∏ÄÊôÇ‰øùÂ≠òÈ†òÂüü‚Üì|
0007c0 0000 0000       338 bottom_ptr: .ds.l 1
0007c4 0000 0000       339 in_ptr: .ds.l 1
0007c8 0000 0000       340 out_ptr: .ds.l 1
0007cc 00              341 PUT_FLG_ptr: .ds.b 1
0007cd 00              342 GET_FLG_ptr: .ds.b 1
0007ce 0000 0000       343 s_ptr: .ds.l 1
                       344 
                       345 .even
                       346 ******************************
                       347 ** „Ç≠„É•„ÉºÁî®„ÅÆ„É°„É¢„É™È†òÂüüÁ¢∫‰øù ‚Üë‚Üë
                       348 ******************************
                       349 
                       350 **********************  
                       351 
                       352 ** „Ç≠„É•„Éº„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ‚Üì‚Üì  
                       353 
                       354 **********************  
                       355 
                       356 Init_Q: 
                       357 
0007d2 48E7 80F8       358  	movem.l	%d0/%a0-%a4, -(%sp) 
                       359 
                       360   
                       361 
0007d6 7002            362 	move.l	#2, %d0			/*#4 -> #2*/ 
                       363 
                       364   
                       365 
0007d8 41FA FDC6       366 	lea.l 	top, %a0 
                       367 
0007dc 43FA FFC2       368  	lea.l	in, %a1 
                       369 
0007e0 45FA FFC6       370  	lea.l	out, %a2 
                       371 
0007e4 47FA FFCA       372  	lea.l	PUT_FLG, %a3 
                       373 
0007e8 49FA FFC8       374  	lea.l	GET_FLG, %a4 
                       375 
                       376   
                       377 
                       378 Loop_Init:	 
                       379 
0007ec 22C8            380  	move.l 	%a0, (%a1)+ 
                       381 
0007ee 24C8            382  	move.l 	%a0, (%a2)+ 
                       383 
0007f0 16FC 0001       384  	move.b 	#0x01, (%a3)+ 
                       385 
0007f4 18FC 0000       386  	move.b 	#0x00, (%a4)+ 
                       387 
                       388   
                       389 
0007f8 D1FC 0000       390 	adda.l	#B_SIZE, %a0 
       0100            390 
                       391 
                       392   
                       393 
0007fe 5380            394 	subq.l	#1, %d0 
                       395 
000800 6200 FFEA       396  	bhi	Loop_Init 
                       397 
                       398   
                       399 
000804 4CDF 1F01       400 	movem.l	(%sp)+, %d0/%a0-%a4 
                       401 
000808 4E75            402  	rts 
                       403 
                       404  **********************  
                       405 
                       406 ** „Ç≠„É•„Éº„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ ‚Üë‚Üë 
                       407 
                       408  **********************  
                       409 
                       410  
                       411 
                       412  
                       413 
                       414 ***********************************  
                       415 
                       416 ** INQ „Ç≠„É•„Éº„Å∏„ÅÆ„Éá„Éº„ÇøÊõ∏„ÅçËæº„Åø‚Üì‚Üì 
                       417 
                       418  ** a0: Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø„ÅÆ„Ç¢„Éâ„É¨„Çπ  
                       419 
                       420 ** (ÂÖ•Âäõ)d0: Êõ∏„ÅçËæº„ÇÄ„Ç≠„É•„Éº„ÅÆÁï™Âè∑0~1		 
                       421 
                       422  ** (Âá∫Âäõ)d0: ÁµêÊûú(00:Â§±Êïó, 01:ÊàêÂäü)  
                       423 
                       424 *********************************** 
                       425 
                       426  INQ: 
                       427 
00080a 48E7 7EFE       428  	movem.l	%d1-%d6/%a0-%a6, -(%sp)		/*ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø*/ 
                       429 
00080e 40E7            430  	move.w	%SR, -(%sp) 
                       431 
000810 46FC 2700       432  	move.w	#0x2700, %SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢*/ 
                       433 
                       434  		 
                       435 
000814 2600            436 	move.l	%d0, %d3		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆ‰øùÂ≠ò*/ 
                       437 
                       438   
                       439 
000816 49FA FF98       440 	lea.l	PUT_FLG, %a4 
                       441 
00081a D9C0            442  	add.l	%d0, %a4 
                       443 
00081c 13D4 0000       444  	move.b	(%a4), PUT_FLG_ptr 
       0000            444 
                       445 
                       446   
                       447 
000822 49FA FF8E       448 	lea.l	GET_FLG, %a4 
                       449 
000826 D9C0            450  	add.l	%d0, %a4 
                       451 
000828 13D4 0000       452  	move.b	(%a4), GET_FLG_ptr 
       0000            452 
                       453 
                       454   
                       455 
00082e C0FC 0004       456 	mulu	#4, %d0			 
                       457 
000832 49FA FF6C       458  	lea.l	in, %a4 
                       459 
000836 D9C0            460  	add.l	%d0, %a4 
                       461 
000838 23D4 0000       462  	move.l	(%a4), in_ptr 
       0000            462 
                       463 
                       464   
                       465 
00083e 49FA FF68       466 	lea.l	out, %a4 
                       467 
000842 D9C0            468  	add.l	%d0, %a4 
                       469 
000844 23D4 0000       470  	move.l	(%a4), out_ptr 
       0000            470 
                       471 
                       472   
                       473 
00084a C0FC 0040       474 	mulu	#64, %d0 
                       475 
00084e 49FA FD50       476  	lea.l 	top, %a4 
                       477 
000852 D9C0            478  	add.l	%d0, %a4 
                       479 
000854 23CC 0000       480  	move.l	%a4, top_ptr 
       0000            480 
                       481 
                       482   
                       483 
00085a 243C 0000       484 	move.l	#256, %d2		/*#768 -> #256*/ 
       0100            484 
                       485 
000860 9480            486  	sub.l	%d0, %d2 
                       487 
000862 7000            488  	move.l	#0, %d0			/*d0ÂàùÊúüÂåñ*/	 
                       489 
000864 49FA FF39       490  	lea.l	bottom, %a4 
                       491 
000868 99C2            492  	sub.l	%d2, %a4 
                       493 
00086a 23CC 0000       494  	move.l	%a4, bottom_ptr 
       0000            494 
                       495 
                       496   
                       497 
000870 4EBA 0036       498 	jsr 	PUT_BUF 	/* „Ç≠„É•„Éº„Å∏„ÅÆÊõ∏„ÅçËæº„Åø */ 
                       499 
                       500   
                       501 
000874 49FA FF3A       502 	lea.l	PUT_FLG, %a4 
                       503 
000878 D9C3            504  	add.l	%d3, %a4	 
                       505 
00087a 18BA FF50       506  	move.b 	PUT_FLG_ptr,(%a4)	 
                       507 
                       508   
                       509 
00087e 49FA FF32       510 	lea.l	GET_FLG, %a4 
                       511 
000882 D9C3            512  	add.l	%d3, %a4	 
                       513 
000884 18BA FF47       514  	move.b 	GET_FLG_ptr,(%a4)	 
                       515 
                       516   
                       517 
                       518  
                       519 
000888 C6FC 0004       520 	mulu	#4, %d3 
                       521 
00088c 49FA FF12       522  	lea.l 	in, %a4 
                       523 
000890 D9C3            524  	add.l	%d3, %a4 
                       525 
000892 28BA FF30       526  	move.l	in_ptr, (%a4) 
                       527 
                       528   
                       529 
000896 49FA FF10       530 	lea.l	out, %a4 
                       531 
00089a D9C3            532  	add.l	%d3, %a4 
                       533 
00089c 28BA FF2A       534  	move.l	out_ptr, (%a4) 
                       535 
                       536   
                       537 
0008a0 46DF            538 	move.w	(%sp)+, %SR 
                       539 
0008a2 4CDF 7F7E       540  	movem.l	(%sp)+, %d1-%d6/%a0-%a6		/*ÊóßËµ∞Ë°å„É¨„Éô„É´„ÅÆÂõûÂæ©*/ 
                       541 
0008a6 4E75            542  	rts 
                       543 
                       544  ***********************************  
                       545 
                       546 ** INQ „Ç≠„É•„Éº„Å∏„ÅÆ„Éá„Éº„ÇøÊõ∏„ÅçËæº„Åø‚Üë‚Üë 
                       547 
                       548  *********************************** 
                       549 
                       550   
                       551 
                       552  
                       553 
                       554 ****************************************  
                       555 
                       556 ** PUT_BUF‚Üì‚Üì 
                       557 
                       558  ** a0: Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø„ÅÆ„Ç¢„Éâ„É¨„Çπ 
                       559 
                       560  ** d0: ÁµêÊûú(00:Â§±Êïó, 00‰ª•Â§ñ:ÊàêÂäü)  
                       561 
                       562 ** d1: Êõ∏„ÅçËæº„ÇÄ8bit„Éá„Éº„Çø 
                       563 
                       564  ****************************************  
                       565 
                       566 PUT_BUF: 
                       567 
0008a8 48E7 0070       568  	movem.l	%a1-%a3, -(%sp) 
                       569 
0008ac 103A FF1E       570  	move.b	PUT_FLG_ptr, %d0 
                       571 
                       572   
                       573 
0008b0 0C00 0000       574 	cmp.b	#0x00, %d0		/* PUT‰∏çÂèØËÉΩ(Â§±Êïó) */ 
                       575 
0008b4 6700 0040       576  	beq	PUT_BUF_Finish 
                       577 
                       578   
                       579 
0008b8 227A FF0A       580 	movea.l	in_ptr, %a1		/* „Ç≠„É•„Éº„Å´„Éá„Éº„Çø„ÇíÊåøÂÖ• */ 
                       581 
0008bc 12C1            582  	move.b	%d1, (%a1)+ 
                       583 
                       584   
                       585 
0008be 06B9 0000       586 	addi.l	#1, s			/* „Ç≠„É•„ÉºÂÜÖ„ÅÆ„Éá„Éº„ÇøÊï∞:+1 */ 
       0001 0000       586 
       0000            586 
                       587 
                       588   
                       589 
0008c8 267A FEF6       590 	move.l	bottom_ptr, %a3		/* a3„ÅØ„Ç≠„É•„ÉºÊú´Â∞æ */ 
                       591 
0008cc B3CB            592  	cmpa.l	%a3, %a1		/* PUT„Éù„Ç§„É≥„Çø„ÅåÊú´Â∞æ„ÇíË∂Ö„Åà„Åü */ 
                       593 
0008ce 6300 0008       594  	bls	PUT_BUF_STEP1	 
                       595 
                       596   
                       597 
0008d2 247A FEE8       598 	move.l	top_ptr, %a2	/* PUT„Éù„Ç§„É≥„Çø„ÇíÂÖàÈ†≠„Å´Êàª„Åô */ 
                       599 
0008d6 224A            600  	movea.l	%a2, %a1 
                       601 
                       602   
                       603 
                       604 PUT_BUF_STEP1: 
                       605 
0008d8 23C9 0000       606  	move.l	%a1, in_ptr 
       0000            606 
                       607 
                       608   
                       609 
0008de B3FA FEE8       610 	cmpa.l	out_ptr, %a1	/* PUT„Éù„Ç§„É≥„Çø„ÅåGET„Éù„Ç§„É≥„Çø„Å´ËøΩ„ÅÑ„Å§„ÅÑ„Åü */ 
                       611 
0008e2 6600 000A       612  	bne	PUT_BUF_STEP2 
                       613 
                       614   
                       615 
0008e6 13FC 0000       616 	move.b	#0x00, PUT_FLG_ptr	/* Ê∫Ä„Çø„É≥„Å™„ÅÆ„ÅßPUT‰∏çÂèØËÉΩ(„Éï„É©„Ç∞) */ 
       0000 0000       616 
                       617 
                       618   
                       619 
                       620 PUT_BUF_STEP2: 
                       621 
0008ee 13FC 0001       622  	move.b	#0x01, GET_FLG_ptr 
       0000 0000       622 
                       623 
                       624   
                       625 
                       626 PUT_BUF_Finish: 
                       627 
0008f6 4CDF 0E00       628  	movem.l	(%sp)+, %a1-%a3 
                       629 
0008fa 4E75            630  	rts 
                       631 
                       632  ****************************************  
                       633 
                       634 ** PUT_BUF‚Üë‚Üë 
                       635 
                       636  **************************************** 
                       637 
                       638  
                       639 
                       640  
                       641 
                       642 ***********************************  
                       643 
                       644 ** OUTQ „Ç≠„É•„Éº„Åã„Çâ„ÅÆË™≠„ÅøÂá∫„Åó‚Üì‚Üì 
                       645 
                       646  ** a2: Ë™≠„ÅøÂá∫„ÅóÂÖà„Ç¢„Éâ„É¨„Çπ 
                       647 
                       648  ** d0(ÂÖ•Âäõ):„Ç≠„É•„ÉºÁï™Âè∑ 
                       649 
                       650  ** d0(Âá∫Âäõ): ÁµêÊûú(00:Â§±Êïó, 01:ÊàêÂäü)  
                       651 
                       652 ** d1: Âèñ„ÇäÂá∫„Åó„Åü8bit„Éá„Éº„Çø 
                       653 
                       654  *********************************** 
                       655 
                       656  OUTQ: 
                       657 
0008fc 48E7 3EFE       658  	movem.l	%d2-%d6/%a0-%a6, -(%sp) 
                       659 
000900 40E7            660  	move.w	%SR, -(%sp)		/*ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø*/ 
                       661 
000902 46FC 2700       662  	move.w	#0x2700, %SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢*/ 
                       663 
                       664   
                       665 
000906 2600            666 	move.l	%d0, %d3		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆ‰øùÂ≠ò*/ 
                       667 
                       668   
                       669 
000908 49FA FEA6       670 	lea.l	PUT_FLG, %a4 
                       671 
00090c D9C0            672  	add.l	%d0, %a4 
                       673 
00090e 13D4 0000       674  	move.b	(%a4), PUT_FLG_ptr 
       0000            674 
                       675 
                       676   
                       677 
000914 49FA FE9C       678 	lea.l	GET_FLG, %a4 
                       679 
000918 D9C0            680  	add.l	%d0, %a4 
                       681 
00091a 13D4 0000       682  	move.b	(%a4), GET_FLG_ptr 
       0000            682 
                       683 
                       684   
                       685 
000920 C0FC 0004       686 	mulu	#4, %d0			 
                       687 
000924 49FA FE7A       688  	lea.l	in, %a4 
                       689 
000928 D9C0            690  	add.l	%d0, %a4 
                       691 
00092a 23D4 0000       692  	move.l	(%a4), in_ptr 
       0000            692 
                       693 
                       694   
                       695 
000930 49FA FE76       696 	lea.l	out, %a4 
                       697 
000934 D9C0            698  	add.l	%d0, %a4 
                       699 
000936 23D4 0000       700  	move.l	(%a4), out_ptr 
       0000            700 
                       701 
                       702   
                       703 
00093c C0FC 0040       704 	mulu	#64, %d0 
                       705 
000940 49FA FC5E       706  	lea.l 	top, %a4 
                       707 
000944 D9C0            708  	add.l	%d0, %a4 
                       709 
000946 23CC 0000       710  	move.l	%a4, top_ptr 
       0000            710 
                       711 
                       712   
                       713 
00094c 243C 0000       714 	move.l	#256, %d2		/*#768 -> #256*/ 
       0100            714 
                       715 
000952 9480            716  	sub.l	%d0, %d2 
                       717 
000954 7000            718  	move.l	#0, %d0			/*d0ÂàùÊúüÂåñ*/	 
                       719 
000956 49FA FE47       720  	lea.l	bottom, %a4 
                       721 
00095a 99C2            722  	sub.l	%d2, %a4 
                       723 
00095c 23CC 0000       724  	move.l	%a4, bottom_ptr 
       0000            724 
                       725 
                       726   
                       727 
000962 4EBA 0036       728 	jsr 	GET_BUF 	/* „Ç≠„É•„Éº„Åã„Çâ„ÅÆË™≠„ÅøÂá∫„Åó */ 
                       729 
                       730   
                       731 
000966 49FA FE48       732 	lea.l	PUT_FLG, %a4 
                       733 
00096a D9C3            734  	add.l	%d3, %a4	 
                       735 
00096c 18BA FE5E       736  	move.b 	PUT_FLG_ptr,(%a4)	 
                       737 
                       738   
                       739 
000970 49FA FE40       740 	lea.l	GET_FLG, %a4 
                       741 
000974 D9C3            742  	add.l	%d3, %a4	 
                       743 
000976 18BA FE55       744  	move.b 	GET_FLG_ptr,(%a4)	 
                       745 
                       746   
                       747 
                       748  
                       749 
00097a C6FC 0004       750 	mulu	#4, %d3 
                       751 
00097e 49FA FE20       752  	lea.l 	in, %a4 
                       753 
000982 D9C3            754  	add.l	%d3, %a4 
                       755 
000984 28BA FE3E       756  	move.l	in_ptr, (%a4) 
                       757 
                       758   
                       759 
000988 49FA FE1E       760 	lea.l	out, %a4 
                       761 
00098c D9C3            762  	add.l	%d3, %a4 
                       763 
00098e 28BA FE38       764  	move.l	out_ptr, (%a4) 
                       765 
                       766   
                       767 
                       768  
                       769 
000992 46DF            770 	move.w	(%sp)+, %SR		/*ÊóßËµ∞Ë°åÁä∂ÊÖã„ÅÆÂõûÂæ©*/ 
                       771 
000994 4CDF 7F7C       772  	movem.l	(%sp)+, %d2-%d6/%a0-%a6 
                       773 
000998 4E75            774  	rts 
                       775 
                       776  ***********************************  
                       777 
                       778 ** OUTQ „Ç≠„É•„Éº„Åã„Çâ„ÅÆË™≠„ÅøÂá∫„Åó‚Üë‚Üë 
                       779 
                       780  *********************************** 
                       781 
                       782   
                       783 
                       784  
                       785 
                       786 ****************************************  
                       787 
                       788 ** GET_BUF‚Üì‚Üì 
                       789 
                       790  ** a2: Ë™≠„ÅøÂá∫„ÅóÂÖà„Ç¢„Éâ„É¨„Çπ 
                       791 
                       792  ** d0: ÁµêÊûú(00:Â§±Êïó, 00‰ª•Â§ñ:ÊàêÂäü)  
                       793 
                       794 ** d1: Âèñ„ÇäÂá∫„Åó„Åü8bit„Éá„Éº„Çø 
                       795 
                       796  ****************************************  
                       797 
                       798 GET_BUF: 
                       799 
00099a 48E7 0058       800  	movem.l	%a1/%a3-%a4, -(%sp) 
                       801 
00099e 103A FE2D       802  	move.b	GET_FLG_ptr, %d0 
                       803 
                       804   
                       805 
0009a2 0C00 0000       806 	cmp.b	#0x00, %d0	/* GET‰∏çÂèØËÉΩ(Â§±Êïó) */ 
                       807 
0009a6 6700 0040       808  	beq	GET_BUF_Finish 
                       809 
                       810   
                       811 
0009aa 227A FE1C       812 	movea.l	out_ptr, %a1	/* „Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøÂá∫„Åô */ 
                       813 
0009ae 1219            814  	move.b	(%a1)+, %d1	/* Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø */ 
                       815 
                       816   
                       817 
                       818  
                       819 
0009b0 04B9 0000       820 	subi.l	#1, s		/* „Ç≠„É•„ÉºÂÜÖ„ÅÆ„Éá„Éº„ÇøÊï∞:-1 */ 
       0001 0000       820 
       0000            820 
                       821 
                       822   
                       823 
0009ba 267A FE04       824 	move.l	bottom_ptr, %a3	/* a3„ÅØ„Ç≠„É•„ÉºÊú´Â∞æ */ 
                       825 
0009be B3CB            826  	cmpa.l	%a3, %a1	/* GET„Éù„Ç§„É≥„Çø„ÅåÊú´Â∞æ„ÇíË∂Ö„Åà„Åü */ 
                       827 
0009c0 6300 0008       828  	bls	GET_BUF_STEP1	 
                       829 
                       830   
                       831 
0009c4 287A FDF6       832 	move.l	top_ptr, %a4	/* GET„Éù„Ç§„É≥„Çø„ÇíÂÖàÈ†≠„Å´Êàª„Åô */ 
                       833 
0009c8 224C            834  	movea.l	%a4, %a1 
                       835 
                       836   
                       837 
                       838 GET_BUF_STEP1: 
                       839 
0009ca 23C9 0000       840  	move.l	%a1, out_ptr 
       0000            840 
                       841 
                       842   
                       843 
0009d0 B3FA FDF2       844 	cmpa.l	in_ptr, %a1	/* GET„Éù„Ç§„É≥„Çø„ÅåPUT„Éù„Ç§„É≥„Çø„Å´ËøΩ„ÅÑ„Å§„ÅÑ„Åü */ 
                       845 
0009d4 6600 000A       846  	bne	GET_BUF_STEP2 
                       847 
                       848   
                       849 
0009d8 13FC 0000       850 	move.b	#0x00, GET_FLG_ptr	/* „Éá„Éº„Çø„Åå„Å™„ÅÑ„ÅÆ„ÅßGET‰∏çÂèØËÉΩ(„Éï„É©„Ç∞) */ 
       0000 0000       850 
                       851 
                       852   
                       853 
                       854 GET_BUF_STEP2: 
                       855 
0009e0 13FC 0001       856  	move.b	#0x01, PUT_FLG_ptr 
       0000 0000       856 
                       857 
                       858   
                       859 
                       860 GET_BUF_Finish: 
                       861 
0009e8 4CDF 1A00       862  	movem.l	(%sp)+, %a1/%a3-%a4 
                       863 
0009ec 4E75            864  	rts 
                       865 
                       866  ****************************************  
                       867 
                       868 ** GET_BUF‚Üë‚Üë 
                       869 
                       870  **************************************** 
                       871 
                       872 
                       873 
                       874 
                       875 
                       876 
                       877 
                       878 
                       879 
