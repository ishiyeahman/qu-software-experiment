                         4 .list
                         5 /* ÂàùÊúüÂåñ*/
                         6 
                         7 		***************************************************************
                         8 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         9 		***************************************************************
                        10 
                        11 		***************
                        12 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        13 		***************
                        14 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        15 		.equ IOBASE,    0x00d00000
                        16 
                        17 		***************
                        18 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        19 		***************
                        20 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        21 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        22 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        23 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        24 
                        25 		***************
                        26 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        27 		***************
                        28 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        29 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        30 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        31 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        32 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        33 
                        34 		***************
                        35 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        36 		***************
                        37 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        38 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        39 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        40 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        41 
                        42 		***************
                        43 		** LED
                        44 		***************
                        45 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        46 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        47 		.equ LED5,      IOBASE+0x000002b
                        48 		.equ LED4,      IOBASE+0x0000029
                        49 		.equ LED3,      IOBASE+0x000003f
                        50 		.equ LED2,      IOBASE+0x000003d
                        51 		.equ LED1,      IOBASE+0x000003b
                        52 		.equ LED0,      IOBASE+0x0000039
                        53 
                        54 		***************************************************************
                        55 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        56 		***************************************************************
                        57 		.section .bss
                        58 		.even
                        59 SYS_STK:
000cb8 0000 0000        60 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
       0000 0000        60 
                        61 		.even
                        62 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
004cb8 0000 0000        63 		WORK: .ds.b 256 /*step6_test*/
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
       0000 0000        63 
                        64 		***************************************************************
                        65 		** ÂàùÊúüÂåñ
                        66 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        67 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        68 		***************************************************************
                        69 		.section .text
                        70 		.even
                        71 boot:
                        72 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        73 		move.w #0x2700,%SR
000404 4FF9 0000        74 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             74 
                        75 
                        76 		****************
                        77 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        78 		****************
00040a 13FC 0040        79 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        79 
000412 23FC 00FF        80 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        80 
       F304             80 
                        81 
                        82 		****************
                        83 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        84 		****************
00041c 33FC 0000        85 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        85 
000424 33FC E108        86 		move.w #0xe108, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        86 
00042c 33FC 0038        87 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        87 
                        88 
                        89 		****************
                        90 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        91 		****************
000434 33FC 0004        92 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        92 
                        93 
                        94 		***************************************************************
                        95 		** STEP2„ÅÆÂá¶ÁêÜ
                        96 		***************************************************************
                        97 		*lea.l uart1_interrupt, %a0
                        98 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 23FC 00FF        99 		move.l #0x00ff3ff9,IMR  |UART1Ë®±ÂèØ
       3FF9 00FF        99 
       F304             99 
                       100 
                       101 		/*trap #0„Å´ÁôªÈå≤*/
000446 21FC 0000       102 		move.l #CALL_SYSTEM, 0x080
       0000 0080       102 
                       103 
00044e 21FC 0000       104 		move.l #uart1_interrupt, 0x110
       0000 0110       104 
000456 21FC 0000       105 		move.l #timer1_interrupt, 0x118 /* „Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„ÅÆÁôªÈå≤ */
       0000 0118       105 
                       106 		
                       107 
                       108 		
                       109 
                       110         	/* Queue initialize */
00045e 4EB9 0000       111         	jsr Init_Q
       0000            111 
                       112 
000464 4EBA 0006       113 		jsr LED_CLEAR
                       114 
                       115 
                       116 		/*step9„ÅÆMAIN„Å∏*/
000468 6000 013A       117 		bra MAIN		
                       118 
                       119 
                       120 LED_CLEAR:
00046c 13FC 0020       121 	move.b #' ', LED0
       00D0 0039       121 
000474 13FC 0020       122 	move.b #' ', LED1
       00D0 003B       122 
00047c 13FC 0020       123 	move.b #' ', LED2
       00D0 003D       123 
000484 13FC 0020       124 	move.b #' ', LED3
       00D0 003F       124 
00048c 13FC 0020       125 	move.b #' ', LED4
       00D0 0029       125 
000494 13FC 0020       126 	move.b #' ', LED5
       00D0 002B       126 
00049c 13FC 0020       127 	move.b #' ', LED6
       00D0 002D       127 
0004a4 13FC 0020       128 	move.b #' ', LED7
       00D0 002F       128 
0004ac 4E75            129 	rts
                       130 /*trap #0„Åß„ÅÆÂá¶ÁêÜ,SYSTEMCALL*/
                       131 CALL_SYSTEM:
                       132 	*move.w #0x2000, %SR /* „Åì„ÅÑ„Å§„ÅÆ„Åõ„ÅÑ„Åß„ÄÅ„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Ç®„É©„ÉºÁô∫Áîü */
                       133 
0004ae 0C40 0001       134 	cmpi #1, %d0
0004b2 6600 000A       135 	bne CALL_PUT
                       136 
                       137 	*lea.l GETSTRING, %a0
                       138 	*move.l (%a0), %d0
                       139 	*jmp (%a0)
                       140 	
0004b6 4EBA 046C       141 	jsr GETSTRING	
                       142 	
0004ba 6000 0066       143 	bra CALL_END
                       144 
                       145 CALL_PUT:
                       146 	
0004be 0C40 0002       147 	cmpi #2, %d0
0004c2 6600 000A       148 	bne CALL_RESET
                       149 
                       150 	*lea.l PUTSTRING, %a0
                       151 	*move.l (%a0), %d0
                       152 	*jmp %a0
                       153 
0004c6 4EBA 040C       154 	jsr PUTSTRING
                       155 
0004ca 6000 0056       156 	bra CALL_END
                       157 
                       158 
                       159 CALL_RESET:
                       160 	
0004ce 0C40 0003       161 	cmpi #3, %d0
0004d2 6600 000A       162 	bne CALL_SET
                       163 	
                       164 	*lea.l RESET_TIMER, %a0
                       165 	*move.l (%a0), %d0
                       166 	*jmp (%a0)
                       167 	
0004d6 4EBA 004C       168 	jsr RESET_TIMER
                       169 	
0004da 6000 0046       170 	bra CALL_END
                       171 
                       172 CALL_SET:
                       173 	
0004de 0C40 0004       174 	cmpi #4, %d0
0004e2 6600 000A       175 	bne CALL_TYPE_GAME_SETTING
                       176 
                       177 	*lea.l SET_TIMER, %a0
                       178 	*move.l (%a0), %d0
                       179 	*jmp (%a0)
                       180 	
0004e6 4EBA 004E       181 	jsr SET_TIMER
                       182 	
0004ea 6000 0036       183 	bra CALL_END
                       184 
                       185 CALL_TYPE_GAME_SETTING:
0004ee 13FC 0058       186 	move.b #'X', LED7
       00D0 002F       186 
0004f6 0C40 0005       187 	cmpi #5, %d0
0004fa 6600 000E       188 	bne CALL_TYPE_GAME_PRINT
                       189 	
0004fe 4EBA 00CE       190 	jsr TYPE_GAME_SETTING
000502 4EBA FF68       191 	jsr LED_CLEAR
                       192 	
000506 6000 001A       193 	bra CALL_END
                       194 
                       195 CALL_TYPE_GAME_PRINT:
00050a 0C40 0006       196 	cmpi #6, %d0
00050e 6600 0012       197 	bne CALL_END
                       198 
000512 4EBA 0120       199 	jsr TYPE_GAME_PRINT_NEW_LINE
000516 4EBA 00F8       200 	jsr TYPE_GAME_PRINT_TXT
00051a 4EBA 0118       201 	jsr TYPE_GAME_PRINT_NEW_LINE
                       202 
00051e 6000 0002       203 	bra CALL_END
                       204 
                       205 CALL_END:
000522 4E73            206 	rte /* ‚òì rte -> rts */
                       207 
                       208 
                       209 
                       210 *****************************************************************************************
                       211 ** TIMER SETTING
                       212 *****************************************************************************************
                       213 
                       214 ************************************************************* 
                       215 **RESET_TIMER 
                       216 **Ê©üËÉΩ 
                       217 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã 
                       218 ************************************************************* 
                       219 
                       220 RESET_TIMER: 
000524 13FC 0035       221 	move.b  #'5', LED3      /*ÊñáÂ≠ó‚Äô5‚Äô„ÇíLED„ÅÆ4Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 003F       221 
00052c 33FC 0004       222 	move.w #0x0004, TCTL1 /* 1.TCTL1„Çí„Çø„Ç§„Éû‰ΩøÁî®ÂÅúÊ≠¢„Å´Ë®≠ÂÆö */ 
       00FF F600       222 
000534 4E75            223 	rts
                       224 
                       225 
                       226   
                       227 ************************************************************* 
                       228 **SET_TIMER 
                       229 **Ê©üËÉΩ 
                       230 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„Çí‰∏çÂèØ„Å´„ÅóÔºå„Çø„Ç§„Éû„ÇÇÂÅúÊ≠¢„Åô„Çã„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âëº„Å≥
                       231 **	„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÂë®Êúüt„ÇíË®≠ÂÆö„ÅóÔºåt*0.1msecÁßíÊØé„Å´Ââ≤„ÇäËæº„Åø„ÅåÁô∫Áîü„Åô„Çã„Çà„ÅÜ„Å
                       232 **	„Çø„Ç§„Éû‰ΩøÁî®„ÇíË®±ÂèØ„ÅóÔºå„Çø„Ç§„ÉûÂâ≤„ÇäËæº„Åø„ÇíË®±ÂèØ„Åô„ÇãÔºé(=„Çø„Ç§„Éû„Çí„Çπ„Çø„Éº„Éà„
                       233 **ÂÖ•Âäõ 
                       234 **	d1:„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü 
                       235 **	d2:Ââ≤„ÇäËæº„ÅøÊôÇ„Å´Ëµ∑Âãï„Åô„Çã„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       236 **Êàª„ÇäÂÄ§ 
                       237 **	„Å™„Åó 
                       238 *************************************************************
                       239   
                       240 
                       241 SET_TIMER:
000536 13FC 0031       242 	move.b  #'1', LED7      /*ÊñáÂ≠ó‚Äô1‚Äô„ÇíLED„ÅÆ8Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002F       242 
00053e 23C2 0000       243 	move.l %d2, task_p /* 1.Ââ≤„ÇäËæº„Åø„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„ÇíÔºåtask_p„Å´‰ª£ÂÖ• „Å°„Çá„
       0000            243 
000544 33FC 00CE       244 	move.w #0x00ce, TPRER1 /* 2.TPRER1„Çí„ÄÅ0.1msecÈÄ≤„ÇÄ„Å®„Ç´„Ç¶„É≥„Çø„Åå1Â¢ó„Åà„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö *
       00FF F602       244 
00054c 33C1 00FF       245 	move.w %d1, TCMP1 /* 3.„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü„ÇíÔºåTCMP1„Å´‰ª£ÂÖ• Ë¶Å‰øÆÊ≠£ */ 
       F604            245 
000552 33FC 0015       246 	move.w #0x0015, TCTL1 /* 4.TCTL1„ÇíÂâ≤„ÇäËæº„ÅøË®±ÂèØ„Å´Ë®≠ÂÆö */  
       00FF F600       246 
00055a 4E75            247 	rts
                       248 
                       249 ************************************************************* 
                       250 **CALL_RP 
                       251 **Ê©üËÉΩ 
                       252 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„Å´Âá¶ÁêÜ„Åô„Åπ„Åç„É´„Éº„ÉÅ„É≥„ÇíÂëº„Å≥Âá∫„Åô 
                       253 ************************************************************* 
                       254 
                       255 CALL_RP: 
00055c 13FC 0032       256 	move.b  #'2', LED6      /*ÊñáÂ≠ó‚Äô2‚Äô„ÇíLED„ÅÆ7Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002D       256 
000564 2079 0000       257 	movea.l task_p, %a0
       0000            257 
00056a 4E90            258 	jsr (%a0)
                       259 	*jsr task_p /* 1.task_p„ÅÆÊåá„Åô„Ç¢„Éâ„É¨„Çπ„Å∏„Ç∏„É£„É≥„Éó„Åô„Çã „Åì„ÅìËá™‰ø°„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„Å™„Ç
00056c 4E75            260 	rts /* Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„Å´Êàª„Çã */ 
                       261 
                       262  
                       263 ************************************************************* 
                       264 **p 
                       265 **Ê©üËÉΩ 
                       266 **„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥ 
                       267 **Â§öÂàÜÂêÑËá™„Åß‰ΩúÊàê (Ë™≤È°å10) 
                       268 ************************************************************* 
                       269 *p: 
                       270 	*rts /* CALL_RP„Å´Êàª„Çã */ 
                       271  
                       272 
                       273 
                       274 
                       275 ***************************************************************************************************
                       276 **   CALL SETTING
                       277 ***************************************************************************************************
                       278 /*ÂêÑ„Ç∑„Çπ„ÉÜ„É†„ÅÆÂëº„Å≥Âá∫„Åó,t„ÉÜ„Çπ„Éà„Åß„ÅØMAIN„Å´„ÅÇ„Çã„Åü„ÇÅ‰ΩøÁî®„Åó„Å™„ÅÑ?*/
                       279 /*GETSTRINGÂëº„Å≥Âá∫„Åó*/
                       280 CALL_GETSTRING:
00056e 7001            281 	move.l #1, %d0		/*GETSTRING*/
000570 7200            282 	move.l #0,%d1		/*ch=0*/
000572 243C 0000       283 	move.l #BUF, %d2	/*p=#BUF*/
       0000            283 
000578 263C 0000       284 	move.l #256, %d3	/*size=256*/
       0100            284 
00057e 4E40            285 	trap #0
                       286 
                       287 /*PUTSTRINGÂëº„Å≥Âá∫„Åó*/
                       288 CALL_PUTSTRING:
000580 7002            289 	move.l #2, %d0		/*PUTSTRING*/
000582 7200            290 	move.l #0,%d1		/*ch=0*/
000584 243C 0000       291 	move.l #BUF, %d2	/*p=#BUF*/
       0000            291 
00058a 263C 0000       292 	move.l #256, %d3	/*size=256*/
       0100            292 
000590 4E40            293 	trap #0
                       294 
                       295 /*RESET_TIMERÂëº„Å≥Âá∫„Åó*/
                       296 CALL_RESET_TIMER:
000592 7003            297 	move.l #3, %d0		/*RESET_TIMER*/
000594 4E40            298 	trap #0
                       299 
                       300 /*SET_TIMERÂëº„Å≥Âá∫„Åó*/
                       301 CALL_SET_TIMER:
000596 7004            302 	move.l #4, %d0		/*SET_TIMER*/
000598 323C C350       303 	move.w #50000, %d1		/*d1=„Çø„Ç§„ÉûÂâ≤„ÇäËæº„ÅøÁô∫ÁîüÂë®Êúü*/
00059c 243C 0000       304 	move.l #TT, %d2		/*„É´„Éº„ÉÅ„É≥„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπd2=#TT*/
       0000            304 
0005a2 4E40            305 	trap #0
                       306 
                       307 
                       308 /*‰ª•‰∏ästep8*/
                       309 
                       310 
                       311 
                       312 
                       313 
                       314 ******************************************************
                       315 ***„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´Áï™Âè∑
                       316 ******************************************************
                       317 	.equ SYSCALL_NUM_GETSTRING,	1
                       318 	.equ SYSCALL_NUM_PUTSTRING,	2
                       319 	.equ SYSCALL_NUM_RESET_TIMER,	3
                       320 	.equ SYSCALL_NUM_SET_TIMER,	4
                       321 	.equ SYSCALL_TYPE_GAME_SET,	5
                       322 	.equ SYSCALL_TYPE_GAME_PRINT,	6
                       323 
                       324 
                       325 ******************************************************
                       326 ***„Éó„É≠„Ç∞„É©„É†È†òÂüü
                       327 ******************************************************
                       328 .section .text
                       329 .even
                       330 MAIN:						/*Ëµ∞Ë°å„É¢„Éº„Éâ„Å®„É¨„Éô„É´„ÅÆË®≠ÂÆö(„É¶„Éº„Ç∂„É¢„Éº„Éâ„Å∏ÁßªË°å)*/
                       331 
0005a4 46FC 0000       332 	move.w #0x0000, %SR				/*USER_MODE_LEBEL„Çí0„Å´*/
0005a8 4FF9 0000       333 	lea.l USR_STK_TOP, %SP				/*USER_STACK„ÇíË®≠ÂÆö*/
       0000            333 
                       334 
                       335 	
0005ae 223C 0000       336 	move.l #TXT_hello, %d1
       0000            336 
0005b4 243C 0000       337 	move.l #SIZE_hello, %d2
       000B            337 
                       338 
0005ba 4EBA 0012       339     	jsr TYPE_GAME_SETTING
0005be 4EBA 0038       340 	jsr TYPE_GAME_INTRO
0005c2 4EBA 004C       341 	jsr TYPE_GAME_PRINT_TXT
0005c6 4EBA 006C       342 	jsr TYPE_GAME_PRINT_NEW_LINE
                       343 
0005ca 6000 00B0       344 	bra LOOP
                       345 	*move.l #SYSCALL_NUM_RESET_TIMER, %d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßRESET_TIMER„ÅÆËµ∑Âãï*/
                       346 	*trap #0
                       347 
                       348 
                       349 	*move.l #SYSCALL_NUM_SET_TIMER,%d0		/*„Ç∑„Çπ„ÉÜ„É†„Ç≥„Éº„É´„ÅßSET_TIMER„ÅÆËµ∑Âãï*/
                       350 	*move.w #50000, %d1
                       351 	*move.l #TT, %d2
                       352 	*trap #0
                       353 
                       354 	*bra LOOP
                       355 	
                       356 ** !! *********************************
                       357 ** Typing Game routine
                       358 ** !! *********************************
                       359 
                       360 **********************
                       361 ** TYPE_GAME_SETTING
                       362 ** ÂºïÊï∞ %d1.l %d2.l
                       363 *********************
                       364 TYPE_GAME_SETTING:
0005ce 23FC 0000       365 	move.l #0, (COUNT_SIZE)
       0000 0000       365 
       0000            365 
0005d8 23FC 0000       366 	move.l #0, (COUNT_FAULT)
       0000 0000       366 
       0000            366 
0005e2 13FC 0000       367 	move.b #0, (END_FLG)
       0000 0000       367 
0005ea 23C1 0000       368 	move.l %d1, TXT_P
       0000            368 
0005f0 23C2 0000       369 	move.l %d2, (TXT_SIZE)
       0000            369 
                       370 	
0005f6 4E75            371     	rts
                       372 
                       373 TYPE_GAME_INTRO:
0005f8 48E7 FF00       374 	movem.l %d0-%d7,-(%SP)	
0005fc 7002            375    	move.l #SYSCALL_NUM_PUTSTRING, %d0
0005fe 7200            376 	move.l #0, %d1				/*ch=0*/
000600 243C 0000       377 	move.l #INTRO, %d2			/*p=#INTRO*/
       0000            377 
000606 761C            378 	move.l #28, %d3				/*size=8*/
000608 4E40            379 	trap #0
00060a 4CDF 00FF       380 	movem.l (%SP)+, %d0-%d7
00060e 4E75            381 	rts
                       382 
                       383 TYPE_GAME_PRINT_TXT:
000610 4EBA 0052       384 	jsr CHANGE_CODE_I
                       385 
000614 48E7 FF00       386 	movem.l %d0-%d7,-(%SP)	
000618 7002            387     	move.l #SYSCALL_NUM_PUTSTRING, %d0
00061a 7200            388 	move.l #0, %d1				/*ch=0*/
                       389 	*move.l #TXT_hello, %d2			/*p=#INTRO*/
00061c 2439 0000       390 	move.l (TXT_P), %d2
       0000            390 
                       391 	*move.l #SIZE_hello, %d3				/*size=8*/
000622 2639 0000       392 	move.l	(TXT_SIZE), %d3	
       0000            392 
000628 4E40            393 	trap #0
00062a 4CDF 00FF       394 	movem.l (%SP)+, %d0-%d7
                       395 
00062e 4EBA 001C       396 	jsr CHANGE_CODE_DEF
000632 4E75            397 	rts
                       398 
                       399 TYPE_GAME_PRINT_NEW_LINE:
000634 48E7 FF00       400 	movem.l %d0-%d7,-(%SP)	
000638 7002            401     	move.l #SYSCALL_NUM_PUTSTRING, %d0
00063a 7200            402 	move.l #0, %d1				/*ch=0*/
00063c 243C 0000       403 	move.l #NEW_LINE, %d2			/*p=#INTRO*/
       0000            403 
000642 7602            404 	move.l #2, %d3				/*size=8*/
000644 4E40            405 	trap #0
000646 4CDF 00FF       406 	movem.l (%SP)+, %d0-%d7
00064a 4E75            407 	rts /* TYPE_GAME_LAST */
                       408 
                       409 CHANGE_CODE_DEF:
00064c 48E7 FF00       410 	movem.l %d0-%d7,-(%SP)	
000650 7002            411    	move.l #SYSCALL_NUM_PUTSTRING, %d0
000652 7200            412 	move.l #0, %d1				/*ch=0*/
000654 243C 0000       413 	move.l #CODE_DEF, %d2			/*p=#INTRO*/
       0000            413 
00065a 7605            414 	move.l #5, %d3				/*size=8*/
00065c 4E40            415 	trap #0
00065e 4CDF 00FF       416 	movem.l (%SP)+, %d0-%d7
000662 4E75            417 	rts
                       418 	
                       419 CHANGE_CODE_I:
000664 48E7 FF00       420 	movem.l %d0-%d7,-(%SP)	
000668 7002            421    	move.l #SYSCALL_NUM_PUTSTRING, %d0
00066a 7200            422 	move.l #0, %d1				/*ch=0*/
00066c 243C 0000       423 	move.l #CODE_I, %d2			/*p=#INTRO*/
       0000            423 
000672 7605            424 	move.l #5, %d3				/*size=8*/
000674 4E40            425 	trap #0
000676 4CDF 00FF       426 	movem.l (%SP)+, %d0-%d7
00067a 4E75            427 	rts
                       428 
                       429 
                       430 
                       431 
                       432 
                       433 
                       434 ******************************************************
                       435 ***sys_GETSTRING,SYS_PUTSTRING„ÅÆ„ÉÜ„Çπ„Éà
                       436 ***„Çø„Éº„Éü„Éä„É´„ÅÆÂÖ•Âäõ„Çí„Ç®„Ç≥„Éº„Éê„ÉÉ„ÇØ
                       437 ******************************************************
                       438 
                       439 LOOP:
00067c 7001            440 	move.l #SYSCALL_NUM_GETSTRING, %d0	/*GETSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
00067e 7200            441 	move.l #0, %d1				/*ch=0*/
000680 243C 0000       442 	move.l #BUF, %d2			/*p=#BUF*/
       0000            442 
000686 263C 0000       443 	move.l #256, %d3			/*size=256*/
       0100            443 
00068c 4E40            444 	trap #0
                       445 
                       446 
00068e 2600            447 	move.l %d0, %d3				/*size=d0*/
000690 7002            448 	move.l #SYSCALL_NUM_PUTSTRING, %d0	/*PUTSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
000692 7200            449 	move.l #0, %d1				/*ch=0*/
000694 243C 0000       450 	move.l #BUF, %d2			/*p=#BUF*/
       0000            450 
                       451 	*move.l #256, %d3				/*size=d0*/
00069a 4E40            452 	trap #0
                       453 	
00069c 0C39 0001       454 	cmp.b #0x01, (END_FLG)
       0000 0000       454 
0006a4 6600 FFD6       455 	bne LOOP
                       456 
                       457 TG_SET:	
                       458 	
                       459 		
0006a8 7005            460 	move.l #SYSCALL_TYPE_GAME_SET, %d0	/*PUTSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
0006aa 223C 0000       461 	move.l #TXT_univ, %d1
       0000            461 
0006b0 243C 0000       462 	move.l #SIZE_univ, %d2				/*size=d0*/
       001D            462 
0006b6 4E40            463 	trap #0
                       464 
0006b8 7006            465 	move.l #SYSCALL_TYPE_GAME_PRINT, %d0	/*PUTSTRING„ÅÆÂëº„Å≥Âá∫„Åó*/
0006ba 4E40            466 	trap #0
                       467 	
                       468 
0006bc 6000 FFBE       469 	bra LOOP
                       470 
                       471 ******************************************************
                       472 ***„Çø„Ç§„Éû„ÅÆ„ÉÜ„Çπ„Éà
                       473 ***'******'„ÇíË°®Á§∫„ÅóÊîπË°å
                       474 ***5ÂõûÂÆüË°å„Åó„Å¶RESET_TIMER
                       475 ******************************************************
                       476 
                       477 TT:
0006c0 13FC 0034       478 	move.b  #'4', LED4      /*ÊñáÂ≠ó‚Äô4‚Äô„ÇíLED„ÅÆ5Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 0029       478 
0006c8 48E7 FFFE       479 	movem.l %d0-%d7/%a0-%a6,-(%SP)		/*„É¨„Ç∏„Çπ„ÇøÈÄÄÈÅø*/
0006cc 0C79 0005       480 	cmpi.w #5, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Åß5ÂõûÂÆüË°å„Çí„Ç´„Ç¶„É≥„Éà*/
       0000 0000       480 
0006d4 6700 001C       481 	beq TTKILL				/*5ÂõûÂÆüË°å„Åó„Åü„Çâ„Çø„Ç§„Éû„ÇíÂÅúÊ≠¢*/
                       482 
0006d8 7002            483 	move.l #SYSCALL_NUM_PUTSTRING, %d0
0006da 7200            484 	move.l #0, %d1				/*ch=0*/
0006dc 243C 0000       485 	move.l #TMSG, %d2			/*p=#TMSG*/
       0000            485 
0006e2 7608            486 	move.l #8, %d3				/*size=8*/
0006e4 4E40            487 	trap #0
                       488 
0006e6 0679 0001       489 	addi.w #1, TTC				/*TTC„Ç´„Ç¶„É≥„Çø„Çí1„Å§Â¢ó„ÇÑ„Åô*/
       0000 0000       489 
0006ee 6000 0006       490 	bra TTEND				/*„Åù„ÅÆ„Åæ„ÅæÊàª„Çã*/
                       491 
                       492 TTKILL:
0006f2 7003            493 	move.l #SYSCALL_NUM_RESET_TIMER, %d0	/*RESET_TIMER„ÅÆÂëº„Å≥Âá∫„Åó*/
0006f4 4E40            494 	trap #0
                       495 TTEND:
0006f6 4CDF 7FFF       496 	movem.l (%SP)+, %d0-%d7/%a0-%a6		/*„É¨„Ç∏„Çπ„ÇøÂæ©Â∏∞*/
0006fa 4E75            497 	rts
                       498 
                       499 
                       500 
                       501 
                       502 *****************************************************
                       503 **    Ââ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éï„Çß„Éº„Çπ
                       504 *****************************************************
                       505 uart1_interrupt:
0006fc 48E7 F000       506 	movem.l %d0-%d3, -(%sp)
                       507 
                       508 
000700 3639 00FF       509 	move.w URX1, %d3
       F904            509 
000706 1403            510 	move.b %d3, %d2
000708 0C43 2000       511 	cmp.w #0x2000, %d3
00070c 6400 0086       512 	bcc INTERGET
                       513 
                       514 
000710 3039 00FF       515 	move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            515 
000716 7200            516 	move.l #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
000718 0C40 8000       517 	cmp.w #0x8000,%d0
00071c 6400 0034       518 	bcc INTERPUT
                       519 
                       520 		
                       521 		
                       522 
000720 4CDF 000F       523 	movem.l (%sp)+, %d0-%d3
000724 4E73            524 	rte
                       525 
                       526 
                       527 
                       528 
                       529 ************************************************************
                       530 ** „Çø„Ç§„Éû„ÉºÂâ≤„ÇäËæº„Åø„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
                       531 ************************************************************
                       532 
                       533 timer1_interrupt:
000726 13FC 0033       534 	move.b  #'3', LED5      /*ÊñáÂ≠ó‚Äô3‚Äô„ÇíLED„ÅÆ6Ê°ÅÁõÆ„Å´Ë°®Á§∫*/
       00D0 002B       534 
00072e 48E7 0800       535 	movem.l %d4, -(%sp)
                       536 
                       537 /* ‰ª•‰∏ã‰øÆÊ≠£ÈÉ®ÂàÜ */
000732 3839 00FF       538 	move.w TSTAT1, %d4
       F60A            538 
000738 0C44 0001       539 	cmpi.w #0x01, %d4 /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„ÅãÊØîËºÉ */
00073c 6600 000E       540 	bne timer1_end /* 1.Á¨¨0„Éì„ÉÉ„Éà„Åå0„Å™„Çâ„ÄÅrte„ÅßÂæ©Â∏∞ */
000740 5344            541 	sub.w #0x01, %d4 /* 2.Á¨¨0„Éì„ÉÉ„Éà„Çí0„ÇØ„É™„Ç¢ */
000742 33C4 00FF       542 	move.w %d4, TSTAT1
       F60A            542 
000748 4EBA FE12       543 	jsr CALL_RP
                       544 /* ‰ª•‰∏ä‰øÆÊ≠£ÈÉ®ÂàÜ */
                       545 
                       546 timer1_end:
                       547 	*move.w %d3, %SR
00074c 4CDF 0010       548 	movem.l (%sp)+, %d4
000750 4E73            549 	rte
                       550 
                       551 
                       552 
                       553 
                       554 **************************************************************
                       555 ** INTERPUT
                       556 ** ÂºïÊï∞
                       557 ** D1 : „ÉÅ„É£„Éç„É´„ÅÆÈÅ∏Êäû
                       558 ** Êàª„ÇäÂÄ§
                       559 **     „Å™„Åó
                       560 **************************************************************
                       561 
                       562 INTERPUT:
000752 48E7 E000       563 	movem.l %d0-%d2, -(%sp)
                       564 
000756 46FC 2700       565 	move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       566 	
00075a 0C81 0000       567 	cmp.l #0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
       0000            567 
                       568 
000760 6600 001C       569 	bne INTERPUT_END
                       570 
000764 7001            571 	move.l #1, %d0
                       572 	*move.w #0x0800+'a', UTX1
000766 4EB9 0000       573 	jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            573 
                       574 
00076c 0C40 0000       575 	cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
000770 6700 0016       576 	beq INTERPUT_MASK
                       577 	*move.b %d1, %d2
000774 0641 0800       578 	addi.w #0x0800, %d1
                       579 	*move.w #0x0800+'f', UTX1
000778 33C1 00FF       580 	move.w %d1, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            580 
                       581 
                       582 INTERPUT_END:
                       583 	*move.w #0x0800+'c', UTX1
00077e 4CDF 0007       584 	movem.l (%sp)+, %d0-%d2
000782 4CDF 000F       585 	movem.l (%sp)+, %d0-%d3
000786 4E73            586 	rte
                       587 
                       588 INTERPUT_MASK:
                       589 	*move.w #0x0800+'b', UTX1
000788 33FC E108       590 	move.w #0xe108, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       590 
000790 6000 FFEC       591 	bra INTERPUT_END
                       592 
                       593 
                       594 *******************************
                       595 **INTERGET
                       596 **d1:„ÉÅ„É£„Éç„É´
                       597 **d2:Âèó‰ø°„Éá„Éº„Çø
                       598 *******************************
                       599 INTERGET:
                       600 	
000794 48E7 FFFE       601 	movem.l %a0-%a6/%d0-%d7, -(%SP)
                       602 
000798 0C81 0000       603 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            603 
                       604 	
00079e 6600 012A       605 	bne INTERGET_END
                       606 
0007a2 7000            607 	move.l #0, %d0		/*„Ç≠„É•„ÉºÁï™Âè∑„ÇíË®≠ÂÆö*/
                       608 
0007a4 1202            609 	move.b %d2,%d1		/*„Ç≠„É•„Éº„Å´ÂÖ•„Çå„Çã„Éá„Éº„Çø„Çíd1„Å´Ê†ºÁ¥ç*/
                       610 
                       611 	
                       612 /* TYPE GAME VERSION ========================================== */    
                       613 TYPE_GAME_CHAR_CHECK:
                       614     	
                       615 	
0007a6 43F9 0000       616 	lea.l COUNT_SIZE, %a1
       0000            616 
0007ac 2A11            617 	move.l (%a1), %d5
                       618  	
                       619 
                       620 
                       621     	/* ÂÖ•Âäõ„ÅåÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅãÁ¢∫Ë™ç*/
                       622 	*cmp.l   #SIZE_hello, %d5
0007ae BAB9 0000       623 	cmp.l	(TXT_SIZE), %d5
       0000            623 
                       624   	*beq INTERGET_END
0007b4 6700 0110       625 	beq END
                       626 
                       627     	/* ÂèÇÁÖß„Åô„Åπ„ÅçÊñáÂ≠óÂàó„ÇíÁî®ÊÑè„Åô„Çã*/
                       628 
0007b8 2279 0000       629    	move.l (TXT_P), %a1
       0000            629 
                       630 	
0007be D3C5            631 	adda.l %d5, %a1
                       632 		
0007c0 1C11            633 	move.b (%a1), %d6
                       634 	 
                       635     	  
                       636 	/* ‰∏ÄËá¥„Åó„Å™„Åë„Çå„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
0007c2 B206            637    	cmp.b  %d6, %d1
0007c4 6600 00E0       638    	bne FAULT
                       639 	
                       640     	/* ÊñáÂ≠ó„ÇíÂá∫Âäõ„Åó„Ç´„Ç¶„É≥„Éà„Çí„Ç§„É≥„ÇØ„É™„É°„É≥„Éà„Åô„Çã */
                       641 	
0007c8 4EB9 0000       642    	jsr INQ
       0000            642 
0007ce 0685 0000       643    	addi.l #1, %d5
       0001            643 
0007d4 23C5 0000       644    	move.l %d5, (COUNT_SIZE)
       0000            644 
                       645 	
                       646 	
                       647 	/* ÂÖ•ÂäõÊàêÂäüË°®Á§∫*/
0007da 6000 00E4       648 	bra SUCCESS
                       649 
                       650 
                       651 ****************
                       652 ** LED
                       653 ****************
                       654 	
                       655 LED_SET:
0007de 1C3C 0030       656 	move.b #'0', %d6
0007e2 1E3C 0030       657 	move.b #'0', %d7
                       658 
                       659 LED_LOOP:
                       660 	
0007e6 0606 0001       661 	addi.b #0x01, %d6
0007ea 0C06 003A       662 	cmpi.b #':', %d6
0007ee 6700 0006       663 	beq LED_CARRY
0007f2 6000 000A       664 	bra LED_LOOP_END
                       665 	
                       666 LED_CARRY:
0007f6 1C3C 0030       667 	move.b #'0', %d6
0007fa 0607 0001       668 	addi.b #0x01, %d7
                       669 
                       670 LED_LOOP_END:
0007fe 5385            671 	subq.l #1, %d5
000800 6700 0006       672 	beq LED_UPDATE
000804 6000 FFE0       673 	bra LED_LOOP
                       674 
                       675 
                       676 LED_UPDATE:
                       677 
000808 0C84 0000       678 	cmpi.l #0x01, %d4
       0001            678 
00080e 6700 0012       679 	beq LED_UPDATE_FAULT_NUMBER
000812 13C6 00D0       680 	move.b %d6, LED0
       0039            680 
000818 13C7 00D0       681 	move.b %d7, LED1
       003B            681 
00081e 6000 0036       682 	bra LED_GOOD
                       683 
                       684 LED_UPDATE_FAULT_NUMBER:
000822 13C6 00D0       685 	move.b %d6, LED2
       003D            685 
000828 13C7 00D0       686 	move.b %d7, LED3
       003F            686 
00082e 6000 0002       687 	bra LED_BAD
                       688 
                       689 
                       690 LED_BAD:
000832 13FC 0042       691 	move.b #'B', LED7
       00D0 002F       691 
00083a 13FC 0041       692 	move.b #'A', LED6
       00D0 002D       692 
000842 13FC 0044       693 	move.b #'D', LED5
       00D0 002B       693 
00084a 13FC 0020       694 	move.b #' ', LED4
       00D0 0029       694 
000852 6000 0076       695 	bra INTERGET_END
                       696 	
                       697 LED_GOOD:
000856 13FC 0047       698 	move.b #'G', LED7
       00D0 002F       698 
00085e 13FC 004F       699 	move.b #'O', LED6
       00D0 002D       699 
000866 13FC 004F       700 	move.b #'O', LED5
       00D0 002B       700 
00086e 13FC 0044       701 	move.b #'D', LED4
       00D0 0029       701 
000876 6000 0052       702 	bra INTERGET_END
                       703 
                       704 
                       705 LED_END:
00087a 13FC 0045       706 	move.b #'E', LED7
       00D0 002F       706 
000882 13FC 004E       707 	move.b #'N', LED6
       00D0 002D       707 
00088a 13FC 0044       708 	move.b #'D', LED5
       00D0 002B       708 
000892 13FC 0021       709 	move.b #'!', LED4
       00D0 0029       709 
                       710 
                       711 	/* FLG UP */
00089a 13FC 0001       712 	move.b #0x01, (END_FLG)
       0000 0000       712 
0008a2 6000 0026       713 	bra INTERGET_END
                       714 
                       715 
                       716 ****************
                       717 ** typing data
                       718 ****************
                       719 FAULT:
0008a6 43F9 0000       720 	lea.l COUNT_FAULT, %a1
       0000            720 
0008ac 2A11            721 	move.l (%a1), %d5
                       722 
0008ae 0685 0000       723 	addi.l #1, %d5
       0001            723 
0008b4 23C5 0000       724    	move.l %d5, (COUNT_FAULT)
       0000            724 
                       725 
                       726 
                       727 	/* Â§±ÊïóÂõûÊï∞„ÇíË®òÈå≤„Åô„Çã*/
0008ba 7801            728 	move.l #0x01 , %d4
0008bc 6000 FF20       729 	bra LED_SET
                       730 
                       731 SUCCESS:	
0008c0 7800            732 	move.l #0x00 , %d4
0008c2 6000 FF1A       733 	bra LED_SET
                       734 
                       735 END:
0008c6 6000 FFB2       736 	bra LED_END	
                       737 /* TYPE GAME VERSION ========================================== */   
                       738 
                       739 INTERGET_END:
0008ca 4CDF 7FFF       740 	movem.l (%SP)+, %a0-%a6/%d0-%d7
0008ce 4CDF 000F       741 	movem.l (%sp)+, %d0-%d3
                       742 	
0008d2 4E73            743 	rte
                       744 
                       745 
                       746 
                       747 *************************************************************
                       748 **PUTSTRING
                       749 **ÂÖ•Âäõ
                       750 **d1:„ÉÅ„É£„Éç„É´
                       751 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       752 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       753 **Êàª„ÇäÂÄ§
                       754 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       755 *************************************************************
                       756 PUTSTRING:
0008d4 48E7 7FFE       757 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       758 
0008d8 0C81 0000       759 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            759 
                       760 	
0008de 6600 003C       761 	bne PUTSTRING_END
                       762 	
0008e2 7800            763 	move.l #0,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       764 
0008e4 2242            765 	move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ*/
                       766 
0008e6 0C83 0000       767 	cmp.l #0,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            767 
                       768 
0008ec 6700 002E       769 	beq PUTSTRING_END
                       770 
                       771 LOOP_STEP5:
0008f0 B684            772 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       773 
0008f2 6700 001C       774 	beq PUTSTRING_MASK
                       775 
0008f6 7001            776 	move.l #1,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       777 
0008f8 1219            778 	move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       779 
0008fa 4EB9 0000       780 	jsr INQ
       0000            780 
                       781 
000900 0C80 0000       782 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            782 
                       783 
000906 6700 0008       784 	beq PUTSTRING_MASK
                       785 
                       786 
00090a 5244            787 	addq #1,%d4		/*sz++*/
                       788 
00090c 6000 FFE2       789 	bra LOOP_STEP5
                       790 
                       791 PUTSTRING_MASK:
000910 33FC E10C       792 	move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       792 
                       793 
000918 6000 0002       794 	bra PUTSTRING_END
                       795 
                       796 PUTSTRING_END:
00091c 2004            797 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       798 	
00091e 4CDF 7FFE       799 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       800 
000922 4E75            801 	rts 			/*?*/
                       802 
                       803 
                       804 *************************************************************
                       805 **GETSTRING
                       806 **ÂÖ•Âäõ
                       807 **d1:„ÉÅ„É£„Éç„É´
                       808 **d2:„Éá„Éº„ÇøÊõ∏„ÅçËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       809 **d3:Âèñ„ÇäÂá∫„Åô„Éá„Éº„Çø„ÅÆÊï∞
                       810 **Êàª„ÇäÂÄ§
                       811 **d0:ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„ÅÆÊï∞
                       812 *************************************************************
                       813 GETSTRING:
                       814 	*move.w #0x0800+'c', UTX1
000924 48E7 7FFE       815 	movem.l %a0-%a6/%d1-%d7, -(%SP)
                       816 
000928 0C81 0000       817 	cmp.l #0, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
       0000            817 
                       818 	
00092e 6600 0026       819 	bne GETSTRING_END
                       820 
000932 7800            821 	move.l #0,%d4 		/*%d4=sz:Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       822 
000934 2242            823 	move.l %d2,%a1 		/*%a1:„Éá„Éº„Çø„ÅÆÊõ∏„ÅçËæº„Åø„Ç¢„Éâ„É¨„Çπ*/
                       824 
                       825 LOOP_STEP6:
000936 B684            826 	cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
                       827 
000938 6700 001C       828 	beq GETSTRING_END
                       829 	
00093c 7000            830 	move.l #0,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       831 	
00093e 4EB9 0000       832 	jsr OUTQ
       0000            832 
                       833 	
000944 0C80 0000       834 	cmp.l #0,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            834 
                       835 
00094a 6700 000A       836 	beq GETSTRING_END
                       837 
00094e 12C1            838 	move.b %d1,(%a1)+	/*Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø„Çí„Ç≥„Éî„Éº*/
                       839 
000950 5244            840 	addq #1,%d4		/*sz++*/
                       841 
000952 6000 FFE2       842 	bra LOOP_STEP6
                       843 
                       844 GETSTRING_END:
000956 2004            845 	move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       846 
000958 4CDF 7FFE       847 	movem.l (%SP)+, %a0-%a6/%d1-%d7
                       848 
00095c 4E75            849 	rts
                       850 
                       851 
                       852 ***************************************************************************************************
                       853 ***      QUEUE SETTING
                       854 ***************************************************************************************************
                       855 
                       856 .section .data
                       857 .equ TOP, 0
                       858 .equ BOTTOM, 4
                       859 .equ IN, 8
                       860 .equ OUT, 12
                       861 .equ S, 16
                       862 .equ DATA_TOP, 18
                       863 .equ DATA_LEN, 256
                       864 .equ QUEUE_SIZE, DATA_TOP + DATA_LEN /* 18 + 256 = 274 */
                       865 
000960 0000 0000       866 QUEUE_TOP: ds.b QUEUE_SIZE * 2
       0000 0000       866 
       0000 0000       866 
       0000 0000       866 
       0000 0000       866 
                       867 
                       868 /* ÂàùÊúüÂåñ */
                       869 ********************
                       870 * ÂàùÊúüÂåñ
                       871 ********************
                       872 
                       873 Init_Q:
000b84 48E7 C0E0       874     movem.l %d0-%d1/%a0-%a2, -(%sp) /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÈÄÄÈÅø */
                       875 
000b88 7000            876     move.l #0, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑ = 0 */
                       877 
                       878 Init_Q_sub:
000b8a 41FA FDD4       879     lea.l QUEUE_TOP, %a0 /* „Ç≠„É•„Éº„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000b8e 2200            880     move.l %d0, %d1
000b90 C2F8 0112       881     mulu.w QUEUE_SIZE, %d1 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000b94 D1C1            882     add.l %d1, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000b96 43E8 0012       883     lea.l DATA_TOP(%a0), %a1 /* a1 = „Ç≠„É•„Éºn„ÅÆ„Éá„Éº„ÇøÈ†òÂüüÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = DATA_TOP + a0
000b9a 2089            884     move.l %a1, TOP(%a0) /* „Ç≠„É•„Éºn„ÅÆTOP„ÅÆ„Ç¢„Éâ„É¨„Çπ = a0 + TOP „Åß„ÅÇ„Çã„ÅÆ„Åß„Åù„Åì„Å´a1„Ç
000b9c 2149 0008       885     move.l %a1, IN(%a0) /* „Ç≠„É•„Éºn„ÅÆIN„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000ba0 2149 000C       886     move.l %a1, OUT(%a0) /* „Ç≠„É•„Éºn„ÅÆOUT„ÅÆ„Ç¢„Éâ„É¨„Çπ„Å´a1„ÇíÊ†ºÁ¥ç */
000ba4 43E8 0111       887     lea.l QUEUE_SIZE-1(%a0), %a1 /* a1 == BOTTOM = „Ç≠„É•„Éºn„ÅÆÁµÇÁ´Ø„Ç¢„Éâ„É¨„Çπ */
000ba8 2149 0004       888     move.l %a1,BOTTOM(%a0)/*„Ç≠„É•„Éºn„ÅÆBOTTOM„Å´a1„ÇíÊ†ºÁ¥ç*/
000bac 317C 0000       889     move.w #0, S(%a0) /* „Éá„Éº„ÇøÊï∞ = 0 */
       0010            889 
000bb2 5280            890     addq.l #1, %d0 /* „Ç≠„É•„ÉºÁï™Âè∑++ */
000bb4 0C80 0000       891     cmpi.l #2, %d0 /* „Ç≠„É•„Éº„ÅÆÂÄãÊï∞ÂàÜ(2)„É´„Éº„Éó */
       0002            891 
000bba 6600 FFCE       892     bne Init_Q_sub
                       893 
000bbe 4CDF 0703       894     movem.l (%sp)+, %d0-%d1/%a0-%a2 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
000bc2 4E75            895     rts
                       896 
                       897 
                       898 *****************
                       899 ** INQ
                       900 *****************
                       901 
                       902 **************************************
                       903 **ÂÖ•Âäõ
                       904 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû [long]
                       905 **  d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø [long]
                       906 **Âá∫Âäõ
                       907 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       908 **************************************
                       909 INQ:
                       910 
                       911     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
000bc4 40E7            912     move.w %SR, -(%sp)
                       913 
                       914     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000bc6 46FC 2700       915     move.w #0x2700, %SR
                       916 
000bca 48E7 00C0       917     movem.l %a0-%a1, -(%sp)
000bce 41FA FD90       918     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000bd2 C0F8 0112       919     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000bd6 D1C0            920     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       921 
000bd8 0C68 0100       922     cmpi.w #256, S(%a0)
       0010            922 
000bde 6600 0008       923     bne INQ_1
                       924 
                       925     /* S == 256„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000be2 7000            926     move.l #0, %d0
000be4 6000 0024       927     bra INQ_END
                       928 
                       929 INQ_1:
000be8 2268 0008       930     movea.l IN(%a0), %a1 /* a1 = in */
000bec 1281            931     move.b %d1, (%a1) /* q[in] = d1 */ 
                       932 
000bee B3E8 0004       933     cmpa.l BOTTOM(%a0), %a1 /* in == bottom „Åã„ÇíÂà§ÂÆö */
000bf2 6600 000A       934     bne INQ_ELSE
                       935 
                       936     /* in == bottom „ÅÆ„Å®„Åç*/
000bf6 2150 0008       937     move.l TOP(%a0), IN(%a0) /* in = top */
000bfa 6000 0008       938     bra INQ_2
                       939 
                       940 /* in != bottom „ÅÆ„Å®„Åç*/
                       941 INQ_ELSE:
000bfe 5289            942     addq.l #1, %a1 /* a1++ */
000c00 2149 0008       943     move.l %a1, IN(%a0) /* in = a1 */
                       944 
                       945 /* s++, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       946 INQ_2:
000c04 5268 0010       947     addq.w #1, S(%a0)
000c08 7001            948     move.l #1, %d0
                       949 
                       950 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       951 INQ_END:
000c0a 4CDF 0300       952     movem.l (%sp)+, %a0-%a1 
000c0e 46DF            953     move.w (%sp)+, %SR
000c10 4E75            954     rts
                       955 
                       956 
                       957 *****************
                       958 * OUTQ
                       959 *****************
                       960 
                       961 **********************************************
                       962 **ÂÖ•Âäõ
                       963 **  d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû  [long]
                       964 
                       965 **Âá∫Âäõ
                       966 **  d0:ÊàêÂäü(1)orÂ§±Êïó(0) [long]
                       967 **  d1:Âèñ„ÇäÁµÑ„Çì„Å†„Éá„Éº„Çø [byte]
                       968 **********************************************
                       969 OUTQ:
                       970     /* ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø */
000c12 40E7            971     move.w %SR, -(%sp)
                       972 
                       973     /* Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢ */
000c14 46FC 2700       974     move.w #0x2700, %SR
                       975 
000c18 48E7 00C0       976     movem.l %a0-%a1, -(%sp)
000c1c 41FA FD42       977     lea.l QUEUE_TOP, %a0 /* a0 = „Ç≠„É•„Éº0„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
000c20 C0F8 0112       978     mulu.w QUEUE_SIZE, %d0 /* „Ç≠„É•„Éºn„ÅÆÁõ∏ÂØæÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ = n * („Ç≠„É•„Éº„Çµ„Ç§„Ç∫) */
000c24 D1C0            979     add.l %d0, %a0 /* a0 = „Ç≠„É•„Éºn„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ */
                       980 
000c26 0C68 0000       981     cmpi.w #0, S(%a0)
       0010            981 
000c2c 6600 0008       982     bne OUTQ_1
                       983 
                       984     /* S == 0„ÅÆ„Å®„Åçd0 = 0(Â§±Êïó) „Å®„Åó„Å¶END„Å∏ */
000c30 7000            985     move.l #0, %d0
000c32 6000 0024       986     bra OUTQ_END
                       987 
                       988 OUTQ_1:
000c36 2268 000C       989     movea.l OUT(%a0), %a1 /* a1 = out */
000c3a 1211            990     move.b (%a1), %d1 /* d1 = q[out] */
                       991 
000c3c B3E8 0004       992     cmpa.l BOTTOM(%a0), %a1 /* out == bottom „Åã„ÇíÂà§ÂÆö */
000c40 6600 000A       993     bne OUTQ_ELSE
                       994 
                       995     /* out == bottom „ÅÆ„Å®„Åç*/
000c44 2150 000C       996     move.l TOP(%a0), OUT(%a0) /* out = top */
000c48 6000 0008       997     bra OUTQ_2
                       998 
                       999 /* out != bottom „ÅÆ„Å®„Åç*/
                       1000 OUTQ_ELSE:
000c4c 5289            1001     addq.l #1, %a1 /* a1++ */
000c4e 2149 000C       1002     move.l %a1, OUT(%a0) /* out = a1 */
                       1003 
                       1004 /* s--, d0 = 1(ÊàêÂäü) „Å®„Åó„Å¶END„Å∏ */
                       1005 OUTQ_2:
000c52 5368 0010       1006     subq.w #1, S(%a0)
000c56 7001            1007     move.l #1, %d0
                       1008 
                       1009 /* ‰ΩøÁî®„É¨„Ç∏„Çπ„Çø„ÅÆÂæ©Â∏∞ */
                       1010 OUTQ_END:
000c58 4CDF 0300       1011     movem.l (%sp)+, %a0-%a1 
000c5c 46DF            1012     move.w (%sp)+, %SR
000c5e 4E75            1013     rts
                       1014 
                       1015 
                       1016 ***** 
                       1017 
                       1018 
                       1019 
                       1020 ******************************************************
                       1021 *** ÂàùÊúüÂåñ„ÅÆ„ÅÇ„Çã„Éá„Éº„ÇøÈ†òÂüü
                       1022 ******************************************************
                       1023 
                       1024 .section .data
                       1025 TMSG:
000c60 2A2A 2A2A       1026 	.ascii	"******\r\n"			/*r:Ë°åÈ†≠„Å∏,n:ÊîπË°å*/
       2A2A 0D0A       1026 
                       1027 .even
                       1028 TTC:
000c68 0000            1029 	.dc.w 0
                       1030 	.even
                       1031 
                       1032 ********************************
                       1033 ** preparation to typing game
                       1034 ********************************
                       1035 NEW_LINE:
                       1036     /* size : 2 */
000c6a 0D0A            1037     .ascii "\r\n"
                       1038 INTRO:
                       1039     /* size : 28*/
000c6c 506C 6561       1040     .ascii "Please type this sentence!\r\n"
       7365 2074       1040 
       7970 6520       1040 
       7468 6973       1040 
       2073 656E       1040 
                       1041 TXT_hello:
                       1042     /* size : 11*/
000c88 6865 6C6C       1043     .ascii "hello world"
       6F20 776F       1043 
       726C 64         1043 
                       1044 
                       1045 .equ SIZE_hello, 11
                       1046 
                       1047 TXT_univ:
000c93 4B79 7573       1048     .ascii "Kyushu university, Ito campus"
       6875 2075       1048 
       6E69 7665       1048 
       7273 6974       1048 
       792C 2049       1048 
                       1049 
                       1050 .equ SIZE_univ, 29
                       1051 
                       1052 ***********
                       1053 ** ANSI
                       1054 ************
                       1055 CODE_DEF:
000cb0 655B 306D       1056 	.ascii "\e[0m"
                       1057 CODE_I:
000cb4 655B 326D       1058 	.ascii "\e[2m"
                       1059 
                       1060 ******************************************************
                       1061 *** ÂàùÊúüÂåñ„ÅÆ„Å™„ÅÑ„Éá„Éº„ÇøÈ†òÂüü
                       1062 ******************************************************
                       1063 .section .bss
                       1064 
                       1065 /* type game ------------------------------ */
                       1066 COUNT_FAULT:
004db8 0000 0000       1067 	.ds.l 0x01
                       1068 COUNT_SIZE:
004dbc 0000 0000       1069     .ds.l 0x01
                       1070 TXT_P:
004dc0 0000 0000       1071 	.ds.l 0x01
                       1072 TXT_SIZE:
004dc4 0000 0000       1073 	.ds.l 0x01
                       1074 END_FLG:
004dc8 00              1075 	.ds.b 0x01
                       1076 
                       1077 /* ------------------------------------- */
                       1078 task_p:
004dc9 0000 0000       1079 	.ds.l	0x01
004dcd 00              1080 	.even
                       1081 
                       1082 BUF:
004dce 0000 0000       1083 	.ds.b 256				/*BUF[256]*/
       0000 0000       1083 
       0000 0000       1083 
       0000 0000       1083 
       0000 0000       1083 
                       1084 	.even
                       1085 
                       1086 
                       1087 
                       1088 USR_STK:
004ece 0000 0000       1089 	.ds.b 0x4000				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü*/
       0000 0000       1089 
       0000 0000       1089 
       0000 0000       1089 
       0000 0000       1089 
                       1090 	.even
                       1091 
                       1092 USR_STK_TOP:				/*„É¶„Éº„Ç∂„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ*/
                       1093 
                       1094 
                       1095 
