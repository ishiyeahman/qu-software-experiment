                         4 .list
                         5 		***************************************************************
                         6 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 		***************************************************************
                         8 
                         9 		***************
                        10 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        11 		***************
                        12 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        13 		.equ IOBASE,    0x00d00000
                        14 
                        15 		***************
                        16 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        17 		***************
                        18 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        19 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        20 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        21 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        22 
                        23 		***************
                        24 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        25 		***************
                        26 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        27 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        28 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        29 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        30 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        31 
                        32 		***************
                        33 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        34 		***************
                        35 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        36 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        37 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        38 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        39 
                        40 		***************
                        41 		** LED
                        42 		***************
                        43 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        44 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        45 		.equ LED5,      IOBASE+0x000002b
                        46 		.equ LED4,      IOBASE+0x0000029
                        47 		.equ LED3,      IOBASE+0x000003f
                        48 		.equ LED2,      IOBASE+0x000003d
                        49 		.equ LED1,      IOBASE+0x000003b
                        50 		.equ LED0,      IOBASE+0x0000039
                        51 
                        52 		***************************************************************
                        53 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        54 		***************************************************************
                        55 		.section .bss
                        56 		.even
                        57 SYS_STK:
000ff4 0000 0000        58 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
                        59 		.even
                        60 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        61 
                        62 		***************************************************************
                        63 		** ÂàùÊúüÂåñ
                        64 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        65 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        66 		***************************************************************
                        67 
                        68 
                        69 .section .data
000588 3031 3233        70 	TDATA1: .ascii "0123456789ABCDEF"
       3435 3637        70 
       3839 4142        70 
       4344 4546        70 
000598 2D2D 2D2D        71 	TDATA3: .ascii "----------------"
       2D2D 2D2D        71 
       2D2D 2D2D        71 
       2D2D 2D2D        71 
0005a8 6B6C 6D6E        72 	TDATA2: .ascii "klmnopqrstuvwxyz"
       6F70 7172        72 
       7374 7576        72 
       7778 797A        72 
                        73 
                        74 
                        75 		
                        76 
                        77 .section .text
                        78 		.even
                        79 boot:
                        80 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        81 		move.w #0x2700,%SR
000404 4FF9 0000        82 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             82 
                        83 
                        84 		****************
                        85 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        86 		****************
00040a 13FC 0040        87 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        87 
000412 23FC 00FF        88 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        88 
       F304             88 
                        89 
                        90 		****************
                        91 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        92 		****************
00041c 33FC 0000        93 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        93 
000424 33FC E100        94 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        94 
00042c 33FC 0038        95 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        95 
                        96 
                        97 		****************
                        98 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        99 		*****************
000434 33FC 0004       100 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600       100 
                       101 
                       102 		***************************************************************
                       103 		** STEP2„ÅÆÂá¶ÁêÜ
                       104 		***************************************************************
                       105 		/* ÂàùÊúüÂåñÂá¶ÁêÜ„Çí„É°„Ç§„É≥„É´„Éº„ÉÅ„É≥„Åã„Çâ„Åì„Å°„Çâ„Å∏ÁßªÂãï */
                       106 		*lea.l uart1_interrupt, %a0
                       107 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 21FC 0000       108 		move.l #uart1_interrupt, 0x110
       0000 0110       108 
                       109 		
000444 33FC E100       110 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ
       00FF F900       110 
00044c 23FC 00FF       111 		move.l #0x00ff3ffb,IMR  |UART1Ë®±ÂèØ
       3FFB 00FF       111 
       F304            111 
000456 46FC 2700       112 		move.w #0x2700, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´7 */
                       113 		
                       114 
00045a 6000 0002       115 		bra MAIN
                       116 
                       117 		***************************************************************
                       118 		** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                       119 		** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       120 		***************************************************************
                       121 		.section .text
                       122 		.even
                       123 
                       124 
                       125 
                       126 
                       127 	
                       128 MAIN:
00045e 4EB9 0000       129 		jsr Init_Q
       0000            129 
                       130 		*move.b #'1', LED7
000464 33FC E108       131 		move.w #0xe108,USTCNT1
       00FF F900       131 
00046c 46FC 2000       132 		move.w #0x2000, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´0 */
                       133 
                       134 
                       135 PS_TEST1:
                       136 		/* jsr PUTSTRING(0, #TDATA1, 16)*/
000470 123C 0000       137 		move.b	#0x00, %d1
000474 243C 0000       138 		move.l	#TDATA1, %d2
       0000            138 
00047a 7610            139 		move.l	#0x10, %d3
00047c 4EBA 00B6       140 		jsr PUTSTRING
                       141 	
                       142 		*move.b #'2', LED6
000480 283C 000F       143 		move.l	#0x0fffff, %d4
       FFFF            143 
                       144 	
                       145 		
                       146 LOOP:
000486 5384            147 		subq.l #1,%d4
000488 6700 0006       148 		beq PS_TEST2
                       149 		*move.b #'5', LED3
                       150 		
00048c 6000 FFF8       151 		bra LOOP
                       152 
                       153 PS_TEST2:
                       154 		*move.b #'6', LED2
000490 123C 0000       155 		move.b	#0x00, %d1
000494 243C 0000       156 		move.l	#TDATA2, %d2
       0000            156 
00049a 7610            157 		move.l	#0x10, %d3
00049c 4EBA 0096       158 		jsr PUTSTRING
0004a0 6000 FFEE       159 		bra PS_TEST2
                       160 
                       161 /*‰ª•‰∏ã„ÉÜ„Çπ„Éà*/
                       162 TEST_READY:
                       163 		*movem.l %d1-%d5, -(%sp)
                       164 	
0004a4 383C 0010       165 		move.w #16, %d4
0004a8 3A3C 0010       166 		move.w #16, %d5
0004ac 123C 0061       167 		move.b #0x61, %d1
0004b0 6000 0008       168 		bra TEST_LOOP
                       169 
                       170 TEST_LOOP2:
                       171 
0004b4 5241            172 		addq #1, %d1
0004b6 383C 0010       173 		move.w #16, %d4
                       174 
                       175 TEST_LOOP:
0004ba 7001            176 		moveq #1, %d0
                       177 		*move.w #0x1000, %d0
0004bc 4EB9 0000       178 		jsr INQ
       0000            178 
                       179 		*jsr OUTQ
0004c2 5344            180 		subq #1, %d4
0004c4 6600 FFF4       181 		bne TEST_LOOP
0004c8 5345            182 		subq #1, %d5
0004ca 6700 0006       183 		beq TEST_END
0004ce 6000 FFE4       184 		bra TEST_LOOP2
                       185 
                       186 TEST_END:
                       187 		*movem.l (%sp)+, %d1-%d5
0004d2 4E75            188 		rts
                       189 /*‰ª•‰∏ä„ÉÜ„Çπ„Éà*/
                       190 
                       191 uart1_interrupt:
                       192 		*move.b #'3', LED5
0004d4 48E7 8000       193 		movem.l %d0, -(%sp)
                       194 
                       195 		*move.b #'a', %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       196 		*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
                       197 		*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ */
                       198 
                       199 
0004d8 3039 00FF       200 		move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            200 
                       201 		
0004de 123C 0000       202 		move.b #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
                       203 
0004e2 0C40 8000       204 		cmp #0x8000,%d0
0004e6 6400 0008       205 		bcc INTERPUT
                       206 
0004ea 4CDF 0001       207 		movem.l (%sp)+, %d0
                       208 		
0004ee 4E73            209 		rte
                       210 
                       211 
                       212 INTERPUT:
0004f0 48E7 E000       213 		movem.l %d0-%d2, -(%sp)
                       214 
0004f4 46FC 2700       215 		move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       216 
0004f8 0C01 0000       217 		cmp.b #0x0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
                       218 
0004fc 6600 0020       219 		bne INTERPUT_END
                       220 
000500 103C 0001       221 		move.b #1, %d0
                       222 
000504 4EB9 0000       223 		jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            223 
                       224 
00050a 0C40 0000       225 		cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
                       226 
00050e 6700 0018       227 		beq INTERPUT_MASK
                       228 
000512 1401            229 		move.b %d1, %d2
                       230 
000514 0642 0800       231 		addi.w #0x0800, %d2
                       232 
                       233 
000518 33C2 00FF       234 		move.w %d2, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            234 
                       235 
                       236 
                       237 INTERPUT_END:
00051e 4CDF 0007       238 		movem.l (%sp)+, %d0-%d2
                       239 
000522 4CDF 0001       240 		movem.l (%sp)+, %d0
                       241 
000526 4E73            242 		rte
                       243 
                       244 INTERPUT_MASK:
000528 33FC E100       245 		move.w #0xe100, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       245 
                       246 		/* ‚Üë ‰ΩïÊïÖ„Åã„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„Åï„Çå„Å¶„ÅÑ„Åü„ÅÆ„Åß„ÄÅ‰øÆÊ≠£ */
                       247 
000530 6000 FFEC       248 		bra INTERPUT_END
                       249 
                       250 *************************************************************
                       251 **PUTSTRING
                       252 **ÂÖ•Âäõ
                       253 **d1:„ÉÅ„É£„Éç„É´
                       254 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       255 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       256 **Êàª„ÇäÂÄ§
                       257 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       258 *************************************************************
                       259 PUTSTRING:
000534 48E7 7EFE       260 		movem.l %a0-%a6/%d1-%d6, -(%SP)
                       261 
000538 0C01 0000       262 		cmp.b #0x00, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
00053c 6600 0042       263 		bne PUTSTRING_END
                       264 		/* rv: „Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅÆÊØîËºÉ„ÄÇÔºê„Åß„ÅØ„Å™„ÅÑ„Å®„Åç„Å´ÁµÇ‰∫Ü„Åô„Çã*/
                       265 
000540 7800            266 		move.l #0x0000,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       267 		/* rv: „Éá„Éº„ÇøÊï∞(sz)„ÅÆÂàùÊúüÂåñ*/
                       268 
000542 2242            269 		move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ/
                       270 		/* rv: Ë™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Çía1„Å´Ê†ºÁ¥ç„Åô„Çã*/	
                       271 
000544 0C83 0000       272 		cmp.l #0x0000,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
       0000            272 
00054a 6700 0034       273 		beq PUTSTRING_END
                       274 		/* rv: d3(size)„Åå0„Å™„Çâ„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
                       275 
                       276 
                       277 LOOP_STEP5:
00054e B684            278 		cmp.l %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
000550 6700 0022       279 		beq PUTSTRING_MASK
                       280 		/* d3 „Å® d4 size = sz „Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï*/
                       281 
000554 103C 0001       282 		move.b #0x01,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
                       283 		/* rv:  INQ„Åå„Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅßÊØîËºÉ„Åô„Çã„ÅÆ„ÅßÔΩÇ„Å´Ë®≠ÂÆö*/
000558 1219            284 		move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       285 		/* rv: ÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Åã„ÇâÈ†Ü„Å´Ê†ºÁ¥ç„Åô„Çã*/
                       286 
00055a 4EB9 0000       287 		jsr INQ
       0000            287 
                       288 
000560 0C40 0000       289 		cmp.w #0x00,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
000564 6700 000E       290 		beq PUTSTRING_MASK
                       291 		/*rv : Â§±Êïó„Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï„Åô„Çã*/
                       292 
000568 5284            293 		addq.l #0x01,%d4		/*sz++*/
00056a 23C4 0000       294 		move.l %d4, (0x9900)
       9900            294 
000570 6000 FFDC       295 		bra LOOP_STEP5
                       296 
                       297 PUTSTRING_MASK:
                       298 		*move.b #'7', LED1
                       299 
000574 33FC E10C       300 		move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       300 
00057c 6000 0002       301 		bra PUTSTRING_END
                       302 
                       303 PUTSTRING_END:
000580 2004            304 		move.l %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       305 
000582 4CDF 7F7E       306 		movem.l (%SP)+, %a0-%a6/%d1-%d6
                       307 
                       308 		*rte 			/*?*/
                       309 		/* bus errorÂá∫„Åü„ÅÆ„ÅßÂ§âÊõ¥„Åó„Åü*/
                       310 
                       311 		***
                       312 		*move.b #'4', LED4
                       313 		***
000586 4E75            314 		rts
                       315 
                       316 ******************************************************************************:
                       317 
                       318 ******
                       319 ******‰ª•ÈôçQUEUE
                       320 ******
                       321 
                       322 .section .data
                       323 .equ IN_COUNT, 257
                       324 .equ OUT_COUNT, 257
                       325 .equ queue_number, 1
                       326 .equ OFFSET_1, 0x100
                       327 .equ END_0, 0xff
                       328 .equ END_1, 0x1ff
0005b8 0000 0000       329 top: .ds.b 0x800
       0000 0000       329 
       0000 0000       329 
       0000 0000       329 
       0000 0000       329 
000db8 0000 0000       330 bottom: .ds.l 1
000dbc 0000 0000       331 in: .ds.l 1
000dc0 0000 0000       332 in_0: .ds.l 1
000dc4 0000 0000       333 in_1: .ds.l 1
000dc8 0000 0000       334 out: .ds.l 1
000dcc 0000 0000       335 out_0: .ds.l 1
000dd0 0000 0000       336 out_1: .ds.l 1
000dd4 0000 0000       337 s: .ds.l 1
000dd8 0000 0000       338 s0: .ds.l 1
000ddc 0000 0000       339 s1: .ds.l 1
000de0 0000 0000       340 START_LABEL: .ds.l 1
                       341 
                       342 /* ÂàùÊúüÂåñ*/
                       343 Init_Q:
000de4 48E7 003E       344 movem.l %a2-%a6, -(%sp) /* ÂøúÊÄ•Âá¶ÁΩÆ*/
000de8 45FA F7CE       345 lea.l top, %a2
000dec 23CA 0000       346 move.l %a2, in_0
       0000            346 
000df2 23CA 0000       347 move.l %a2, out_0
       0000            347 
000df8 47EA 0100       348 lea.l OFFSET_1(%a2), %a3
000dfc 23CB 0000       349 move.l %a3, in_1
       0000            349 
000e02 23CB 0000       350 move.l %a3, out_1
       0000            350 
000e08 49FA FFCA       351 lea.l s, %a4
000e0c 4BFA FFCA       352 lea.l s0, %a5
000e10 4DFA FFCA       353 lea.l s1, %a6
000e14 28BC 0000       354 move.l #0,(%a4)
       0000            354 
000e1a 2ABC 0000       355 move.l #0,(%a5)
       0000            355 
000e20 2CBC 0000       356 move.l #0,(%a6)
       0000            356 
000e26 4CDF 7C00       357 movem.l (%sp)+, %a2-%a6 /* ÂøúÊÄ•Âá¶ÁΩÆ*/
000e2a 4E75            358 rts
                       359 
                       360 *****************************************************************
                       361 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       362 **d1:Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø
                       363 **d1:Ëøî„ÇäÂÄ§„ÄÅÊàêÂäüorÂ§±Êïó
                       364 *****************************************************************
                       365 INQ:
000e2c 48E7 1000       366 movem.l %d3, -(%sp)
000e30 7600            367 move.l #0x0, %d3
000e32 40C3            368 move.w %SR, %d3
000e34 46FC 2700       369 move.w #0x2700, %SR
000e38 4EBA 000E       370 jsr SELECT_QUEUE
000e3c 4EBA 0094       371 jsr PUT_BUF
000e40 46C3            372 move.w %d3, %SR
000e42 4CDF 0008       373 movem.l (%sp)+, %d3
000e46 4E75            374 rts
                       375 
                       376 SELECT_QUEUE:
000e48 0C00 0000       377 cmp.b #0, %d0
000e4c 6700 000C       378 beq SET_0
000e50 0C00 0001       379 cmp.b #1, %d0
000e54 6700 003E       380 beq SET_1
000e58 4E75            381 rts
                       382 
                       383 SET_0:
000e5a 48E7 0030       384 movem.l %a2-%a3, -(%sp)
000e5e 46FC 2700       385 move.w #0x2700, %SR
                       386 
000e62 23FA FF5C       387 move.l in_0, in
       0000 0000       387 
000e6a 23FA FF60       388 move.l out_0, out
       0000 0000       388 
                       389 
000e72 45FA F744       390 lea.l top, %a2
000e76 23CA 0000       391 move.l %a2, START_LABEL
       0000            391 
000e7c 47EA 00FF       392 lea.l END_0(%a2), %a3
000e80 23CB 0000       393 move.l %a3, bottom
       0000            393 
000e86 23FA FF50       394 move.l s0,s
       0000 0000       394 
000e8e 4CDF 0C00       395 movem.l (%sp)+, %a2-%a3
000e92 4E75            396 rts
                       397 
                       398 SET_1:
000e94 48E7 0030       399 movem.l %a2-%a3, -(%sp)
000e98 46FC 2700       400 move.w #0x2700, %SR
                       401 
000e9c 23FA FF26       402 move.l in_1, in
       0000 0000       402 
000ea4 23FA FF2A       403 move.l out_1, out
       0000 0000       403 
                       404 
000eac 45FA F70A       405 lea.l top, %a2
000eb0 47EA 0100       406 lea.l OFFSET_1(%a2), %a3
000eb4 23CB 0000       407 move.l %a3, START_LABEL
       0000            407 
000eba 47EA 01FF       408 lea.l END_1(%a2), %a3
000ebe 23CB 0000       409 move.l %a3, bottom
       0000            409 
000ec4 23FA FF16       410 move.l s1,s
       0000 0000       410 
000ecc 4CDF 0C00       411 movem.l (%sp)+, %a2-%a3
000ed0 4E75            412 rts
                       413 
                       414 PUT_BUF:
000ed2 48E7 407E       415 movem.l %a1-%a6/%d1, -(%sp)
000ed6 46FC 2700       416 move.w #0x2700, %SR
                       417 
000eda 243A FEF8       418 move.l s,%d2
000ede 0C82 0000       419 cmp.l #0x100,%d2
       0100            419 
000ee4 6700 0038       420 beq PUT_FAIL 
                       421 
000ee8 49FA FEEA       422 lea.l s,%a4
000eec 5294            423 addq.l #1,(%a4)
000eee 143C 0001       424 move.b #1,%d2 /*ÊàêÂäü*/
000ef2 227A FEC8       425 movea.l in, %a1
000ef6 12C1            426 move.b %d1, (%a1)+  
                       427 
000ef8 267A FEBE       428 move.l bottom, %a3
000efc B3CB            429 cmpa.l %a3, %a1
000efe 6300 0008       430 bls PUT_BUF_STEP1
000f02 247A FEDC       431 move.l START_LABEL, %a2
000f06 224A            432 movea.l %a2, %a1
                       433 
                       434 PUT_BUF_STEP1:
000f08 23C9 0000       435 move.l %a1, in
       0000            435 
000f0e B3FA FEB8       436 cmpa.l out, %a1
000f12 6600 0002       437 bne PUT_BUF_STEP2
                       438 
                       439 PUT_BUF_STEP2:
000f16 4EBA 0014       440 jsr UPDATE
000f1a 6000 000A       441 bra PUT_BUF_Finish
                       442 
                       443 PUT_FAIL:
000f1e 343C 0000       444 move.w #0,%d2 /*Â§±Êïó*/
000f22 4EBA 0008       445 jsr UPDATE
                       446 
                       447 PUT_BUF_Finish:
000f26 4CDF 7E02       448 movem.l (%sp)+, %a1-%a6/%d1
000f2a 4E75            449 rts
                       450 
                       451 UPDATE:
000f2c 0C00 0000       452 cmp.b #0, %d0
000f30 6700 000C       453 beq QUEUE_0
000f34 0C00 0001       454 cmp.b #1, %d0
000f38 6700 001E       455 beq QUEUE_1
000f3c 4E75            456 rts
                       457 
                       458 QUEUE_0:
000f3e 23C9 0000       459 move.l %a1, in_0
       0000            459 
000f44 23FA FE82       460 move.l out, out_0
       0000 0000       460 
000f4c 23FA FE86       461 move.l s,s0
       0000 0000       461 
000f54 3002            462 move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
                       463 
000f56 4E75            464 rts
                       465 QUEUE_1:
000f58 23C9 0000       466 move.l %a1, in_1
       0000            466 
000f5e 23FA FE68       467 move.l out, out_1
       0000 0000       467 
000f66 23FA FE6C       468 move.l s,s1
       0000 0000       468 
000f6e 3002            469 move.w %d2,%d0 /*ÊàêÂäüorÂ§±Êïó„ÅÆËøî„ÇäÂÄ§*/
000f70 4E75            470 rts
                       471 
                       472 ********************************************
                       473 **d0:„Ç≠„É•„Éº„ÅÆÈÅ∏Êäû
                       474 **d1:Êàª„ÇäÂÄ§„ÄÅÂèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø
                       475 ********************************************
                       476 OUTQ:
                       477 *move.w #0x0800+'a', UTX1
000f72 48E7 1000       478 movem.l %d3, -(%sp)
000f76 7600            479 move.l #0x0, %d3 /*add*/
000f78 40C3            480 move.w %SR, %d3
000f7a 46FC 2700       481 move.w #0x2700, %SR
000f7e 4EBA FEC8       482 jsr SELECT_QUEUE
000f82 4EBA 000A       483 jsr GET_BUF
000f86 46C3            484 move.w %d3, %SR
000f88 4CDF 0008       485 movem.l (%sp)+, %d3
000f8c 4E75            486 rts
                       487 
                       488 GET_BUF:
000f8e 48E7 007E       489 movem.l %a1-%a6, -(%sp)
000f92 46FC 2700       490 move.w #0x2700, %SR /*add*/
                       491 
                       492 
000f96 243A FE3C       493 move.l s,%d2
000f9a 0C82 0000       494 cmp.l #0x00,%d2
       0000            494 
000fa0 6700 0038       495 beq GET_FAIL
                       496 
000fa4 143C 0001       497 move.b #1,%d2 /*ÊàêÂäü*/
000fa8 49FA FE2A       498 lea.l s,%a4 /*changed*/
                       499 *movea.l s, %a4
                       500 
000fac 5394            501 subq.l #1,(%a4)
000fae 227A FE18       502 movea.l out, %a1
000fb2 1219            503 move.b (%a1)+, %d1     
000fb4 267A FE02       504 move.l bottom, %a3
000fb8 B3CB            505 cmpa.l %a3, %a1 /* cmpa.l %a3, %a1*/
000fba 6300 0008       506 bls GET_BUF_STEP1
000fbe 247A FE20       507 move.l START_LABEL, %a2
000fc2 224A            508 movea.l %a2, %a1
                       509 
                       510 GET_BUF_STEP1:
000fc4 23C9 0000       511 move.l %a1, out
       0000            511 
000fca B3FA FDF0       512 cmpa.l in, %a1  /* cmpa.l in, %a1*/
000fce 6600 0002       513 bne GET_BUF_STEP2
                       514 
                       515 GET_BUF_STEP2:
000fd2 4EBA FF58       516 jsr UPDATE
000fd6 6000 000A       517 bra GET_BUF_Finish
                       518 
                       519 GET_FAIL:
000fda 343C 0000       520 move.w #0,%d2 /*Â§±Êïó*/
000fde 4EBA FF4C       521 jsr UPDATE
                       522 
                       523 GET_BUF_Finish:
                       524 
000fe2 3C3C 003D       525 	move.w #0x3d, %d6
                       526 WAIT:
000fe6 5346            527 	subq.w #1, %d6
000fe8 6600 FFFC       528 	bne WAIT
                       529 
000fec 4CDF 7E00       530 movem.l (%sp)+, %a1-%a6
000ff0 4E75            531 rts
                       532 
                       533 
                       534 
                       535 
                       536 
                       537 
                       538 
                       539 
                       540 
                       541 
                       542 
                       543 
