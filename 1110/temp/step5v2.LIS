                         4 .list
                         5 		***************************************************************
                         6 		**ÂêÑÁ®Æ„É¨„Ç∏„Çπ„ÇøÂÆöÁæ©
                         7 		***************************************************************
                         8 
                         9 		***************
                        10 		** „É¨„Ç∏„Çπ„ÇøÁæ§„ÅÆÂÖàÈ†≠
                        11 		***************
                        12 		.equ REGBASE,   0xFFF000          | DMAP„Çí‰ΩøÁî®Ôºé
                        13 		.equ IOBASE,    0x00d00000
                        14 
                        15 		***************
                        16 		** Ââ≤„ÇäËæº„ÅøÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        17 		***************
                        18 		.equ IVR,       REGBASE+0x300     |Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„É¨„Ç∏„Çπ„Çø
                        19 		.equ IMR,       REGBASE+0x304     |Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ„É¨„Ç∏„Çπ„Çø
                        20 		.equ ISR,       REGBASE+0x30c     |Ââ≤„ÇäËæº„Åø„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        21 		.equ IPR,       REGBASE+0x310     |Ââ≤„ÇäËæº„Åø„Éö„É≥„Éá„Ç£„É≥„Ç∞„É¨„Ç∏„Çπ„Çø
                        22 
                        23 		***************
                        24 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        25 		***************
                        26 		.equ TCTL1,     REGBASE+0x600     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        27 		.equ TPRER1,    REGBASE+0x602     |„Çø„Ç§„ÉûÔºë„Éó„É™„Çπ„Ç±„Éº„É©„É¨„Ç∏„Çπ„Çø
                        28 		.equ TCMP1,     REGBASE+0x604     |„Çø„Ç§„ÉûÔºë„Ç≥„É≥„Éö„Ç¢„É¨„Ç∏„Çπ„Çø
                        29 		.equ TCN1,      REGBASE+0x608     |„Çø„Ç§„ÉûÔºë„Ç´„Ç¶„É≥„Çø„É¨„Ç∏„Çπ„Çø
                        30 		.equ TSTAT1,    REGBASE+0x60a     |„Çø„Ç§„ÉûÔºë„Çπ„ÉÜ„Éº„Çø„Çπ„É¨„Ç∏„Çπ„Çø
                        31 
                        32 		***************
                        33 		** UART1ÔºàÈÄÅÂèó‰ø°ÔºâÈñ¢‰øÇ„ÅÆ„É¨„Ç∏„Çπ„Çø
                        34 		***************
                        35 		.equ USTCNT1,   REGBASE+0x900     | UART1„Çπ„ÉÜ„Éº„Çø„Çπ/„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        36 		.equ UBAUD1,    REGBASE+0x902     | UART1„Éú„Éº„Ç≥„É≥„Éà„É≠„Éº„É´„É¨„Ç∏„Çπ„Çø
                        37 		.equ URX1,      REGBASE+0x904     | UART1Âèó‰ø°„É¨„Ç∏„Çπ„Çø
                        38 		.equ UTX1,      REGBASE+0x906     | UART1ÈÄÅ‰ø°„É¨„Ç∏„Çπ„Çø
                        39 
                        40 		***************
                        41 		** LED
                        42 		***************
                        43 		.equ LED7,      IOBASE+0x000002f  |„Éú„Éº„ÉâÊê≠Ëºâ„ÅÆLEDÁî®„É¨„Ç∏„Çπ„Çø
                        44 		.equ LED6,      IOBASE+0x000002d  |‰ΩøÁî®Ê≥ï„Å´„Å§„ÅÑ„Å¶„ÅØ‰ªòÈå≤A.4.3.1
                        45 		.equ LED5,      IOBASE+0x000002b
                        46 		.equ LED4,      IOBASE+0x0000029
                        47 		.equ LED3,      IOBASE+0x000003f
                        48 		.equ LED2,      IOBASE+0x000003d
                        49 		.equ LED1,      IOBASE+0x000003b
                        50 		.equ LED0,      IOBASE+0x0000039
                        51 
                        52 		***************************************************************
                        53 		** „Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÁ¢∫‰øù
                        54 		***************************************************************
                        55 		.section .bss
                        56 		.even
                        57 SYS_STK:
000a70 0000 0000        58 		.ds.b   0x4000  |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
       0000 0000        58 
                        59 		.even
                        60 SYS_STK_TOP:            |„Ç∑„Çπ„ÉÜ„É†„Çπ„Çø„ÉÉ„ÇØÈ†òÂüü„ÅÆÊúÄÂæåÂ∞æ
                        61 
                        62 		***************************************************************
                        63 		** ÂàùÊúüÂåñ
                        64 		** ÂÜÖÈÉ®„Éá„Éê„Ç§„Çπ„É¨„Ç∏„Çπ„Çø„Å´„ÅØÁâπÂÆö„ÅÆÂÄ§„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÔºé
                        65 		** „Åù„ÅÆÁêÜÁî±„ÇíÁü•„Çã„Å´„ÅØÔºå‰ªòÈå≤B„Å´„ÅÇ„ÇãÂêÑ„É¨„Ç∏„Çπ„Çø„ÅÆ‰ªïÊßò„ÇíÂèÇÁÖß„Åô„Çã„Åì„Å®Ôºé
                        66 		***************************************************************
                        67 
                        68 .section .text
                        69 		.even
                        70 boot:
                        71 		* „Çπ„Éº„Éë„Éº„Éê„Ç§„Ç∂&ÂêÑÁ®ÆË®≠ÂÆö„ÇíË°å„Å£„Å¶„ÅÑ„ÇãÊúÄ‰∏≠„ÅÆÂâ≤ËæºÁ¶ÅÊ≠¢
000400 46FC 2700        72 		move.w #0x2700,%SR
000404 4FF9 0000        73 		lea.l  SYS_STK_TOP, %SP | Set SSP
       0000             73 
                        74 
                        75 		****************
                        76 		**Ââ≤„ÇäËæº„Åø„Ç≥„É≥„Éà„É≠„Éº„É©„ÅÆÂàùÊúüÂåñ
                        77 		****************
00040a 13FC 0040        78 		move.b #0x40, IVR       |„É¶„Éº„Ç∂Ââ≤„ÇäËæº„Åø„Éô„ÇØ„ÇøÁï™Âè∑„Çí| 0x40+level„Å´Ë®≠ÂÆöÔºé
       00FF F300        78 
000412 23FC 00FF        79 		move.l #0x00ffffff,IMR  |ÂÖ®Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ /* STEP2.3 */
       FFFF 00FF        79 
       F304             79 
                        80 
                        81 		****************
                        82 		** ÈÄÅÂèó‰ø°(UART1)Èñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ4„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        83 		****************
00041c 33FC 0000        84 		move.w #0x0000, USTCNT1 |„É™„Çª„ÉÉ„Éà
       00FF F900        84 
000424 33FC E100        85 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°ÂèØËÉΩ,„Éë„É™„ÉÜ„Ç£„Å™„Åó, 1 stop, 8 bit,|ÈÄÅÂèóÂâ≤„ÇäËæº„ÅøÁ¶Å
       00FF F900        85 
00042c 33FC 0038        86 		move.w #0x0038, UBAUD1  |baud rate = 230400 bps
       00FF F902        86 
                        87 
                        88 		****************
                        89 		** „Çø„Ç§„ÉûÈñ¢‰øÇ„ÅÆÂàùÊúüÂåñ(Ââ≤„ÇäËæº„Åø„É¨„Éô„É´„ÅØ6„Å´Âõ∫ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã)
                        90 		*****************
000434 33FC 0004        91 		move.w #0x0004, TCTL1   | restart,Ââ≤„ÇäËæº„Åø‰∏çÂèØ,|„Ç∑„Çπ„ÉÜ„É†„ÇØ„É≠„ÉÉ„ÇØ„ÅÆ1/16„ÇíÂçò‰Ωç„Å®
       00FF F600        91 
                        92 
                        93 		***************************************************************
                        94 		** STEP2„ÅÆÂá¶ÁêÜ
                        95 		***************************************************************
                        96 		/* ÂàùÊúüÂåñÂá¶ÁêÜ„Çí„É°„Ç§„É≥„É´„Éº„ÉÅ„É≥„Åã„Çâ„Åì„Å°„Çâ„Å∏ÁßªÂãï */
                        97 		*lea.l uart1_interrupt, %a0
                        98 		*move.l %a0, 0x110 /* STEP2.1 level 4, (64+4)*4 Ââ≤„ÇäËæº„ÅøÂá¶ÁêÜ„É´„Éº„ÉÅ„É≥„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„
00043c 21FC 0000        99 		move.l #uart1_interrupt, 0x110
       0000 0110        99 
000444 33FC E100       100 		move.w #0xe100, USTCNT1 |ÈÄÅÂèó‰ø°Ââ≤„ÇäËæº„Åø„Éû„Çπ„ÇØ
       00FF F900       100 
00044c 23FC 00FF       101 		move.l #0x00ff3ffb,IMR  |UART1Ë®±ÂèØ
       3FFB 00FF       101 
       F304            101 
000456 46FC 2700       102 		move.w #0x2700, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´7 */
                       103 		
                       104 
00045a 6000 0000       105 		bra MAIN
                       106 
                       107 		***************************************************************
                       108 		** ÁèæÊÆµÈöé„Åß„ÅÆÂàùÊúüÂåñ„É´„Éº„ÉÅ„É≥„ÅÆÊ≠£Â∏∏Âãï‰Ωú„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅÔºåÊúÄÂæå„Å´‚Äôa‚Äô„Çí
                       109 		** ÈÄÅ‰ø°„É¨„Ç∏„Çπ„ÇøUTX1„Å´Êõ∏„ÅçËæº„ÇÄÔºé'a'„ÅåÂá∫Âäõ„Åï„Çå„Çå„Å∞ÔºåOK.
                       110 		***************************************************************
                       111 		.section .text
                       112 		.even
                       113 
                       114 
                       115 
                       116 .section .data
0006d0 3031 3233       117 	TDATA1: .ascii "0123456789ABCDEF"
       3435 3637       117 
       3839 4142       117 
       4344 4546       117 
0006e0 6B6C 6D6E       118 	TDATA2: .ascii "klmnopqrstuvwxyz"	
       6F70 7172       118 
       7374 7576       118 
       7778 797A       118 
                       119 
                       120 
                       121 
                       122 	
                       123 MAIN:
0006f0 4EB9 0000       124 		jsr Init_Q
       0000            124 
0006f6 13FC 0031       125 		move.b #'1', LED7
       00D0 002F       125 
0006fe 33FC E108       126 		move.w #0xe108,USTCNT1
       00FF F900       126 
000706 46FC 2000       127 		move.w #0x2000, %SR    /* Ëµ∞Ë°å„É¨„Éô„É´0 */
                       128 
                       129 
                       130 PS_TEST1:
                       131 		/* jsr PUTSTRING(0, #TDATA1, 16)*/
00070a 7200            132 		move.l	#0x00, %d1
00070c 243C 0000       133 		move.l	#TDATA1, %d2
       0000            133 
000712 7610            134 		move.l	#0x10, %d3
000714 4EBA 00D0       135 		jsr PUTSTRING
                       136 		
                       137 	
000718 13FC 0032       138 		move.b #'2', LED6
       00D0 002D       138 
000720 283C 0000       139 		move.l	#0x000fff, %d4
       0FFF            139 
                       140 	
                       141 		
                       142 LOOP:
000726 5384            143 		subq.l #1,%d4
000728 6700 000E       144 		beq PS_TEST2
00072c 13FC 0035       145 		move.b #'5', LED3
       00D0 003F       145 
                       146 		
000734 6000 FFF0       147 		bra LOOP
                       148 
                       149 PS_TEST2:
000738 13FC 0036       150 		move.b #'6', LED2
       00D0 003D       150 
000740 7200            151 		move.l	#0x00, %d1
000742 243C 0000       152 		move.l	#TDATA2, %d2
       0000            152 
000748 7610            153 		move.l	#0x10, %d3
00074a 4EBA 009A       154 		jsr PUTSTRING
00074e 6000 FFE8       155 		bra PS_TEST2
                       156 
                       157 /*‰ª•‰∏ã„ÉÜ„Çπ„Éà*/
                       158 TEST_READY:
                       159 		*movem.l %d1-%d5, -(%sp)
                       160 	
000752 383C 0010       161 		move.w #16, %d4
000756 3A3C 0010       162 		move.w #16, %d5
00075a 123C 0061       163 		move.b #0x61, %d1
00075e 6000 0008       164 		bra TEST_LOOP
                       165 
                       166 TEST_LOOP2:
                       167 
000762 5241            168 		addq #1, %d1
000764 383C 0010       169 		move.w #16, %d4
                       170 
                       171 TEST_LOOP:
000768 7001            172 		moveq #1, %d0
                       173 		*move.w #0x1000, %d0
00076a 4EB9 0000       174 		jsr INQ
       0000            174 
                       175 		*jsr OUTQ
000770 5344            176 		subq #1, %d4
000772 6600 FFF4       177 		bne TEST_LOOP
000776 5345            178 		subq #1, %d5
000778 6700 0006       179 		beq TEST_END
00077c 6000 FFE4       180 		bra TEST_LOOP2
                       181 
                       182 TEST_END:
                       183 		*movem.l (%sp)+, %d1-%d5
000780 4E75            184 		rts
                       185 /*‰ª•‰∏ä„ÉÜ„Çπ„Éà*/
                       186 
                       187 uart1_interrupt:
000782 13FC 0033       188 		move.b #'3', LED5
       00D0 002B       188 
00078a 48E7 8000       189 		movem.l %d0, -(%sp)
                       190 
                       191 		*move.b #'a', %d0 /* URX1„ÅÆ‰∏ã‰Ωç8„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíËª¢ÈÄÅ */
                       192 		*addi.w #0x0800, %d0 /* Âç≥ÂÄ§„Çí„É¨„Ç∏„Çπ„Çød0„Å´Âä†ÁÆó */
                       193 		*move.w %d0, UTX1 /* 16„Éì„ÉÉ„Éà„ÅÆ„Éá„Éº„Çø„ÇíUTX1„Å´Ëª¢ÈÄÅ */
                       194 
                       195 
00078e 3039 00FF       196 		move.w UTX1, %d0	/*step4:UTX1„ÅÆ„Ç≥„Éî„Éº*/
       F906            196 
                       197 		
000794 123C 0000       198 		move.b #0, %d1	/*ch„ÅÆÈÅ∏Êäû*/
                       199 
000798 0C40 8000       200 		cmp #0x8000,%d0
00079c 6400 0008       201 		bcc INTERPUT
                       202 
0007a0 4CDF 0001       203 		movem.l (%sp)+, %d0
                       204 		
0007a4 4E73            205 		rte
                       206 
                       207 
                       208 INTERPUT:
0007a6 48E7 E000       209 		movem.l %d0-%d2, -(%sp)
                       210 
0007aa 46FC 2700       211 		move.w #0x2700, %SR	/*step4.1:Ëµ∞Ë°å„É¨„Éô„É´7*/
                       212 
0007ae 0C01 0000       213 		cmp.b #0x0, %d1		/*step4.2:ch!=0„ÅßÂàÜÂ≤ê*/
                       214 
0007b2 6600 0020       215 		bne INTERPUT_END
                       216 
0007b6 103C 0001       217 		move.b #1, %d0
                       218 
0007ba 4EB9 0000       219 		jsr OUTQ		/*step4.3:OUTQ„ÅÆÂÆüË°å*/
       0000            219 
                       220 
0007c0 0C40 0000       221 		cmp.w #0, %d0		/*step4.4:Êàª„ÇäÂÄ§„Åå0„ÅßÂàÜÂ≤ê*/
                       222 
0007c4 6700 0014       223 		beq INTERPUT_MASK
                       224 
0007c8 1401            225 		move.b %d1, %d2
                       226 
0007ca 0642 0800       227 		addi.w #0x0800, %d2
                       228 
                       229 
0007ce 33C2 00FF       230 		move.w %d2, UTX1	/*step4.5:„Éò„ÉÉ„ÉÄ‰ªò‰∏é*/
       F906            230 
                       231 
                       232 
                       233 INTERPUT_END:
0007d4 4CDF 0007       234 		movem.l (%sp)+, %d0-%d2
                       235 
                       236 		*movem.l (%sp)+, %d0
                       237 
0007d8 4E73            238 		rte
                       239 
                       240 INTERPUT_MASK:
0007da 33FC E100       241 		move.w #0xe100, USTCNT1	/*step4.4:ÈÄÅ‰ø°Ââ≤„ÇäËæº„Åø„ÅÆ„Éû„Çπ„ÇØ*/
       00FF F900       241 
                       242 		/* ‚Üë ‰ΩïÊïÖ„Åã„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„Åï„Çå„Å¶„ÅÑ„Åü„ÅÆ„Åß„ÄÅ‰øÆÊ≠£ */
                       243 
0007e2 6000 FFF0       244 		bra INTERPUT_END
                       245 
                       246 *************************************************************
                       247 **PUTSTRING
                       248 **ÂÖ•Âäõ
                       249 **d1:„ÉÅ„É£„Éç„É´
                       250 **d2:„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ
                       251 **d3:ÈÄÅ‰ø°„Åô„Çã„Éá„Éº„ÇøÊï∞size
                       252 **Êàª„ÇäÂÄ§
                       253 **d0:ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞
                       254 *************************************************************
                       255 PUTSTRING:
0007e6 48E7 7EFE       256 		movem.l %a0-%a6/%d1-%d6, -(%SP)
                       257 
0007ea 0C01 0000       258 		cmp.b #0x00, %d1		/*ch!=0„ÅßÂàÜÂ≤ê*/
0007ee 6600 0044       259 		bne PUTSTRING_END
                       260 		/* rv: „Éê„Ç§„Éà„Çµ„Ç§„Ç∫„ÅÆÊØîËºÉ„ÄÇÔºê„Åß„ÅØ„Å™„ÅÑ„Å®„Åç„Å´ÁµÇ‰∫Ü„Åô„Çã*/
                       261 
0007f2 383C 0000       262 		move.w #0x0000,%d4 		/*%d4=sz:ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
                       263 		/* rv: „Éá„Éº„ÇøÊï∞(sz)„ÅÆÂàùÊúüÂåñ*/
                       264 
0007f6 2242            265 		move.l %d2,%a1 		/*%d5:„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÖà„Ç¢„Éâ„É¨„Çπ/
                       266 		/* rv: Ë™≠„ÅøËæº„ÅøÂÖà„ÅÆÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Çía1„Å´Ê†ºÁ¥ç„Åô„Çã*/	
                       267 
0007f8 0C43 0000       268 		cmp.w #0x0000,%d3		/*size=0„ÅßÂàÜÂ≤ê*/
0007fc 6700 0036       269 		beq PUTSTRING_END
                       270 		/* rv: d3(size)„Åå0„Å™„Çâ„Å∞ÁµÇ‰∫Ü„Åô„Çã*/
                       271 
                       272 
                       273 LOOP_STEP5:
000800 B644            274 		cmp.w %d4,%d3		/*sz=size„ÅßÂàÜÂ≤ê*/
000802 6700 001C       275 		beq PUTSTRING_MASK
                       276 		/* d3 „Å® d4 size = sz „Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï*/
                       277 
000806 7001            278 		move.l #0x01,%d0 		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆË®≠ÂÆö*/
000808 1219            279 		move.b (%a1)+,%d1	/*„Éá„Éº„Çø„ÇíINQ„ÅÆÂÖ•Âäõd1„Å´Ê†ºÁ¥ç*/
                       280 		/* rv: ÂÖàÈ†≠„Ç¢„Éâ„É¨„Çπ„Åã„ÇâÈ†Ü„Å´Ê†ºÁ¥ç„Åô„Çã*/
                       281 
00080a 4EB9 0000       282 		jsr INQ
       0000            282 
                       283 
000810 0C80 0000       284 		cmp.l #0x00,%d0		/*ÊàêÂäüorÂ§±ÊïóÂà§ÂÆö*/
       0000            284 
000816 6700 0008       285 		beq PUTSTRING_MASK
                       286 		/*rv : Â§±Êïó„Å™„Çâ„Å∞„Éû„Çπ„ÇØ„Å∏ÁßªÂãï„Åô„Çã*/
                       287 
00081a 5244            288 		addq.w #0x01,%d4		/*sz++*/
00081c 6000 FFE2       289 		bra LOOP_STEP5
                       290 
                       291 PUTSTRING_MASK:
000820 13FC 0034       292 		move.b #'4', LED4
       00D0 0029       292 
                       293 
                       294 
                       295 
000828 33FC E10C       296 		move.w #0xe10c, USTCNT1	/*ÈÄÅ‰ø°Ââ≤„ÇäËæº„ÅøË®±ÂèØ*/
       00FF F900       296 
000830 6000 0002       297 		bra PUTSTRING_END
                       298 
                       299 PUTSTRING_END:
000834 3004            300 		move.w %d4,%d0		/*Êàª„ÇäÂÄ§d0„Å´ÂÆüÈöõ„Å´ÈÄÅ‰ø°„Åó„Åü„Éá„Éº„ÇøÊï∞„ÇíÊ†ºÁ¥ç*/
000836 4CDF 7F7E       301 		movem.l (%SP)+, %a0-%a6/%d1-%d6
                       302 
                       303 		*rte 			/*?*/
                       304 		/* bus errorÂá∫„Åü„ÅÆ„ÅßÂ§âÊõ¥„Åó„Åü*/
                       305 
                       306 		***
                       307 		***
00083a 4E75            308 		rts
                       309 
                       310 ******************************************************************************:
                       311 
                       312 ******
                       313 ******‰ª•ÈôçQUEUE
                       314 ******
                       315 .section .data
                       316 ******************************
                       317 ** „Ç≠„É•„ÉºÁî®„ÅÆ„É°„É¢„É™È†òÂüüÁ¢∫‰øù ‚Üì‚Üì
                       318 ******************************
                       319 .equ B_SIZE, 256
                       320 .equ ALL_B_SIZE, B_SIZE + B_SIZE |Âèó‰ø°„Å®ÈÄÅ‰ø°„ÅßÔºëÊú¨„Åö„Å§|
                       321 
00083c 0000 0000       322 top: .ds.b ALL_B_SIZE-1 |„Ç≠„É•„Éº„ÅÆ„Éá„Éº„ÇøÈ†òÂüü|
       0000 0000       322 
       0000 0000       322 
       0000 0000       322 
       0000 0000       322 
000a3b 00              323 bottom: .ds.b 1
000a3c 0000 0000       324 in: .ds.l 2 |„Ç≠„É•„Éº„ÅÆÂêÑÁ®Æ„Éù„Ç§„É≥„Çø‚Üì|
       0000 0000       324 
000a44 0000 0000       325 out: .ds.l 2
       0000 0000       325 
000a4c 0000            326 PUT_FLG: .ds.b 2
000a4e 0000            327 GET_FLG: .ds.b 2
000a50 0000 0000       328 s: .ds.l 2
       0000 0000       328 
                       329 
000a58 0000 0000       330 top_ptr: .ds.l 1 |ÂÆüË°åÊôÇÁî®‰∏ÄÊôÇ‰øùÂ≠òÈ†òÂüü‚Üì|
000a5c 0000 0000       331 bottom_ptr: .ds.l 1
000a60 0000 0000       332 in_ptr: .ds.l 1
000a64 0000 0000       333 out_ptr: .ds.l 1
000a68 00              334 PUT_FLG_ptr: .ds.b 1
000a69 00              335 GET_FLG_ptr: .ds.b 1
000a6a 0000 0000       336 s_ptr: .ds.l 1
                       337 
                       338 .even
                       339 
                       340 
                       341 
                       342 .section .text
                       343 ******************************
                       344 ** „Ç≠„É•„ÉºÁî®„ÅÆ„É°„É¢„É™È†òÂüüÁ¢∫‰øù ‚Üë‚Üë
                       345 ******************************
                       346 
                       347 **********************  
                       348 
                       349 ** „Ç≠„É•„Éº„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ‚Üì‚Üì  
                       350 
                       351 **********************  
                       352 
                       353 Init_Q: 
                       354 
00045e 48E7 80F8       355  	movem.l	%d0/%a0-%a4, -(%sp) 
                       356 
                       357   
                       358 
000462 7002            359 	move.l	#2, %d0			/*#4 -> #2*/ 
                       360 
                       361   
                       362 
000464 41F9 0000       363 	lea.l 	top, %a0 
       0000            363 
                       364 
00046a 43F9 0000       365  	lea.l	in, %a1 
       0000            365 
                       366 
000470 45F9 0000       367  	lea.l	out, %a2 
       0000            367 
                       368 
000476 47F9 0000       369  	lea.l	PUT_FLG, %a3 
       0000            369 
                       370 
00047c 49F9 0000       371  	lea.l	GET_FLG, %a4 
       0000            371 
                       372 
                       373   
                       374 
                       375 Loop_Init:	 
                       376 
000482 22C8            377  	move.l 	%a0, (%a1)+ 
                       378 
000484 24C8            379  	move.l 	%a0, (%a2)+ 
                       380 
000486 16FC 0001       381  	move.b 	#0x01, (%a3)+ 
                       382 
00048a 18FC 0000       383  	move.b 	#0x00, (%a4)+ 
                       384 
                       385   
                       386 
00048e D1FC 0000       387 	adda.l	#B_SIZE, %a0 
       0100            387 
                       388 
                       389   
                       390 
000494 5380            391 	subq.l	#1, %d0 
                       392 
000496 6200 FFEA       393  	bhi	Loop_Init 
                       394 
                       395   
                       396 
00049a 4CDF 1F01       397 	movem.l	(%sp)+, %d0/%a0-%a4 
                       398 
00049e 4E75            399  	rts 
                       400 
                       401  **********************  
                       402 
                       403 ** „Ç≠„É•„Éº„ÅÆÂàùÊúüÂåñÂá¶ÁêÜ ‚Üë‚Üë 
                       404 
                       405  **********************  
                       406 
                       407  
                       408 
                       409  
                       410 
                       411 ***********************************  
                       412 
                       413 ** INQ „Ç≠„É•„Éº„Å∏„ÅÆ„Éá„Éº„ÇøÊõ∏„ÅçËæº„Åø‚Üì‚Üì 
                       414 
                       415  ** a0: Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø„ÅÆ„Ç¢„Éâ„É¨„Çπ  
                       416 
                       417 ** (ÂÖ•Âäõ)d0: Êõ∏„ÅçËæº„ÇÄ„Ç≠„É•„Éº„ÅÆÁï™Âè∑0~1		 
                       418 
                       419  ** (Âá∫Âäõ)d0: ÁµêÊûú(00:Â§±Êïó, 01:ÊàêÂäü)  
                       420 
                       421 *********************************** 
                       422 
                       423  INQ: 
                       424 
0004a0 48E7 7EFE       425  	movem.l	%d1-%d6/%a0-%a6, -(%sp)		/*ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø*/ 
                       426 
0004a4 40E7            427  	move.w	%SR, -(%sp) 
                       428 
0004a6 46FC 2700       429  	move.w	#0x2700, %SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢*/ 
                       430 
                       431  		 
                       432 
0004aa 2600            433 	move.l	%d0, %d3		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆ‰øùÂ≠ò*/ 
                       434 
                       435   
                       436 
0004ac 49F9 0000       437 	lea.l	PUT_FLG, %a4 
       0000            437 
                       438 
0004b2 D9C0            439  	add.l	%d0, %a4 
                       440 
0004b4 13D4 0000       441  	move.b	(%a4), PUT_FLG_ptr 
       0000            441 
                       442 
                       443   
                       444 
0004ba 49F9 0000       445 	lea.l	GET_FLG, %a4 
       0000            445 
                       446 
0004c0 D9C0            447  	add.l	%d0, %a4 
                       448 
0004c2 13D4 0000       449  	move.b	(%a4), GET_FLG_ptr 
       0000            449 
                       450 
                       451   
                       452 
0004c8 C0FC 0004       453 	mulu	#4, %d0			 
                       454 
0004cc 49F9 0000       455  	lea.l	in, %a4 
       0000            455 
                       456 
0004d2 D9C0            457  	add.l	%d0, %a4 
                       458 
0004d4 23D4 0000       459  	move.l	(%a4), in_ptr 
       0000            459 
                       460 
                       461   
                       462 
0004da 49F9 0000       463 	lea.l	out, %a4 
       0000            463 
                       464 
0004e0 D9C0            465  	add.l	%d0, %a4 
                       466 
0004e2 23D4 0000       467  	move.l	(%a4), out_ptr 
       0000            467 
                       468 
                       469   
                       470 
0004e8 C0FC 0040       471 	mulu	#64, %d0 
                       472 
0004ec 49F9 0000       473  	lea.l 	top, %a4 
       0000            473 
                       474 
0004f2 D9C0            475  	add.l	%d0, %a4 
                       476 
0004f4 23CC 0000       477  	move.l	%a4, top_ptr 
       0000            477 
                       478 
                       479   
                       480 
0004fa 243C 0000       481 	move.l	#256, %d2		/*#768 -> #256*/ 
       0100            481 
                       482 
000500 9480            483  	sub.l	%d0, %d2 
                       484 
000502 7000            485  	move.l	#0, %d0			/*d0ÂàùÊúüÂåñ*/	 
                       486 
000504 49F9 0000       487  	lea.l	bottom, %a4 
       0000            487 
                       488 
00050a 99C2            489  	sub.l	%d2, %a4 
                       490 
00050c 23CC 0000       491  	move.l	%a4, bottom_ptr 
       0000            491 
                       492 
                       493   
                       494 
000512 4EBA 0046       495 	jsr 	PUT_BUF 	/* „Ç≠„É•„Éº„Å∏„ÅÆÊõ∏„ÅçËæº„Åø */ 
                       496 
                       497   
                       498 
000516 49F9 0000       499 	lea.l	PUT_FLG, %a4 
       0000            499 
                       500 
00051c D9C3            501  	add.l	%d3, %a4	 
                       502 
00051e 18B9 0000       503  	move.b 	PUT_FLG_ptr,(%a4)	 
       0000            503 
                       504 
                       505   
                       506 
000524 49F9 0000       507 	lea.l	GET_FLG, %a4 
       0000            507 
                       508 
00052a D9C3            509  	add.l	%d3, %a4	 
                       510 
00052c 18B9 0000       511  	move.b 	GET_FLG_ptr,(%a4)	 
       0000            511 
                       512 
                       513   
                       514 
                       515  
                       516 
000532 C6FC 0004       517 	mulu	#4, %d3 
                       518 
000536 49F9 0000       519  	lea.l 	in, %a4 
       0000            519 
                       520 
00053c D9C3            521  	add.l	%d3, %a4 
                       522 
00053e 28B9 0000       523  	move.l	in_ptr, (%a4) 
       0000            523 
                       524 
                       525   
                       526 
000544 49F9 0000       527 	lea.l	out, %a4 
       0000            527 
                       528 
00054a D9C3            529  	add.l	%d3, %a4 
                       530 
00054c 28B9 0000       531  	move.l	out_ptr, (%a4) 
       0000            531 
                       532 
                       533   
                       534 
000552 46DF            535 	move.w	(%sp)+, %SR 
                       536 
000554 4CDF 7F7E       537  	movem.l	(%sp)+, %d1-%d6/%a0-%a6		/*ÊóßËµ∞Ë°å„É¨„Éô„É´„ÅÆÂõûÂæ©*/ 
                       538 
000558 4E75            539  	rts 
                       540 
                       541  ***********************************  
                       542 
                       543 ** INQ „Ç≠„É•„Éº„Å∏„ÅÆ„Éá„Éº„ÇøÊõ∏„ÅçËæº„Åø‚Üë‚Üë 
                       544 
                       545  *********************************** 
                       546 
                       547   
                       548 
                       549  
                       550 
                       551 ****************************************  
                       552 
                       553 ** PUT_BUF‚Üì‚Üì 
                       554 
                       555  ** a0: Êõ∏„ÅçËæº„ÇÄ„Éá„Éº„Çø„ÅÆ„Ç¢„Éâ„É¨„Çπ 
                       556 
                       557  ** d0: ÁµêÊûú(00:Â§±Êïó, 00‰ª•Â§ñ:ÊàêÂäü)  
                       558 
                       559 ** d1: Êõ∏„ÅçËæº„ÇÄ8bit„Éá„Éº„Çø 
                       560 
                       561  ****************************************  
                       562 
                       563 PUT_BUF: 
                       564 
00055a 48E7 0070       565  	movem.l	%a1-%a3, -(%sp) 
                       566 
00055e 1039 0000       567  	move.b	PUT_FLG_ptr, %d0 
       0000            567 
                       568 
                       569   
                       570 
000564 0C00 0000       571 	cmp.b	#0x00, %d0		/* PUT‰∏çÂèØËÉΩ(Â§±Êïó) */ 
                       572 
000568 6700 0048       573  	beq	PUT_BUF_Finish 
                       574 
                       575   
                       576 
00056c 2279 0000       577 	movea.l	in_ptr, %a1		/* „Ç≠„É•„Éº„Å´„Éá„Éº„Çø„ÇíÊåøÂÖ• */ 
       0000            577 
                       578 
000572 12C1            579  	move.b	%d1, (%a1)+ 
                       580 
                       581   
                       582 
000574 06B9 0000       583 	addi.l	#1, s			/* „Ç≠„É•„ÉºÂÜÖ„ÅÆ„Éá„Éº„ÇøÊï∞:+1 */ 
       0001 0000       583 
       0000            583 
                       584 
                       585   
                       586 
00057e 2679 0000       587 	move.l	bottom_ptr, %a3		/* a3„ÅØ„Ç≠„É•„ÉºÊú´Â∞æ */ 
       0000            587 
                       588 
000584 B3CB            589  	cmpa.l	%a3, %a1		/* PUT„Éù„Ç§„É≥„Çø„ÅåÊú´Â∞æ„ÇíË∂Ö„Åà„Åü */ 
                       590 
000586 6300 000A       591  	bls	PUT_BUF_STEP1	 
                       592 
                       593   
                       594 
00058a 2479 0000       595 	move.l	top_ptr, %a2	/* PUT„Éù„Ç§„É≥„Çø„ÇíÂÖàÈ†≠„Å´Êàª„Åô */ 
       0000            595 
                       596 
000590 224A            597  	movea.l	%a2, %a1 
                       598 
                       599   
                       600 
                       601 PUT_BUF_STEP1: 
                       602 
000592 23C9 0000       603  	move.l	%a1, in_ptr 
       0000            603 
                       604 
                       605   
                       606 
000598 B3F9 0000       607 	cmpa.l	out_ptr, %a1	/* PUT„Éù„Ç§„É≥„Çø„ÅåGET„Éù„Ç§„É≥„Çø„Å´ËøΩ„ÅÑ„Å§„ÅÑ„Åü */ 
       0000            607 
                       608 
00059e 6600 000A       609  	bne	PUT_BUF_STEP2 
                       610 
                       611   
                       612 
0005a2 13FC 0000       613 	move.b	#0x00, PUT_FLG_ptr	/* Ê∫Ä„Çø„É≥„Å™„ÅÆ„ÅßPUT‰∏çÂèØËÉΩ(„Éï„É©„Ç∞) */ 
       0000 0000       613 
                       614 
                       615   
                       616 
                       617 PUT_BUF_STEP2: 
                       618 
0005aa 13FC 0001       619  	move.b	#0x01, GET_FLG_ptr 
       0000 0000       619 
                       620 
                       621   
                       622 
                       623 PUT_BUF_Finish: 
                       624 
0005b2 4CDF 0E00       625  	movem.l	(%sp)+, %a1-%a3 
                       626 
0005b6 4E75            627  	rts 
                       628 
                       629  ****************************************  
                       630 
                       631 ** PUT_BUF‚Üë‚Üë 
                       632 
                       633  **************************************** 
                       634 
                       635  
                       636 
                       637  
                       638 
                       639 ***********************************  
                       640 
                       641 ** OUTQ „Ç≠„É•„Éº„Åã„Çâ„ÅÆË™≠„ÅøÂá∫„Åó‚Üì‚Üì 
                       642 
                       643  ** a2: Ë™≠„ÅøÂá∫„ÅóÂÖà„Ç¢„Éâ„É¨„Çπ 
                       644 
                       645  ** d0(ÂÖ•Âäõ):„Ç≠„É•„ÉºÁï™Âè∑ 
                       646 
                       647  ** d0(Âá∫Âäõ): ÁµêÊûú(00:Â§±Êïó, 01:ÊàêÂäü)  
                       648 
                       649 ** d1: Âèñ„ÇäÂá∫„Åó„Åü8bit„Éá„Éº„Çø 
                       650 
                       651  *********************************** 
                       652 
                       653  OUTQ: 
                       654 
0005b8 48E7 3EFE       655  	movem.l	%d2-%d6/%a0-%a6, -(%sp) 
                       656 
0005bc 40E7            657  	move.w	%SR, -(%sp)		/*ÁèæËµ∞Ë°å„É¨„Éô„É´„ÅÆÈÄÄÈÅø*/ 
                       658 
0005be 46FC 2700       659  	move.w	#0x2700, %SR			/*Ââ≤„ÇäËæº„ÅøÁ¶ÅÊ≠¢*/ 
                       660 
                       661   
                       662 
0005c2 2600            663 	move.l	%d0, %d3		/*„Ç≠„É•„ÉºÁï™Âè∑„ÅÆ‰øùÂ≠ò*/ 
                       664 
                       665   
                       666 
0005c4 49F9 0000       667 	lea.l	PUT_FLG, %a4 
       0000            667 
                       668 
0005ca D9C0            669  	add.l	%d0, %a4 
                       670 
0005cc 13D4 0000       671  	move.b	(%a4), PUT_FLG_ptr 
       0000            671 
                       672 
                       673   
                       674 
0005d2 49F9 0000       675 	lea.l	GET_FLG, %a4 
       0000            675 
                       676 
0005d8 D9C0            677  	add.l	%d0, %a4 
                       678 
0005da 13D4 0000       679  	move.b	(%a4), GET_FLG_ptr 
       0000            679 
                       680 
                       681   
                       682 
0005e0 C0FC 0004       683 	mulu	#4, %d0			 
                       684 
0005e4 49F9 0000       685  	lea.l	in, %a4 
       0000            685 
                       686 
0005ea D9C0            687  	add.l	%d0, %a4 
                       688 
0005ec 23D4 0000       689  	move.l	(%a4), in_ptr 
       0000            689 
                       690 
                       691   
                       692 
0005f2 49F9 0000       693 	lea.l	out, %a4 
       0000            693 
                       694 
0005f8 D9C0            695  	add.l	%d0, %a4 
                       696 
0005fa 23D4 0000       697  	move.l	(%a4), out_ptr 
       0000            697 
                       698 
                       699   
                       700 
000600 C0FC 0040       701 	mulu	#64, %d0 
                       702 
000604 49F9 0000       703  	lea.l 	top, %a4 
       0000            703 
                       704 
00060a D9C0            705  	add.l	%d0, %a4 
                       706 
00060c 23CC 0000       707  	move.l	%a4, top_ptr 
       0000            707 
                       708 
                       709   
                       710 
000612 243C 0000       711 	move.l	#256, %d2		/*#768 -> #256*/ 
       0100            711 
                       712 
000618 9480            713  	sub.l	%d0, %d2 
                       714 
00061a 7000            715  	move.l	#0, %d0			/*d0ÂàùÊúüÂåñ*/	 
                       716 
00061c 49F9 0000       717  	lea.l	bottom, %a4 
       0000            717 
                       718 
000622 99C2            719  	sub.l	%d2, %a4 
                       720 
000624 23CC 0000       721  	move.l	%a4, bottom_ptr 
       0000            721 
                       722 
                       723   
                       724 
00062a 4EBA 0046       725 	jsr 	GET_BUF 	/* „Ç≠„É•„Éº„Åã„Çâ„ÅÆË™≠„ÅøÂá∫„Åó */ 
                       726 
                       727   
                       728 
00062e 49F9 0000       729 	lea.l	PUT_FLG, %a4 
       0000            729 
                       730 
000634 D9C3            731  	add.l	%d3, %a4	 
                       732 
000636 18B9 0000       733  	move.b 	PUT_FLG_ptr,(%a4)	 
       0000            733 
                       734 
                       735   
                       736 
00063c 49F9 0000       737 	lea.l	GET_FLG, %a4 
       0000            737 
                       738 
000642 D9C3            739  	add.l	%d3, %a4	 
                       740 
000644 18B9 0000       741  	move.b 	GET_FLG_ptr,(%a4)	 
       0000            741 
                       742 
                       743   
                       744 
                       745  
                       746 
00064a C6FC 0004       747 	mulu	#4, %d3 
                       748 
00064e 49F9 0000       749  	lea.l 	in, %a4 
       0000            749 
                       750 
000654 D9C3            751  	add.l	%d3, %a4 
                       752 
000656 28B9 0000       753  	move.l	in_ptr, (%a4) 
       0000            753 
                       754 
                       755   
                       756 
00065c 49F9 0000       757 	lea.l	out, %a4 
       0000            757 
                       758 
000662 D9C3            759  	add.l	%d3, %a4 
                       760 
000664 28B9 0000       761  	move.l	out_ptr, (%a4) 
       0000            761 
                       762 
                       763   
                       764 
                       765  
                       766 
00066a 46DF            767 	move.w	(%sp)+, %SR		/*ÊóßËµ∞Ë°åÁä∂ÊÖã„ÅÆÂõûÂæ©*/ 
                       768 
00066c 4CDF 7F7C       769  	movem.l	(%sp)+, %d2-%d6/%a0-%a6 
                       770 
000670 4E75            771  	rts 
                       772 
                       773  ***********************************  
                       774 
                       775 ** OUTQ „Ç≠„É•„Éº„Åã„Çâ„ÅÆË™≠„ÅøÂá∫„Åó‚Üë‚Üë 
                       776 
                       777  *********************************** 
                       778 
                       779   
                       780 
                       781  
                       782 
                       783 ****************************************  
                       784 
                       785 ** GET_BUF‚Üì‚Üì 
                       786 
                       787  ** a2: Ë™≠„ÅøÂá∫„ÅóÂÖà„Ç¢„Éâ„É¨„Çπ 
                       788 
                       789  ** d0: ÁµêÊûú(00:Â§±Êïó, 00‰ª•Â§ñ:ÊàêÂäü)  
                       790 
                       791 ** d1: Âèñ„ÇäÂá∫„Åó„Åü8bit„Éá„Éº„Çø 
                       792 
                       793  ****************************************  
                       794 
                       795 GET_BUF: 
                       796 
000672 48E7 0058       797  	movem.l	%a1/%a3-%a4, -(%sp) 
                       798 
000676 1039 0000       799  	move.b	GET_FLG_ptr, %d0 
       0000            799 
                       800 
                       801   
                       802 
00067c 0C00 0000       803 	cmp.b	#0x00, %d0	/* GET‰∏çÂèØËÉΩ(Â§±Êïó) */ 
                       804 
000680 6700 0048       805  	beq	GET_BUF_Finish 
                       806 
                       807   
                       808 
000684 2279 0000       809 	movea.l	out_ptr, %a1	/* „Ç≠„É•„Éº„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøÂá∫„Åô */ 
       0000            809 
                       810 
00068a 1219            811  	move.b	(%a1)+, %d1	/* Âèñ„ÇäÂá∫„Åó„Åü„Éá„Éº„Çø */ 
                       812 
                       813   
                       814 
                       815  
                       816 
00068c 04B9 0000       817 	subi.l	#1, s		/* „Ç≠„É•„ÉºÂÜÖ„ÅÆ„Éá„Éº„ÇøÊï∞:-1 */ 
       0001 0000       817 
       0000            817 
                       818 
                       819   
                       820 
000696 2679 0000       821 	move.l	bottom_ptr, %a3	/* a3„ÅØ„Ç≠„É•„ÉºÊú´Â∞æ */ 
       0000            821 
                       822 
00069c B3CB            823  	cmpa.l	%a3, %a1	/* GET„Éù„Ç§„É≥„Çø„ÅåÊú´Â∞æ„ÇíË∂Ö„Åà„Åü */ 
                       824 
00069e 6300 000A       825  	bls	GET_BUF_STEP1	 
                       826 
                       827   
                       828 
0006a2 2879 0000       829 	move.l	top_ptr, %a4	/* GET„Éù„Ç§„É≥„Çø„ÇíÂÖàÈ†≠„Å´Êàª„Åô */ 
       0000            829 
                       830 
0006a8 224C            831  	movea.l	%a4, %a1 
                       832 
                       833   
                       834 
                       835 GET_BUF_STEP1: 
                       836 
0006aa 23C9 0000       837  	move.l	%a1, out_ptr 
       0000            837 
                       838 
                       839   
                       840 
0006b0 B3F9 0000       841 	cmpa.l	in_ptr, %a1	/* GET„Éù„Ç§„É≥„Çø„ÅåPUT„Éù„Ç§„É≥„Çø„Å´ËøΩ„ÅÑ„Å§„ÅÑ„Åü */ 
       0000            841 
                       842 
0006b6 6600 000A       843  	bne	GET_BUF_STEP2 
                       844 
                       845   
                       846 
0006ba 13FC 0000       847 	move.b	#0x00, GET_FLG_ptr	/* „Éá„Éº„Çø„Åå„Å™„ÅÑ„ÅÆ„ÅßGET‰∏çÂèØËÉΩ(„Éï„É©„Ç∞) */ 
       0000 0000       847 
                       848 
                       849   
                       850 
                       851 GET_BUF_STEP2: 
                       852 
0006c2 13FC 0001       853  	move.b	#0x01, PUT_FLG_ptr 
       0000 0000       853 
                       854 
                       855   
                       856 
                       857 GET_BUF_Finish: 
                       858 
0006ca 4CDF 1A00       859  	movem.l	(%sp)+, %a1/%a3-%a4 
                       860 
0006ce 4E75            861  	rts 
                       862 
                       863  ****************************************  
                       864 
                       865 ** GET_BUF‚Üë‚Üë 
                       866 
                       867  **************************************** 
                       868 
                       869  
                       870 
